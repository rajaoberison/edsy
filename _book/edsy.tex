% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={EDS Vignettes},
  pdfauthor={Andry Rajaoberison},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}
\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother
\usepackage[]{natbib}
\bibliographystyle{apalike}

\title{EDS Vignettes}
\author{Andry Rajaoberison}
\date{2020-04-08}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{prerequisites}{%
\chapter*{Prerequisites}\label{prerequisites}}
\addcontentsline{toc}{chapter}{Prerequisites}

The following tutorials are written in R. To install R on your computer, please visit this link: \url{https://www.r-project.org/}
You should also install RStudio: \url{https://rstudio.com/products/rstudio/download/}

We will use the packages in the \textbf{tidyverse} library:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"tidyverse"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{reading}{%
\chapter{Reading}\label{reading}}

In this section, we learn how to read data from different file format.

\hypertarget{csv}{%
\section{CSV}\label{csv}}

Reading csv with column headers and separated by \texttt{,}. These parameters are also the default values for the \texttt{read.csv} function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data \textless{}{-}}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\DataTypeTok{file =} \StringTok{\textquotesingle{}/path/to/csv\textquotesingle{}}\NormalTok{, }\DataTypeTok{header =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{sep =} \StringTok{\textquotesingle{},\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Example}
\NormalTok{data \textless{}{-}}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\DataTypeTok{file =} \StringTok{\textquotesingle{}data/eds.data.hurricane.csv\textquotesingle{}}\NormalTok{, }\DataTypeTok{header =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{excel}{%
\section{Excel}\label{excel}}

The main advantage of Excel files is that they can store multiple tables. But reading these tables at once is different from a CSV. For this example, we're going to use the \texttt{readxl} package from the \texttt{tidyverse} collection. Please visit this {[}website{]} (\url{https://www.tidyverse.org/}) to learn more about \texttt{tidyverse}.

To read an excel file, you can use the \texttt{read\_excel} function and specify at least the \texttt{path/to/the/file} and \texttt{sheet} you want to open. If you don't specify the \texttt{sheet}, \texttt{read\_excel} will automatically open the first table in the spreadsheet.
In the `eds.excel.sample.xlsx' file, there are 2 tables: heatwave and hurricane. Here's how we load both tables into R:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(readxl)}
\NormalTok{heatwave \textless{}{-}}\StringTok{  }\KeywordTok{read\_excel}\NormalTok{(}\DataTypeTok{path=}\StringTok{\textquotesingle{}data/eds.excel.sample.xlsx\textquotesingle{}}\NormalTok{, }\DataTypeTok{sheet =} \StringTok{\textquotesingle{}heatwave\textquotesingle{}}\NormalTok{)}
\NormalTok{hurricane \textless{}{-}}\StringTok{  }\KeywordTok{read\_excel}\NormalTok{(}\DataTypeTok{path=}\StringTok{\textquotesingle{}data/eds.excel.sample.xlsx\textquotesingle{}}\NormalTok{, }\DataTypeTok{sheet =} \StringTok{\textquotesingle{}hurricane\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Once the tables are stored into individual R variable, you can perform exploration and analysis with them.

\hypertarget{google-spreadsheets}{%
\section{Google Spreadsheets}\label{google-spreadsheets}}

If the data is stored in a Google spreadsheet, we can read it using the \texttt{googledrive} and \texttt{googlesheet4} packages. We use the \texttt{googledrive} package to log into our Google Drive account and \texttt{googlesheets4} to read the speadsheets in our drive.

In the example below, I used a spreadsheet named \texttt{eds.sample.googlesheets} which contains the same tables in the previous Excel example (heatwave and hurricane). You can clone the spreadsheet via this {[}link{]} (\url{https://drive.google.com/open?id=1uIsgrcsevbm9voZU-rzqhTg2LE5SgEPlGabSXKTcQtc} if you'd like to repeat the steps below using your Google account.

Then authenticate to your drive using \texttt{drive\_auth()}. When prompted: log in, authorized googledrive, and use the authorization code if provided. You only need to run \texttt{drive\_auth()} once.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(googledrive)}
\CommentTok{\# To authenticate and authorize googledrive package}
\KeywordTok{drive\_auth}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

The following scripts show how to explore a Google Drive folder. Though this is not recommended as you might encounter performance issues.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# NOT recommended}
\CommentTok{\# Then, to view the list of files in a folder}
\KeywordTok{drive\_ls}\NormalTok{(}\StringTok{"EDS"}\NormalTok{) }\CommentTok{\# where "EDS" is the folder name}
\CommentTok{\# To also get the files within the subfolders}
\KeywordTok{drive\_ls}\NormalTok{(}\StringTok{"EDS"}\NormalTok{, }\DataTypeTok{recursive =} \OtherTok{TRUE}\NormalTok{)}
\CommentTok{\# To view the list of spreadsheets within a folder}
\KeywordTok{drive\_ls}\NormalTok{(}\StringTok{"EDS"}\NormalTok{, }\DataTypeTok{type=}\StringTok{"spreadsheet"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Also, because of Google authentification system, you may run into an error like below when running the previous code (using \texttt{drive\_ls()}). Which is why it's not recommended.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\textgreater{} Error in add\_id\_path(nodes, root\_id = root\_id, leaf = leaf) : !anyDuplicated(nodes$id) is not TRUE}
\end{Highlighting}
\end{Shaded}

To avoid this, you can use the folder url instead of the folder name. The folder url can be obtained by right-clicking on the folder and click \texttt{Get\ shareable\ link}. Then run the following code:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# If using folder name doesn\textquotesingle{}t work}
\NormalTok{folder\_url =}\StringTok{ \textquotesingle{}https://drive.google.com/open?id=1e0uJ9dwFcL34JA61F0tGSoaiMZ\_xio\_4\textquotesingle{}}
\KeywordTok{drive\_ls}\NormalTok{(folder\_url, }\DataTypeTok{type=}\StringTok{"spreadsheet"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Then you can load the spreadsheet by using its \texttt{id}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eds.sample.spreadsheet \textless{}{-}}\StringTok{ }\KeywordTok{drive\_get}\NormalTok{(}\DataTypeTok{id =} \StringTok{\textquotesingle{}1uIsgrcsevbm9voZU{-}rzqhTg2LE5SgEPlGabSXKTcQtc\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

It also possible to read the spreadsheet right way by using its link / \texttt{path} (without using \texttt{drive\_ls()}). I recommend using this to read any Google Drive files.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eds.sample.spreadsheet \textless{}{-}}\StringTok{ }\KeywordTok{drive\_get}\NormalTok{(}\DataTypeTok{path =} \StringTok{\textquotesingle{}https://drive.google.com/open?id=1uIsgrcsevbm9voZU{-}rzqhTg2LE5SgEPlGabSXKTcQtc\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Once the spreadsheet is loaded, we run a similar code used for the Excel files to read tables within the spreadsheet. But for Google Sheets, function is called \texttt{read\_sheet}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(googlesheets4)}
\CommentTok{\# Authorizing the googlesheets4 package}
\KeywordTok{sheets\_auth}\NormalTok{(}\DataTypeTok{token=}\KeywordTok{drive\_token}\NormalTok{())}
\CommentTok{\# Reading the tables}
\NormalTok{heatwave \textless{}{-}}\StringTok{ }\KeywordTok{read\_sheet}\NormalTok{(eds.sample.spreadsheet, }\DataTypeTok{sheet =} \StringTok{\textquotesingle{}heatwave\textquotesingle{}}\NormalTok{)}
\NormalTok{hurricane \textless{}{-}}\StringTok{ }\KeywordTok{read\_sheet}\NormalTok{(eds.sample.spreadsheet, }\DataTypeTok{sheet =} \StringTok{\textquotesingle{}hurricane\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{spss}{%
\section{SPSS}\label{spss}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(haven)}
\NormalTok{data \textless{}{-}}\StringTok{ }\KeywordTok{read\_sav}\NormalTok{(}\StringTok{"data/eds.spss.sample.sav"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

By default, the \texttt{read\_sav()} will read the factor levels of non-numeric and non-character variables. If, instead, we want the labels, we can run the following code:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(magrittr)}
\KeywordTok{library}\NormalTok{(dplyr)}
\CommentTok{\# Applying haven::as\_factor() to labelled columns Here, we already know that}
\CommentTok{\# variables Zone, Q4 and Q50 are not factor variables.}
\NormalTok{data }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\OperatorTok{{-}}\NormalTok{Zone, }\OperatorTok{{-}}\NormalTok{Q4, }\OperatorTok{{-}}\NormalTok{Q50), as\_factor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1,130 x 9
##    Zone     Q4 Q5            Q6    Q7             Q10     Q50 Q51   Q59         
##    <chr> <dbl> <fct>         <fct> <fct>          <fct> <dbl> <fct> <fct>       
##  1 A         2 3             0     Moderately Pr… No     1928 Male  $70,000-$99…
##  2 A         1 4             0     Moderately Pr… No     1962 Male  <NA>        
##  3 A         3 4             0     Moderately Pr… No     1931 Fema… Over $200,0…
##  4 A         3 6             1     Fully Prepared No     1950 Male  $100,000-$1…
##  5 A         2 Not Worried … 0     Very Prepared  No     1948 Male  $100,000-$1…
##  6 A         5 4             0     Very Prepared  No     1938 Fema… <NA>        
##  7 A         3 6             1     Moderately Pr… No     1977 Fema… <NA>        
##  8 A         5 4             0     Moderately Pr… No     1964 Fema… <NA>        
##  9 A         1 3             0     Moderately Pr… No     1976 Male  $40,000-$69…
## 10 A         2 6             0     Very Prepared  No     1964 Fema… Over $200,0…
## # … with 1,120 more rows
\end{verbatim}

Because variables can be labelled in SPSS, we can use them as well to find out what each column represents.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# To get the labels of the variables / columns}
\KeywordTok{as.vector}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{lapply}\NormalTok{(data, }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{attributes}\NormalTok{(x)}\OperatorTok{$}\NormalTok{label)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Q4. Since the beginning of 2009, how many hurricanes and tropical storms, if any, hit your city or town on or near the Connecticut coast while you were at home; that is, not out of town?"                                         
## [2] "Q5. Generally speaking, when a hurricane or tropical storm is approaching your city or town, how worried do you feel? Please answer using the following scale ranging from 1 (not at all worried) to 7 (extremely worried)."        
## [3] "Q6. Since the beginning of 2009, how many times, if ever, did you leave your home for someplace safer to avoid a hurricane or tropical storm; that is, how many times did you evacuate? Please enter the number in the boxes below."
## [4] "Q7. Generally speaking, how prepared were you for the storm(s) you experienced?"                                                                                                                                                    
## [5] "Q10. Before Superstorm Sandy hit your area, did you leave your home to go someplace safer; that is, did you evacuate?"                                                                                                              
## [6] "Q50. In what year were you born?"                                                                                                                                                                                                   
## [7] "Q51. Are you...?"                                                                                                                                                                                                                   
## [8] "Q59. Last year (in 2013), what was your total HOUSEHOLD income from all sources?"
\end{verbatim}

To learn more about the \texttt{haven} package and how the variables are stored, please visit: \url{https://haven.tidyverse.org/}

\hypertarget{extraction}{%
\chapter{Extraction}\label{extraction}}

\hypertarget{web-scraping}{%
\section{Web Scraping}\label{web-scraping}}

Web scraping is the process of fetching and extracting information / data from a webpage. It is very useful if you want to create a dynamic database that updates based on the content of a specific website.

To scrap a webpage, we first need to know how to get to the webpage, a url that you can use to directly access the content. For example, to obtain the Google search results for ``data science'', you can simply copy and paste this url to your browser: \url{https://www.google.com/search?q=data+science}, without having to type ``data science'' on a Google search web page. Some websites like Twitter or Facebook will require to you to use an API and authenticate in order to access some of their data.

For this example, we're going to use The Weather Channel website which do not require autentification. We'll to extract the 10-day forecast for a specific location and store the data in a dataframe.

After inspecting the website and it's url, I have noticed that you can view the weather data by zip code using this url pattern:

\texttt{https://weather.com/weather/} + \texttt{forecast\ type} + \texttt{/l/} + \texttt{zip\_code} + \texttt{:4:US}

For example, if we want to view the 10-day forecast for New Haven, we can go to: \url{https://weather.com/weather/tenday/l/06511:4:US}. And for today's forecast: \url{https://weather.com/weather/today/l/06511:4:US}

Once we have the webpage url, we can read it into R and extract the data using \texttt{rvest} from the \texttt{tidyverse} collection.

The New Haven 10-day forecast webpage looks like this:

\begin{figure}
\centering
\includegraphics{images/weatherpage.png}
\caption{weatherpage}
\end{figure}

Basically, what we want is the table that has the weather information. In order to extract the values that we want, we have to know where in the source code they are located. For example, in the ``DAY'' column, we want to extract the \texttt{exact\ date} instead of the \texttt{days\ of\ the\ week}. And we can do that by:

\begin{itemize}
\tightlist
\item
  inspecting the tag or class of exact date from the website. Move the cursor to the exact date, right-click, then choose \texttt{Inspect}
\item
  then, a window will open, which will point directly to the location of the \texttt{exact\ date} in the source code. Take notes of the css (tag or class name), and use it to get the \texttt{exact\ date} value using the \texttt{html\_nodes()} function.
\end{itemize}

\begin{figure}
\centering
\includegraphics{images/webcss.png}
\caption{weatherpage}
\end{figure}

Here is how we extract the dates:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(rvest)}
\CommentTok{\# Get the webpage url}
\NormalTok{url =}\StringTok{ \textquotesingle{}https://weather.com/weather/tenday/l/06511:4:US\textquotesingle{}}
\CommentTok{\# Load the webpage using the url}
\NormalTok{webpage \textless{}{-}}\StringTok{ }\KeywordTok{read\_html}\NormalTok{(url)}

\CommentTok{\# Getting the exact date}
\CommentTok{\# Filtering the relevant css / location}
\NormalTok{date\_locations \textless{}{-}}\StringTok{ }\KeywordTok{html\_nodes}\NormalTok{(webpage, }\StringTok{"span.day{-}detail.clearfix"}\NormalTok{)}
\CommentTok{\# Extracting the exact value}
\NormalTok{raw\_date \textless{}{-}}\StringTok{ }\KeywordTok{html\_text}\NormalTok{(date\_locations)}
\NormalTok{raw\_date}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "APR 8"  "APR 9"  "APR 10" "APR 11" "APR 12" "APR 13" "APR 14" "APR 15"
##  [9] "APR 16" "APR 17" "APR 18" "APR 19" "APR 20" "APR 21" "APR 22"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Because the value are formatted like "NOV 21" we have to convert to a date format}
\NormalTok{exact\_date \textless{}{-}}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(raw\_date, }\DataTypeTok{format=}\StringTok{"\%b \%d"}\NormalTok{) }\CommentTok{\# b = month, d = day}
\NormalTok{exact\_date}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "2020-04-08" "2020-04-09" "2020-04-10" "2020-04-11" "2020-04-12"
##  [6] "2020-04-13" "2020-04-14" "2020-04-15" "2020-04-16" "2020-04-17"
## [11] "2020-04-18" "2020-04-19" "2020-04-20" "2020-04-21" "2020-04-22"
\end{verbatim}

And here is the full code that extract the complete table:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(rvest)}
\CommentTok{\# Get the webpage url}
\NormalTok{url =}\StringTok{ \textquotesingle{}https://weather.com/weather/tenday/l/06511:4:US\textquotesingle{}}
\CommentTok{\# Load the webpage using the url}
\NormalTok{webpage \textless{}{-}}\StringTok{ }\KeywordTok{read\_html}\NormalTok{(url)}

\CommentTok{\# Getting the exact date}
\CommentTok{\# Filtering the relevant css / location}
\NormalTok{date\_locations \textless{}{-}}\StringTok{ }\KeywordTok{html\_nodes}\NormalTok{(webpage, }\StringTok{"span.day{-}detail.clearfix"}\NormalTok{)}
\CommentTok{\# Extracting the exact value}
\NormalTok{raw\_date \textless{}{-}}\StringTok{ }\KeywordTok{html\_text}\NormalTok{(date\_locations)}
\CommentTok{\# Because the value are formatted like "Nov 21" we have to convert to a date format}
\NormalTok{exact\_date \textless{}{-}}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(raw\_date, }\DataTypeTok{format=}\StringTok{"\%b \%d"}\NormalTok{) }\CommentTok{\# b = month, d = day}

\CommentTok{\# Getting the weather description}
\NormalTok{desc\_loc \textless{}{-}}\StringTok{ }\KeywordTok{html\_nodes}\NormalTok{(webpage, }\StringTok{"td.description"}\NormalTok{)}
\NormalTok{desc \textless{}{-}}\StringTok{ }\KeywordTok{html\_text}\NormalTok{(desc\_loc)}

\CommentTok{\# Getting the temperature}
\NormalTok{temp\_loc \textless{}{-}}\StringTok{ }\KeywordTok{html\_nodes}\NormalTok{(webpage, }\StringTok{"td.temp"}\NormalTok{)}
\NormalTok{temp \textless{}{-}}\StringTok{ }\KeywordTok{html\_text}\NormalTok{(temp\_loc)}
\CommentTok{\# High and Low temperature values}
\NormalTok{high\_temp \textless{}{-}}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\OtherTok{NA}\NormalTok{, }\KeywordTok{length}\NormalTok{(temp))}
\NormalTok{low\_temp \textless{}{-}}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\OtherTok{NA}\NormalTok{, }\KeywordTok{length}\NormalTok{(temp))}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(temp))\{}
\NormalTok{all \textless{}{-}}\StringTok{ }\KeywordTok{unlist}\NormalTok{(}\KeywordTok{strsplit}\NormalTok{(temp[i], }\StringTok{"°"}\NormalTok{))}
\ControlFlowTok{if}\NormalTok{ (}\KeywordTok{length}\NormalTok{(all) }\OperatorTok{\textgreater{}}\StringTok{ }\DecValTok{1}\NormalTok{)\{}
\NormalTok{high\_temp[i] \textless{}{-}}\StringTok{ }\NormalTok{all[}\DecValTok{1}\NormalTok{]}
\NormalTok{low\_temp[i] \textless{}{-}}\StringTok{ }\NormalTok{all[}\DecValTok{2}\NormalTok{]}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{low\_temp[i] \textless{}{-}}\StringTok{ }\DecValTok{38}
\NormalTok{\}}
\NormalTok{\}}

\CommentTok{\# Getting the precipitation}
\NormalTok{precip\_loc \textless{}{-}}\StringTok{ }\KeywordTok{html\_nodes}\NormalTok{(webpage, }\StringTok{"td.precip"}\NormalTok{)}
\NormalTok{precip \textless{}{-}}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{sub}\NormalTok{(}\StringTok{"\%"}\NormalTok{, }\StringTok{""}\NormalTok{, }\KeywordTok{html\_text}\NormalTok{(precip\_loc))) }\OperatorTok{/}\StringTok{ }\DecValTok{100}

\CommentTok{\# Getting the wind}
\NormalTok{wind\_loc \textless{}{-}}\StringTok{ }\KeywordTok{html\_nodes}\NormalTok{(webpage, }\StringTok{"td.wind"}\NormalTok{)}
\NormalTok{wind \textless{}{-}}\StringTok{ }\KeywordTok{html\_text}\NormalTok{(wind\_loc)}
\CommentTok{\# Wind direction and speed}
\NormalTok{wind\_dir \textless{}{-}}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\OtherTok{NA}\NormalTok{, }\KeywordTok{length}\NormalTok{(wind))}
\NormalTok{wind\_speed \textless{}{-}}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\OtherTok{NA}\NormalTok{, }\KeywordTok{length}\NormalTok{(wind))}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(wind))\{}
\NormalTok{all \textless{}{-}}\StringTok{ }\KeywordTok{unlist}\NormalTok{(}\KeywordTok{strsplit}\NormalTok{(wind[i], }\StringTok{" "}\NormalTok{))}
\NormalTok{wind\_dir[i] \textless{}{-}}\StringTok{ }\NormalTok{all[}\DecValTok{1}\NormalTok{]}
\NormalTok{wind\_speed[i] \textless{}{-}}\StringTok{ }\NormalTok{all[}\DecValTok{2}\NormalTok{]}
\NormalTok{\}}

\CommentTok{\# Getting the humidity}
\NormalTok{humidity\_loc \textless{}{-}}\StringTok{ }\KeywordTok{html\_nodes}\NormalTok{(webpage, }\StringTok{"td.humidity"}\NormalTok{)}
\NormalTok{humidity \textless{}{-}}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{sub}\NormalTok{(}\StringTok{"\%"}\NormalTok{, }\StringTok{""}\NormalTok{, }\KeywordTok{html\_text}\NormalTok{(humidity\_loc))) }\OperatorTok{/}\StringTok{ }\DecValTok{100}

\CommentTok{\# Save the data in tibble}
\KeywordTok{library}\NormalTok{(tibble)}
\NormalTok{new\_haven\_forecast \textless{}{-}}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\StringTok{\textquotesingle{}day\textquotesingle{}}\NormalTok{ =}\StringTok{ }\NormalTok{exact\_date, }\StringTok{\textquotesingle{}description\textquotesingle{}}\NormalTok{ =}\StringTok{ }\NormalTok{desc,}
                        \StringTok{\textquotesingle{}high\_temp\textquotesingle{}}\NormalTok{ =}\StringTok{ }\NormalTok{high\_temp, }\StringTok{\textquotesingle{}low\_temp\textquotesingle{}}\NormalTok{ =}\StringTok{ }\NormalTok{low\_temp,}
                        \StringTok{\textquotesingle{}precip\textquotesingle{}}\NormalTok{ =}\StringTok{ }\NormalTok{precip, }\StringTok{\textquotesingle{}wind\_dir\textquotesingle{}}\NormalTok{ =}\StringTok{ }\NormalTok{wind\_dir,}
                        \StringTok{\textquotesingle{}wind\_speed\textquotesingle{}}\NormalTok{ =}\StringTok{ }\NormalTok{wind\_speed, }\StringTok{\textquotesingle{}himidity\textquotesingle{}}\NormalTok{ =}\StringTok{ }\NormalTok{humidity)}
\NormalTok{new\_haven\_forecast}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 15 x 8
##    day        description high_temp low_temp precip wind_dir wind_speed himidity
##    <date>     <chr>       <chr>     <chr>     <dbl> <chr>    <chr>         <dbl>
##  1 2020-04-08 Mostly Cle… <NA>      38          0.1 S        4             0.9  
##  2 2020-04-09 Thundersto… 59        39          1   S        18            0.81 
##  3 2020-04-10 Partly Clo… 50        38          0   WNW      21            0.47 
##  4 2020-04-11 Partly Clo… 52        35          0   WNW      16            0.41 
##  5 2020-04-12 Partly Clo… 57        50          0.1 SSE      13            0.53 
##  6 2020-04-13 Rain/Wind   64        48          0.9 S        21            0.82 
##  7 2020-04-14 Partly Clo… 58        41          0.2 WNW      10            0.55 
##  8 2020-04-15 Showers     51        38          0.4 NNW      9             0.53 
##  9 2020-04-16 Mostly Sun… 51        38          0.2 WNW      13            0.47 
## 10 2020-04-17 Partly Clo… 51        39          0.1 WNW      12            0.49 
## 11 2020-04-18 Showers     51        42          0.5 NE       11            0.59 
## 12 2020-04-19 Showers     56        43          0.4 WNW      12            0.59 
## 13 2020-04-20 Showers     56        43          0.4 WNW      13            0.580
## 14 2020-04-21 AM Showers  57        46          0.3 NW       11            0.56 
## 15 2020-04-22 Showers     59        48          0.5 WSW      11            0.61
\end{verbatim}

\hypertarget{structuring}{%
\chapter{Structuring}\label{structuring}}

Data structuring is the process of correcting or removing inaccurate records of a ``raw data'' so that, after the treatment, the transformed data will be easy to analyze and/or consistent with an existing dataset. More explicitly, the variable names, types, and values will be consistent and uniform. The focus here is on the `appearance' of the data.

\hypertarget{inspecting-the-data}{%
\section{Inspecting the data}\label{inspecting-the-data}}

In order to structure a dataset, first, we need to be able to detect the anomalies within the data. Types of anomalies include the values that are stored in the wrong format (ex: a number stored as a string), the values that fall outside of the expected range (ex: outliers), values with inconsistent patterns (ex: dates stored as mm/dd/year vs dd/mm/year), trailing spaces in strings (ex: ``data'' vs ``data''), etc.

One method of detecting these anomalies is the summary statistics of the variables, which can be obtained by using \texttt{summary()}. Here is an example using the hurricane data:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Structure of the data}
\KeywordTok{str}\NormalTok{(data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Classes 'tbl_df', 'tbl' and 'data.frame':    1130 obs. of  9 variables:
##  $ Zone: chr  "A" "A" "A" "A" ...
##   ..- attr(*, "format.spss")= chr "A9"
##   ..- attr(*, "display_width")= int 1
##  $ Q4  : num  2 1 3 3 2 5 3 5 1 2 ...
##   ..- attr(*, "label")= chr "Q4. Since the beginning of 2009, how many hurricanes and tropical storms, if any, hit your city or town on or n"| __truncated__
##   ..- attr(*, "format.spss")= chr "F2.0"
##   ..- attr(*, "display_width")= int 2
##  $ Q5  : 'haven_labelled' num  3 4 4 6 1 4 6 4 3 6 ...
##   ..- attr(*, "label")= chr "Q5. Generally speaking, when a hurricane or tropical storm is approaching your city or town, how worried do you"| __truncated__
##   ..- attr(*, "format.spss")= chr "F1.0"
##   ..- attr(*, "labels")= Named num  1 7
##   .. ..- attr(*, "names")= chr  "Not Worried At All" "Extremely Worried"
##  $ Q6  : num  0 0 0 1 0 0 1 0 0 0 ...
##   ..- attr(*, "label")= chr "Q6. Since the beginning of 2009, how many times, if ever, did you leave your home for someplace safer to avoid "| __truncated__
##   ..- attr(*, "format.spss")= chr "F2.0"
##   ..- attr(*, "display_width")= int 2
##  $ Q7  : 'haven_labelled' num  3 3 3 1 2 2 3 3 3 2 ...
##   ..- attr(*, "label")= chr "Q7. Generally speaking, how prepared were you for the storm(s) you experienced?"
##   ..- attr(*, "format.spss")= chr "F1.0"
##   ..- attr(*, "labels")= Named num  1 2 3 4 5
##   .. ..- attr(*, "names")= chr  "Fully Prepared" "Very Prepared" "Moderately Prepared" "A Little Prepared" ...
##  $ Q10 : 'haven_labelled' num  2 2 2 2 2 2 2 2 2 2 ...
##   ..- attr(*, "label")= chr "Q10. Before Superstorm Sandy hit your area, did you leave your home to go someplace safer; that is, did you evacuate?"
##   ..- attr(*, "format.spss")= chr "F1.0"
##   ..- attr(*, "labels")= Named num  1 2
##   .. ..- attr(*, "names")= chr  "Yes" "No"
##  $ Q50 : num  1928 1962 1931 1950 1948 ...
##   ..- attr(*, "label")= chr "Q50. In what year were you born?"
##   ..- attr(*, "format.spss")= chr "F4.0"
##  $ Q51 : 'haven_labelled' num  1 1 2 1 1 2 2 2 1 2 ...
##   ..- attr(*, "label")= chr "Q51. Are you...?"
##   ..- attr(*, "format.spss")= chr "F1.0"
##   ..- attr(*, "labels")= Named num  1 2
##   .. ..- attr(*, "names")= chr  "Male" "Female"
##  $ Q59 : 'haven_labelled' num  4 NA 6 5 5 NA NA NA 3 6 ...
##   ..- attr(*, "label")= chr "Q59. Last year (in 2013), what was your total HOUSEHOLD income from all sources?"
##   ..- attr(*, "format.spss")= chr "F1.0"
##   ..- attr(*, "display_width")= int 1
##   ..- attr(*, "labels")= Named num  1 2 3 4 5 6
##   .. ..- attr(*, "names")= chr  "Less than $15,000" "$15,000-$39,999" "$40,000-$69,999" "$70,000-$99,999" ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Summary for a numerical variables}
\KeywordTok{summary}\NormalTok{(data}\OperatorTok{$}\NormalTok{Q4)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##   0.000   2.000   2.000   2.537   3.000  20.000     134
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Summary for a categorical variable}
\KeywordTok{summary}\NormalTok{(}\KeywordTok{as\_factor}\NormalTok{(data}\OperatorTok{$}\NormalTok{Q7))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      Fully Prepared       Very Prepared Moderately Prepared   A Little Prepared 
##                  93                 326                 438                 137 
## Not at all Prepared                NA's 
##                  22                 114
\end{verbatim}

Other ways of exploring the data include:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# First 10 rows}
\KeywordTok{head}\NormalTok{(data, }\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 9
##    Zone     Q4           Q5    Q6           Q7     Q10   Q50     Q51         Q59
##    <chr> <dbl>    <dbl+lbl> <dbl>    <dbl+lbl> <dbl+l> <dbl> <dbl+l>   <dbl+lbl>
##  1 A         2 3                0 3 [Moderate…  2 [No]  1928 1 [Mal…  4 [$70,00…
##  2 A         1 4                0 3 [Moderate…  2 [No]  1962 1 [Mal… NA         
##  3 A         3 4                0 3 [Moderate…  2 [No]  1931 2 [Fem…  6 [Over $…
##  4 A         3 6                1 1 [Fully Pr…  2 [No]  1950 1 [Mal…  5 [$100,0…
##  5 A         2 1 [Not Worr…     0 2 [Very Pre…  2 [No]  1948 1 [Mal…  5 [$100,0…
##  6 A         5 4                0 2 [Very Pre…  2 [No]  1938 2 [Fem… NA         
##  7 A         3 6                1 3 [Moderate…  2 [No]  1977 2 [Fem… NA         
##  8 A         5 4                0 3 [Moderate…  2 [No]  1964 2 [Fem… NA         
##  9 A         1 3                0 3 [Moderate…  2 [No]  1976 1 [Mal…  3 [$40,00…
## 10 A         2 6                0 2 [Very Pre…  2 [No]  1964 2 [Fem…  6 [Over $…
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Last 10 rows}
\KeywordTok{tail}\NormalTok{(data, }\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 9
##    Zone     Q4      Q5    Q6             Q7      Q10   Q50      Q51          Q59
##    <chr> <dbl> <dbl+l> <dbl>      <dbl+lbl> <dbl+lb> <dbl> <dbl+lb>    <dbl+lbl>
##  1 B         1       2     0 4 [A Little P…  2 [No]   1980 1 [Male] 3 [$40,000-…
##  2 B         2       2     0 3 [Moderately…  2 [No]   1977 2 [Fema… 4 [$70,000-…
##  3 B         4       4     1 2 [Very Prepa…  1 [Yes]  1962 2 [Fema… 2 [$15,000-…
##  4 B         2       5     0 1 [Fully Prep…  2 [No]   1946 1 [Male] 5 [$100,000…
##  5 B        NA       4    NA 1 [Fully Prep…  1 [Yes]  1957 2 [Fema… 1 [Less tha…
##  6 B         1       4     1 4 [A Little P…  1 [Yes]  1987 2 [Fema… 6 [Over $20…
##  7 B         2       5     0 3 [Moderately…  2 [No]   1953 1 [Male] 4 [$70,000-…
##  8 B        NA       4     4 2 [Very Prepa…  2 [No]   1973 2 [Fema… 1 [Less tha…
##  9 B         2       5     0 3 [Moderately…  2 [No]   1980 1 [Male] 5 [$100,000…
## 10 B         2       2     0 4 [A Little P…  2 [No]     NA 2 [Fema… 3 [$40,000-…
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Total number of rows}
\KeywordTok{nrow}\NormalTok{(data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1130
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Total number of columns}
\KeywordTok{ncol}\NormalTok{(data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Column names}
\KeywordTok{names}\NormalTok{(data) }\CommentTok{\# also colnames(data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Zone" "Q4"   "Q5"   "Q6"   "Q7"   "Q10"  "Q50"  "Q51"  "Q59"
\end{verbatim}

We can also plot the data to visualize the distribution of variables

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Plotting the first 5 columns}
\KeywordTok{plot}\NormalTok{(data[,}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.8\linewidth]{edsy_files/figure-latex/inspecting-data-5-1}

While these plots could help in understanding the dataset, they could be misleading if the variables are not set to their correct data type.

\hypertarget{data-types}{%
\section{Data types}\label{data-types}}

One type of anomaly that we may also encounter is the coercion of irrelevant data types to a variables. This is very common for numerically coded variables or ones that has levels.

For example, if we read in the same SPSS data from the Reading data section, we get the coded values instead of the labels.

\begin{verbatim}
## # A tibble: 6 x 9
##   Zone     Q4           Q5    Q6           Q7     Q10   Q50     Q51          Q59
##   <chr> <dbl>    <dbl+lbl> <dbl>    <dbl+lbl> <dbl+l> <dbl> <dbl+l>    <dbl+lbl>
## 1 A         2 3                0 3 [Moderate…  2 [No]  1928 1 [Mal…  4 [$70,000…
## 2 A         1 4                0 3 [Moderate…  2 [No]  1962 1 [Mal… NA          
## 3 A         3 4                0 3 [Moderate…  2 [No]  1931 2 [Fem…  6 [Over $2…
## 4 A         3 6                1 1 [Fully Pr…  2 [No]  1950 1 [Mal…  5 [$100,00…
## 5 A         2 1 [Not Worr…     0 2 [Very Pre…  2 [No]  1948 1 [Mal…  5 [$100,00…
## 6 A         5 4                0 2 [Very Pre…  2 [No]  1938 2 [Fem… NA
\end{verbatim}

So if we run \texttt{summary(data)} right away then we'll get this unintended result:

\begin{verbatim}
##      Zone                 Q4               Q5              Q6        
##  Length:1130        Min.   : 0.000   Min.   :1.000   Min.   :0.0000  
##  Class :character   1st Qu.: 2.000   1st Qu.:3.000   1st Qu.:0.0000  
##  Mode  :character   Median : 2.000   Median :4.000   Median :0.0000  
##                     Mean   : 2.537   Mean   :4.235   Mean   :0.4191  
##                     3rd Qu.: 3.000   3rd Qu.:5.000   3rd Qu.:1.0000  
##                     Max.   :20.000   Max.   :7.000   Max.   :4.0000  
##                     NA's   :134      NA's   :111     NA's   :116     
##        Q7             Q10             Q50            Q51            Q59       
##  Min.   :1.000   Min.   :1.000   Min.   :  19   Min.   :1.00   Min.   :1.000  
##  1st Qu.:2.000   1st Qu.:2.000   1st Qu.:1944   1st Qu.:1.00   1st Qu.:3.000  
##  Median :3.000   Median :2.000   Median :1955   Median :2.00   Median :4.000  
##  Mean   :2.674   Mean   :1.796   Mean   :1944   Mean   :1.55   Mean   :3.715  
##  3rd Qu.:3.000   3rd Qu.:2.000   3rd Qu.:1966   3rd Qu.:2.00   3rd Qu.:5.000  
##  Max.   :5.000   Max.   :2.000   Max.   :1992   Max.   :2.00   Max.   :6.000  
##  NA's   :114     NA's   :123     NA's   :47     NA's   :38     NA's   :112
\end{verbatim}

\texttt{Q4} and \texttt{Q50} are the only variables that are supposed to be numeric. But here everything is treated as numeric which is incorrect. Also, it is best if we read \texttt{Zone} as factor as well so that we find out the possible values.

We can easily convert data types into factor using \texttt{dplyr::mutate\_at()} and applying \texttt{as.factor} function to the variables.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Converting data types}
\NormalTok{updated\_data \textless{}{-}}\StringTok{ }\NormalTok{data }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\OperatorTok{{-}}\NormalTok{Q4, }\OperatorTok{{-}}\NormalTok{Q6, }\OperatorTok{{-}}\NormalTok{Q50), as\_factor)}
\end{Highlighting}
\end{Shaded}

And now we can get the full summary statistics that we want:

\begin{verbatim}
##  Zone          Q4               Q5            Q6        
##  A:684   Min.   : 0.000   5      :244   Min.   :0.0000  
##  B:446   1st Qu.: 2.000   4      :211   1st Qu.:0.0000  
##          Median : 2.000   3      :169   Median :0.0000  
##          Mean   : 2.537   6      :129   Mean   :0.4191  
##          3rd Qu.: 3.000   2      :104   3rd Qu.:1.0000  
##          Max.   :20.000   (Other):162   Max.   :4.0000  
##          NA's   :134      NA's   :111   NA's   :116     
##                    Q7        Q10           Q50           Q51     
##  Fully Prepared     : 93   Yes :205   Min.   :  19   Male  :491  
##  Very Prepared      :326   No  :802   1st Qu.:1944   Female:601  
##  Moderately Prepared:438   NA's:123   Median :1955   NA's  : 38  
##  A Little Prepared  :137              Mean   :1944               
##  Not at all Prepared: 22              3rd Qu.:1966               
##  NA's               :114              Max.   :1992               
##                                       NA's   :47                 
##                 Q59     
##  Less than $15,000: 81  
##  $15,000-$39,999  :169  
##  $40,000-$69,999  :215  
##  $70,000-$99,999  :190  
##  $100,000-$199,999:220  
##  Over $200,000    :143  
##  NA's             :112
\end{verbatim}

As we can see from the summary, there might be some anomalies with the variables:

\begin{itemize}
\tightlist
\item
  \texttt{Zone}: as most of the respondents are from Zone A. But this is basically related to the survey method which would later require that some weighting of the variables would be applied.
\item
  \texttt{Q4:\ Number\ of\ storms\ experienced}: where the mean value is 2.5 but some response have the value of 20.
\item
  \texttt{Q50:\ Birth\ year}: where some respondent answered 19 which is incorrect. Also this column is probably better if it's in age instead of birth year.
\end{itemize}

We can also notice some missing values.

\hypertarget{subsetting-and-filtering}{%
\section{Subsetting and Filtering}\label{subsetting-and-filtering}}

We can remove incorrect or missing row values by using \texttt{dplyr::filter}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Removing rows where birth year is irrelevant}
\CommentTok{\# Here we decided that all birth year must be greater 1900}
\NormalTok{updated\_data \textless{}{-}}\StringTok{ }\NormalTok{data }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{filter}\NormalTok{(Q50 }\OperatorTok{\textgreater{}}\StringTok{ }\DecValTok{1900}\NormalTok{)}
\CommentTok{\# Now if we re{-}run its summary}
\KeywordTok{summary}\NormalTok{(updated\_data}\OperatorTok{$}\NormalTok{Q50)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    1908    1945    1955    1956    1966    1992
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Removing rows with birth year greater than 1900 and missing responses for Q4}
\NormalTok{updated\_data \textless{}{-}}\StringTok{ }\NormalTok{data }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{filter}\NormalTok{(Q50 }\OperatorTok{\textgreater{}}\StringTok{ }\DecValTok{1900}\NormalTok{, }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(Q4))}
\KeywordTok{summary}\NormalTok{(updated\_data}\OperatorTok{$}\NormalTok{Q50)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    1908    1944    1954    1955    1965    1990
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(updated\_data}\OperatorTok{$}\NormalTok{Q4)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   0.000   2.000   2.000   2.522   3.000  20.000
\end{verbatim}

We can also select only the variables that we are interested in using \texttt{dplyr::select}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Creating a new dataframe with only zone, gender, and income column}
\NormalTok{updated\_data \textless{}{-}}\StringTok{ }\NormalTok{data }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select}\NormalTok{(Zone, Q59, Q51)}
\KeywordTok{head}\NormalTok{(updated\_data, }\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 3
##    Zone  Q59               Q51   
##    <fct> <fct>             <fct> 
##  1 A     $70,000-$99,999   Male  
##  2 A     <NA>              Male  
##  3 A     Over $200,000     Female
##  4 A     $100,000-$199,999 Male  
##  5 A     $100,000-$199,999 Male  
##  6 A     <NA>              Female
##  7 A     <NA>              Female
##  8 A     <NA>              Female
##  9 A     $40,000-$69,999   Male  
## 10 A     Over $200,000     Female
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(}\KeywordTok{table}\NormalTok{(updated\_data), }\DataTypeTok{las=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{edsy_files/figure-latex/filtering-3-1.pdf}

It is also possible to split the dataset into multiple dataframe by number of rows using \texttt{split()}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# To split the dataset into multiple dataframe of 10 rows each}
\NormalTok{max\_number\_of\_rows\_per\_dataframe \textless{}{-}}\StringTok{ }\DecValTok{10}
\NormalTok{total\_number\_rows\_in\_the\_current\_dataset \textless{}{-}}\StringTok{ }\KeywordTok{nrow}\NormalTok{(data)}
\NormalTok{sets\_of\_10rows\_dataframes \textless{}{-}}\StringTok{ }\KeywordTok{split}\NormalTok{(data, }
                                   \KeywordTok{rep}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{ceiling}\NormalTok{(total\_number\_rows\_in\_the\_current\_dataset}\OperatorTok{/}\NormalTok{max\_number\_of\_rows\_per\_dataframe), }
                                       \DataTypeTok{each=}\NormalTok{max\_number\_of\_rows\_per\_dataframe, }
                                       \DataTypeTok{length.out=}\NormalTok{total\_number\_rows\_in\_the\_current\_dataset)}
\NormalTok{                                   )}
\CommentTok{\# Here are the first 2 dataframes}
\NormalTok{sets\_of\_10rows\_dataframes[[}\DecValTok{1}\NormalTok{]] }\CommentTok{\# or sets\_of\_10rows\_dataframes$\textasciigrave{}1\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 9
##    Zone     Q4 Q5               Q6 Q7             Q10     Q50 Q51   Q59         
##    <fct> <dbl> <fct>         <dbl> <fct>          <fct> <dbl> <fct> <fct>       
##  1 A         2 3                 0 Moderately Pr… No     1928 Male  $70,000-$99…
##  2 A         1 4                 0 Moderately Pr… No     1962 Male  <NA>        
##  3 A         3 4                 0 Moderately Pr… No     1931 Fema… Over $200,0…
##  4 A         3 6                 1 Fully Prepared No     1950 Male  $100,000-$1…
##  5 A         2 Not Worried …     0 Very Prepared  No     1948 Male  $100,000-$1…
##  6 A         5 4                 0 Very Prepared  No     1938 Fema… <NA>        
##  7 A         3 6                 1 Moderately Pr… No     1977 Fema… <NA>        
##  8 A         5 4                 0 Moderately Pr… No     1964 Fema… <NA>        
##  9 A         1 3                 0 Moderately Pr… No     1976 Male  $40,000-$69…
## 10 A         2 6                 0 Very Prepared  No     1964 Fema… Over $200,0…
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sets\_of\_10rows\_dataframes[[}\DecValTok{2}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 9
##    Zone     Q4 Q5               Q6 Q7             Q10     Q50 Q51   Q59         
##    <fct> <dbl> <fct>         <dbl> <fct>          <fct> <dbl> <fct> <fct>       
##  1 A         2 Extremely Wo…     2 Fully Prepared Yes    1937 Fema… <NA>        
##  2 A         3 5                 0 Very Prepared  No     1943 Male  $70,000-$99…
##  3 A         2 Extremely Wo…     0 Very Prepared  No     1954 Fema… $100,000-$1…
##  4 A         2 5                 0 Very Prepared  No     1959 Fema… $100,000-$1…
##  5 A         4 Not Worried …    NA Very Prepared  No     1936 Fema… Over $200,0…
##  6 A         1 3                 1 Moderately Pr… Yes    1963 Male  Over $200,0…
##  7 A         2 3                 1 Very Prepared  Yes    1950 Fema… $100,000-$1…
##  8 A         4 6                 0 Moderately Pr… No       NA <NA>  <NA>        
##  9 A         0 4                 0 Very Prepared  No     1941 Male  $100,000-$1…
## 10 A        NA <NA>             NA <NA>           <NA>   1952 Fema… $100,000-$1…
\end{verbatim}

\hypertarget{changing-cell-values}{%
\section{Changing cell values}\label{changing-cell-values}}

As we mentionned earlier, it is best if Q50 is stored as an age variable instead of the default birth year. \texttt{Q50} is a numeric variable and we can simply change it by using \texttt{dplyr::mutate()}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Replacing Q50 values to their age in 2020}
\NormalTok{updated\_data \textless{}{-}}\StringTok{ }\NormalTok{data }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Q50 =} \DecValTok{2020} \OperatorTok{{-}}\StringTok{ }\NormalTok{Q50)}
\KeywordTok{head}\NormalTok{(updated\_data, }\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 9
##    Zone     Q4 Q5               Q6 Q7             Q10     Q50 Q51   Q59         
##    <fct> <dbl> <fct>         <dbl> <fct>          <fct> <dbl> <fct> <fct>       
##  1 A         2 3                 0 Moderately Pr… No       92 Male  $70,000-$99…
##  2 A         1 4                 0 Moderately Pr… No       58 Male  <NA>        
##  3 A         3 4                 0 Moderately Pr… No       89 Fema… Over $200,0…
##  4 A         3 6                 1 Fully Prepared No       70 Male  $100,000-$1…
##  5 A         2 Not Worried …     0 Very Prepared  No       72 Male  $100,000-$1…
##  6 A         5 4                 0 Very Prepared  No       82 Fema… <NA>        
##  7 A         3 6                 1 Moderately Pr… No       43 Fema… <NA>        
##  8 A         5 4                 0 Moderately Pr… No       56 Fema… <NA>        
##  9 A         1 3                 0 Moderately Pr… No       44 Male  $40,000-$69…
## 10 A         2 6                 0 Very Prepared  No       56 Fema… Over $200,0…
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# It is also possible to leave Q50 untouched and store the results into a new column}
\NormalTok{updated\_data \textless{}{-}}\StringTok{ }\NormalTok{data }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{age =} \DecValTok{2020} \OperatorTok{{-}}\StringTok{ }\NormalTok{Q50)}
\KeywordTok{head}\NormalTok{(updated\_data, }\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 10
##    Zone     Q4 Q5             Q6 Q7           Q10     Q50 Q51   Q59          age
##    <fct> <dbl> <fct>       <dbl> <fct>        <fct> <dbl> <fct> <fct>      <dbl>
##  1 A         2 3               0 Moderately … No     1928 Male  $70,000-$…    92
##  2 A         1 4               0 Moderately … No     1962 Male  <NA>          58
##  3 A         3 4               0 Moderately … No     1931 Fema… Over $200…    89
##  4 A         3 6               1 Fully Prepa… No     1950 Male  $100,000-…    70
##  5 A         2 Not Worrie…     0 Very Prepar… No     1948 Male  $100,000-…    72
##  6 A         5 4               0 Very Prepar… No     1938 Fema… <NA>          82
##  7 A         3 6               1 Moderately … No     1977 Fema… <NA>          43
##  8 A         5 4               0 Moderately … No     1964 Fema… <NA>          56
##  9 A         1 3               0 Moderately … No     1976 Male  $40,000-$…    44
## 10 A         2 6               0 Very Prepar… No     1964 Fema… Over $200…    56
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(updated\_data}\OperatorTok{$}\NormalTok{age)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   28.00   54.00   65.00   64.14   75.00  112.00
\end{verbatim}

For a categorical variable, we use a different function \texttt{dplyr::recode\_factor()} or \texttt{dplyr::recode()}. We will apply this to \texttt{Q5} as we have noticed in the previous section that not all of its values were labelled from SPSS. Here is its summary:

\begin{verbatim}
## Not Worried At All                  2                  3                  4 
##                 58                101                164                197 
##                  5                  6  Extremely Worried               NA's 
##                232                123                 97                104
\end{verbatim}

Looking back at the questionnare, here is how it was phrased:

\includegraphics{images/q5.png}

Because the survey itself doesn't have labels, the recoding will be up to the user. Here we chose to remove replace the extreme values with 1 and 7. As mentionned in the documentation: \texttt{dplyr::recode()} will preserve the existing order of levels while changing the values, and \texttt{dplyr::recode\_factor()} will change the order of levels to match the order of replacements.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Recoding Q5}
\NormalTok{recoded.with.recode \textless{}{-}}\StringTok{ }\KeywordTok{recode}\NormalTok{(data}\OperatorTok{$}\NormalTok{Q5, }\StringTok{\textasciigrave{}}\DataTypeTok{Not Worried At All}\StringTok{\textasciigrave{}}\NormalTok{=}\StringTok{"1"}\NormalTok{, }\StringTok{\textasciigrave{}}\DataTypeTok{Extremely Worried}\StringTok{\textasciigrave{}}\NormalTok{=}\StringTok{"7"}\NormalTok{)}
\KeywordTok{summary}\NormalTok{(recoded.with.recode)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    1    2    3    4    5    6    7 NA's 
##   58  101  164  197  232  123   97  104
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{recoded.with.recode\_factor \textless{}{-}}\StringTok{ }\KeywordTok{recode\_factor}\NormalTok{(data}\OperatorTok{$}\NormalTok{Q5, }\StringTok{\textasciigrave{}}\DataTypeTok{Not Worried At All}\StringTok{\textasciigrave{}}\NormalTok{=}\StringTok{"1"}\NormalTok{, }\StringTok{\textasciigrave{}}\DataTypeTok{Extremely Worried}\StringTok{\textasciigrave{}}\NormalTok{=}\StringTok{"7"}\NormalTok{)}
\KeywordTok{summary}\NormalTok{(recoded.with.recode\_factor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    1    7    2    3    4    5    6 NA's 
##   58   97  101  164  197  232  123  104
\end{verbatim}

We can also change cell values without external libraries like \texttt{dplyr} by running the following code:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Add column age where the values are 2020 {-} Q50}
\NormalTok{data}\OperatorTok{$}\NormalTok{age \textless{}{-}}\StringTok{ }\DecValTok{2020} \OperatorTok{{-}}\StringTok{ }\NormalTok{data}\OperatorTok{$}\NormalTok{Q50}
\CommentTok{\# Replace Q5 with value "Not Worried At All" to "1"}
\NormalTok{data}\OperatorTok{$}\NormalTok{Q5[data}\OperatorTok{$}\NormalTok{Q5 }\OperatorTok{==}\StringTok{ "Not Worried At All"}\NormalTok{] \textless{}{-}}\StringTok{ }\DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in `[<-.factor`(`*tmp*`, data$Q5 == "Not Worried At All", value =
## structure(c(3L, : invalid factor level, NA generated
\end{verbatim}

\hypertarget{pivoting-the-dataset}{%
\section{Pivoting the dataset}\label{pivoting-the-dataset}}

In some cases, we may want to split a column based on values, or merge multiple columns into fewer columns. These process can be done using \texttt{tidyr} package. For example, to convert the dataframe into long-format with only \texttt{Zone}, \texttt{question}, and \texttt{value} as columns:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyr)}
\CommentTok{\# We have to pivot by variable type}
\CommentTok{\# Pivot longer for factor variables}
\NormalTok{pivoted.longer \textless{}{-}}\StringTok{ }\NormalTok{data }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{select\_if}\NormalTok{(is.factor) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{pivot\_longer}\NormalTok{(}\OperatorTok{{-}}\NormalTok{Zone, }\DataTypeTok{names\_to =} \StringTok{"question"}\NormalTok{, }\DataTypeTok{values\_to =} \StringTok{"value"}\NormalTok{)}
\NormalTok{pivoted.longer}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5,380 x 3
##    Zone  question value              
##    <fct> <chr>    <fct>              
##  1 A     Q5       3                  
##  2 A     Q7       Moderately Prepared
##  3 A     Q10      No                 
##  4 A     Q51      Male               
##  5 A     Q59      $70,000-$99,999    
##  6 A     Q5       4                  
##  7 A     Q7       Moderately Prepared
##  8 A     Q10      No                 
##  9 A     Q51      Male               
## 10 A     Q59      <NA>               
## # … with 5,370 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Then we can reshape it back to the original}
\NormalTok{pivoted.wider \textless{}{-}}\StringTok{ }\NormalTok{pivoted.longer }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(question) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{row =} \KeywordTok{row\_number}\NormalTok{()) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{pivot\_wider}\NormalTok{(}\DataTypeTok{names\_from =}\NormalTok{ question, }\DataTypeTok{values\_from =}\NormalTok{ value) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{{-}}\NormalTok{row)}
\NormalTok{pivoted.wider}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1,076 x 6
##    Zone  Q5    Q7                  Q10   Q51    Q59              
##    <fct> <fct> <fct>               <fct> <fct>  <fct>            
##  1 A     3     Moderately Prepared No    Male   $70,000-$99,999  
##  2 A     4     Moderately Prepared No    Male   <NA>             
##  3 A     4     Moderately Prepared No    Female Over $200,000    
##  4 A     6     Fully Prepared      No    Male   $100,000-$199,999
##  5 A     <NA>  Very Prepared       No    Male   $100,000-$199,999
##  6 A     4     Very Prepared       No    Female <NA>             
##  7 A     6     Moderately Prepared No    Female <NA>             
##  8 A     4     Moderately Prepared No    Female <NA>             
##  9 A     3     Moderately Prepared No    Male   $40,000-$69,999  
## 10 A     6     Very Prepared       No    Female Over $200,000    
## # … with 1,066 more rows
\end{verbatim}

\texttt{tidyr::spread()} and \texttt{tidyr::gather()} are the outdated equivalent of \texttt{tidyr::pivot\_wider()} and \texttt{tidyr::pivot\_longer()}.

To merge or split columns, we can use \texttt{tidyr::unite()} or \texttt{tidyr::separate()}. For example, to merge \texttt{Q7} and \texttt{Q10}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Creating a new column with responses from both Q7 and Q10}
\NormalTok{merged \textless{}{-}}\StringTok{ }\NormalTok{data }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{unite}\NormalTok{(}\StringTok{"Q7\_Q10"}\NormalTok{, Q7}\OperatorTok{:}\NormalTok{Q10, }\DataTypeTok{sep =} \StringTok{"\_\_"}\NormalTok{, }\DataTypeTok{remove =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{na.rm =} \OtherTok{FALSE}\NormalTok{)}
\NormalTok{merged}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1,076 x 9
##    Zone     Q4 Q5       Q6 Q7_Q10                 Q50 Q51   Q59              age
##    <fct> <dbl> <fct> <dbl> <chr>                <dbl> <fct> <fct>          <dbl>
##  1 A         2 3         0 Moderately Prepared…  1928 Male  $70,000-$99,9…    92
##  2 A         1 4         0 Moderately Prepared…  1962 Male  <NA>              58
##  3 A         3 4         0 Moderately Prepared…  1931 Fema… Over $200,000     89
##  4 A         3 6         1 Fully Prepared__No    1950 Male  $100,000-$199…    70
##  5 A         2 <NA>      0 Very Prepared__No     1948 Male  $100,000-$199…    72
##  6 A         5 4         0 Very Prepared__No     1938 Fema… <NA>              82
##  7 A         3 6         1 Moderately Prepared…  1977 Fema… <NA>              43
##  8 A         5 4         0 Moderately Prepared…  1964 Fema… <NA>              56
##  9 A         1 3         0 Moderately Prepared…  1976 Male  $40,000-$69,9…    44
## 10 A         2 6         0 Very Prepared__No     1964 Fema… Over $200,000     56
## # … with 1,066 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# To split it back}
\NormalTok{merged }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{separate}\NormalTok{(Q7\_Q10, }\KeywordTok{c}\NormalTok{(}\StringTok{"Q7"}\NormalTok{, }\StringTok{"Q10"}\NormalTok{), }\DataTypeTok{sep =} \StringTok{"\_\_"}\NormalTok{, }\DataTypeTok{remove =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1,076 x 10
##    Zone     Q4 Q5       Q6 Q7              Q10     Q50 Q51   Q59             age
##    <fct> <dbl> <fct> <dbl> <chr>           <chr> <dbl> <fct> <fct>         <dbl>
##  1 A         2 3         0 Moderately Pre… No     1928 Male  $70,000-$99,…    92
##  2 A         1 4         0 Moderately Pre… No     1962 Male  <NA>             58
##  3 A         3 4         0 Moderately Pre… No     1931 Fema… Over $200,000    89
##  4 A         3 6         1 Fully Prepared  No     1950 Male  $100,000-$19…    70
##  5 A         2 <NA>      0 Very Prepared   No     1948 Male  $100,000-$19…    72
##  6 A         5 4         0 Very Prepared   No     1938 Fema… <NA>             82
##  7 A         3 6         1 Moderately Pre… No     1977 Fema… <NA>             43
##  8 A         5 4         0 Moderately Pre… No     1964 Fema… <NA>             56
##  9 A         1 3         0 Moderately Pre… No     1976 Male  $40,000-$69,…    44
## 10 A         2 6         0 Very Prepared   No     1964 Fema… Over $200,000    56
## # … with 1,066 more rows
\end{verbatim}

\hypertarget{cleaning}{%
\chapter{Cleaning}\label{cleaning}}

Data cleaning is the process of getting the data ready for statistical analysis. In contrast to ``Structuring the data'' the target anomalies in this case are the varibale values such as missing values, outliers, distribution, etc.

\hypertarget{fixing-skewed-distribution}{%
\section{Fixing skewed distribution}\label{fixing-skewed-distribution}}

A data is skewed when it's distribution is not symetrical but rather distored on the left or right. Sometimes, to facilitate statistical analysis, we need to transform that skewed data so that it becomes normally distributed instead.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Example of skewed data}
\NormalTok{\{x \textless{}{-}}\StringTok{ }\NormalTok{data}\OperatorTok{$}\NormalTok{Q4}
\NormalTok{h \textless{}{-}}\StringTok{ }\KeywordTok{hist}\NormalTok{(x, }\DataTypeTok{breaks =} \DecValTok{20}\NormalTok{, }\DataTypeTok{col =} \StringTok{"grey"}\NormalTok{)}
\NormalTok{xfit \textless{}{-}}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(x),}\KeywordTok{max}\NormalTok{(x),}\DataTypeTok{length=}\DecValTok{40}\NormalTok{)}
\NormalTok{yfit \textless{}{-}}\StringTok{ }\KeywordTok{dnorm}\NormalTok{(xfit,}\DataTypeTok{mean=}\KeywordTok{mean}\NormalTok{(x),}\DataTypeTok{sd=}\KeywordTok{sd}\NormalTok{(x))}
\NormalTok{yfit \textless{}{-}}\StringTok{ }\NormalTok{yfit}\OperatorTok{*}\KeywordTok{diff}\NormalTok{(h}\OperatorTok{$}\NormalTok{mids[}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{])}\OperatorTok{*}\KeywordTok{length}\NormalTok{(x)}
\KeywordTok{lines}\NormalTok{(xfit, yfit, }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{, }\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{)\}}
\end{Highlighting}
\end{Shaded}

\includegraphics{edsy_files/figure-latex/skewed-2-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Log{-}transformation}
\NormalTok{\{x \textless{}{-}}\StringTok{ }\KeywordTok{log}\NormalTok{(data}\OperatorTok{$}\NormalTok{Q4)}
\NormalTok{h \textless{}{-}}\StringTok{ }\KeywordTok{hist}\NormalTok{(x, }\DataTypeTok{breaks =} \DecValTok{10}\NormalTok{, }\DataTypeTok{col =} \StringTok{"grey"}\NormalTok{)\}}
\end{Highlighting}
\end{Shaded}

\includegraphics{edsy_files/figure-latex/skewed-2-2.pdf}

For \texttt{nstorm} and \texttt{nevac}, we can better investigate what's going on by actually visualizing them in a histogram using the \texttt{hist()} or \texttt{boxplot()}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)) }\CommentTok{\# 4 figures arranged in 2 rows and 2 columns}
\KeywordTok{hist}\NormalTok{(hurricane}\OperatorTok{$}\NormalTok{nstorm, }\DataTypeTok{breaks=}\DecValTok{10}\NormalTok{, }\DataTypeTok{xlab=}\StringTok{"Number of storms"}\NormalTok{, }\DataTypeTok{main=}\OtherTok{NA}\NormalTok{)}
\KeywordTok{boxplot}\NormalTok{(hurricane}\OperatorTok{$}\NormalTok{nstorm)}
\KeywordTok{hist}\NormalTok{(hurricane}\OperatorTok{$}\NormalTok{nevac, }\DataTypeTok{breaks=}\DecValTok{10}\NormalTok{, }\DataTypeTok{xlab=}\StringTok{"Number of evacuations"}\NormalTok{, }\DataTypeTok{main=}\OtherTok{NA}\NormalTok{)}
\KeywordTok{boxplot}\NormalTok{(hurricane}\OperatorTok{$}\NormalTok{nevac)}
\KeywordTok{mtext}\NormalTok{(}\StringTok{"How many storms have you experienced?"}\NormalTok{, }\DataTypeTok{side=}\DecValTok{3}\NormalTok{, }\DataTypeTok{outer=}\OtherTok{TRUE}\NormalTok{, }\DataTypeTok{line=}\OperatorTok{{-}}\DecValTok{2}\NormalTok{)}
\KeywordTok{mtext}\NormalTok{(}\StringTok{"How many times have you evacuated?"}\NormalTok{, }\DataTypeTok{side=}\DecValTok{3}\NormalTok{, }\DataTypeTok{outer=}\OtherTok{TRUE}\NormalTok{, }\DataTypeTok{line=}\OperatorTok{{-}}\DecValTok{16}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Using \texttt{select()}, \texttt{mutate()}, \texttt{filter()}, etc.

\hypertarget{fixing-outliers}{%
\section{Fixing outliers}\label{fixing-outliers}}

As we can see, both variables are not normally distributed but skewed. And there are several method of treating such variables based on the objective of the analysis: log-transformation, conversion to categorical variables, or simply removing the outliers, etc.

\hypertarget{fixing-missing-values}{%
\section{Fixing missing values}\label{fixing-missing-values}}

We can also notice from the summary above that the there are missing values (\texttt{NA}) as well. They can also be detected using \texttt{anyNA()}. And the best way to treat them is by removing all of the corresponding observations using \texttt{drop\_na()} from the \texttt{tidyr} package. Or, in some cases, removing the variable itself.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tidyr}\OperatorTok{::}\KeywordTok{drop\_na}\NormalTok{(hurricane)}
\end{Highlighting}
\end{Shaded}

However, if dropping all of the rows with missing values affect the quality of the data, then another option is to replace the missing values with the mean/median/mode of the variable or predict using an appropriate algorithm. There are several packages out there that are solely dedicated to treating missing values including \texttt{VIM} and \texttt{MICE}.

In this next example, we'll try to predict the 15 missing values in the variable \texttt{nstorm} (number of storms the survey respondents have experienced) using the variables that has no missing values: \texttt{zone}, \texttt{lat}, and \texttt{long}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Imputation using MICE}
\KeywordTok{library}\NormalTok{(mice)}

\CommentTok{\# Building the mice model}
\NormalTok{mice\_model \textless{}{-}}\StringTok{ }\KeywordTok{mice}\NormalTok{(}\KeywordTok{select}\NormalTok{(hurricane, zone, lat, long, nstorm), }\DataTypeTok{method=}\StringTok{"rf"}\NormalTok{) }\CommentTok{\# select() is from the dplyr package}
\CommentTok{\# Predicting the missing values}
\NormalTok{mice\_prediction \textless{}{-}}\StringTok{ }\KeywordTok{complete}\NormalTok{(mice\_model)  }\CommentTok{\# generate the completed data.}
\KeywordTok{anyNA}\NormalTok{(mice\_prediction)}
\end{Highlighting}
\end{Shaded}

Then we can visualize the data to see how well the imputation has performed. However, the best way to assess the accuracy is to compare actual values with predicted values using measures such as: \texttt{MSE}, \texttt{MAE}, \texttt{MAPE}, etc.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Visualizing the prediction}
\NormalTok{non\_na\_latitude \textless{}{-}}\StringTok{ }\NormalTok{hurricane}\OperatorTok{$}\NormalTok{lat[}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(hurricane}\OperatorTok{$}\NormalTok{nstorm)]}
\NormalTok{non\_na\_nstorm \textless{}{-}}\StringTok{ }\NormalTok{hurricane}\OperatorTok{$}\NormalTok{nstorm[}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(hurricane}\OperatorTok{$}\NormalTok{nstorm)]}
\NormalTok{na\_latitude \textless{}{-}}\StringTok{ }\NormalTok{mice\_prediction}\OperatorTok{$}\NormalTok{lat[}\KeywordTok{is.na}\NormalTok{(hurricane}\OperatorTok{$}\NormalTok{nstorm)]}
\NormalTok{na\_nstorm \textless{}{-}}\StringTok{ }\NormalTok{mice\_prediction}\OperatorTok{$}\NormalTok{nstorm[}\KeywordTok{is.na}\NormalTok{(hurricane}\OperatorTok{$}\NormalTok{nstorm)]}
\KeywordTok{plot}\NormalTok{(non\_na\_nstorm, non\_na\_latitude, }\DataTypeTok{col=}\StringTok{"grey"}\NormalTok{, }\DataTypeTok{pch=}\StringTok{"•"}\NormalTok{, }\DataTypeTok{ylab=}\StringTok{"Latitude"}\NormalTok{, }\DataTypeTok{xlab=}\StringTok{"Number of Storms Experienced"}\NormalTok{)}
\KeywordTok{points}\NormalTok{(na\_nstorm, na\_latitude, }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{, }\DataTypeTok{pch=}\StringTok{"•"}\NormalTok{, }\DataTypeTok{cex=}\DecValTok{2}\NormalTok{)}
\KeywordTok{legend}\NormalTok{(}\StringTok{"topright"}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\StringTok{"Existing values"}\NormalTok{, }\StringTok{"Predicted missing values"}\NormalTok{), }\DataTypeTok{col=}\KeywordTok{c}\NormalTok{(}\StringTok{"grey"}\NormalTok{, }\StringTok{"red"}\NormalTok{), }\DataTypeTok{pch=}\StringTok{"•"}\NormalTok{, }\DataTypeTok{cex=}\FloatTok{1.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{visualization}{%
\chapter{Visualization}\label{visualization}}

\hypertarget{simple-graph-with-ggplot2}{%
\section{\texorpdfstring{Simple graph with \texttt{ggplot2}}{Simple graph with ggplot2}}\label{simple-graph-with-ggplot2}}

\hypertarget{interactive-graph-with-plotly-and-gganimate}{%
\section{\texorpdfstring{Interactive graph with \texttt{plotly} and \texttt{gganimate}}{Interactive graph with plotly and gganimate}}\label{interactive-graph-with-plotly-and-gganimate}}

\hypertarget{web-app-with-rshiny}{%
\section{Web app with RShiny}\label{web-app-with-rshiny}}

\emph{This Shiny tutorial was edited based on the official tutorial on the \href{https://shiny.rstudio.com/tutorial/}{website}}

With RShiny, it is possible to make the functions in your R script available to people who don't necessarily know R. For example, in this \href{https://udwq.shinyapps.io/lakeprofiledashboard/}{app}, you can create different types of graph by selecting a site and other parameters. Basically, it's web development using the power of R libraries.

So, just like any web tools, an RshinyApp has components on the User and Server side.
\includegraphics{images/appStructure.png}

The visual appearance of the app can be modified in the user component. You can use it to change layout, font size, color, etc. Whereas on the server side, you can customize how your app responds to user inputs/interactions.

A basic \textbf{ShinyApp starter template} looks like this:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(shiny)}
\NormalTok{ui \textless{}{-}}\StringTok{ }\KeywordTok{fluidPage}\NormalTok{()}
\NormalTok{server \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(input, output)\{\}}
\KeywordTok{shinyApp}\NormalTok{(}\DataTypeTok{ui=}\NormalTok{ui, }\DataTypeTok{server=}\NormalTok{server)}
\end{Highlighting}
\end{Shaded}

If you run the script above, it will give you and empty page. Some content will show when you add some (text) elements with \texttt{fluidPage}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ui \textless{}{-}}\StringTok{ }\KeywordTok{fluidPage}\NormalTok{(}\StringTok{\textquotesingle{}Hello world\textquotesingle{}}\NormalTok{)}
\NormalTok{server \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(input, output)\{\}}
\KeywordTok{shinyApp}\NormalTok{(}\DataTypeTok{ui=}\NormalTok{ui, }\DataTypeTok{server=}\NormalTok{server)}
\end{Highlighting}
\end{Shaded}

\hypertarget{input-functions}{%
\subsection{Input functions}\label{input-functions}}

For richer content, the \texttt{shiny} package has built-in functions that will allow you create them. \texttt{sliderInput} for example adds a slider in your web app.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ui \textless{}{-}}\StringTok{ }\KeywordTok{fluidPage}\NormalTok{(}
  \KeywordTok{sliderInput}\NormalTok{(}\DataTypeTok{inputId=}\StringTok{\textquotesingle{}num\textquotesingle{}}\NormalTok{,}
              \DataTypeTok{label=}\StringTok{\textquotesingle{}Choose a number\textquotesingle{}}\NormalTok{,}
              \DataTypeTok{value=}\DecValTok{25}\NormalTok{, }\DataTypeTok{min=}\DecValTok{1}\NormalTok{, }\DataTypeTok{max=}\DecValTok{100}\NormalTok{)}
\NormalTok{)}
\NormalTok{server \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(input, output)\{\}}
\KeywordTok{shinyApp}\NormalTok{(}\DataTypeTok{ui=}\NormalTok{ui, }\DataTypeTok{server=}\NormalTok{server)}
\end{Highlighting}
\end{Shaded}

\texttt{sliderInput} is part of a group of function called \textbf{inputs}. These functions allow an Rshiny developper like yourself to add html element that will serve as user input. Here are some input functions you can try:
\includegraphics{images/inputFunctions.png}

All input functions take as first 2 arguments: \texttt{inputId} and \texttt{label}. \texttt{inputId} is an ID that R will use create the input element in a webpage and to reference it later. \texttt{label} is just a text that the user will see, describing what the input element is for. The rest of the arguments are function-specific.

\hypertarget{output-functions}{%
\subsection{Output functions}\label{output-functions}}

Output functions, on the other hand, allow you to add outputs of R into your web page. As you know, these outputs can be image, plot, table, text, etc. And there are specific output functions for each type of output.

\begin{figure}
\centering
\includegraphics{images/outputFunctions.png}
\caption{Rshiny output functions}
\end{figure}

Output functions are called similarly to the input functions:
\includegraphics{images/callOutputFunctions.png}

Here is our app with an output function:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ui \textless{}{-}}\StringTok{ }\KeywordTok{fluidPage}\NormalTok{(}
  \KeywordTok{sliderInput}\NormalTok{(}\DataTypeTok{inputId=}\StringTok{\textquotesingle{}num\textquotesingle{}}\NormalTok{,}
              \DataTypeTok{label=}\StringTok{\textquotesingle{}Choose a number\textquotesingle{}}\NormalTok{,}
              \DataTypeTok{value=}\DecValTok{25}\NormalTok{, }\DataTypeTok{min=}\DecValTok{1}\NormalTok{, }\DataTypeTok{max=}\DecValTok{100}\NormalTok{),}
  \KeywordTok{plotOutput}\NormalTok{(}\StringTok{\textquotesingle{}hist\textquotesingle{}}\NormalTok{)}
\NormalTok{)}
\NormalTok{server \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(input, output)\{\}}
\KeywordTok{shinyApp}\NormalTok{(}\DataTypeTok{ui=}\NormalTok{ui, }\DataTypeTok{server=}\NormalTok{server)}
\end{Highlighting}
\end{Shaded}

Running the previous script won't show any plot though. It just reserve a space in the webpage for plot with id: `hist'. To actually create the plot, you must use the server function.

\hypertarget{server-function}{%
\subsection{Server function}\label{server-function}}

Server function creates the interactivity in your web application, i.e.~this is where you set up how an output (ex: graph) chnages with the user input (ex: some number). However, there are 3 rules that has to be followed and it is summarized in this script:

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{function}\NormalTok{(input, output)\{}
  \CommentTok{\#1 outputId is the outputId you defined with output function}
  \CommentTok{\#2 to render on a webpage. To render a plot, use renderPlot()}
\NormalTok{  output}\OperatorTok{$}\NormalTok{outputId \textless{}{-}}\StringTok{ }\KeywordTok{renderSomething}\NormalTok{(\{}
    \CommentTok{\#3 inputId is the inputId you defined with input function}
    \KeywordTok{someFunction}\NormalTok{(input}\OperatorTok{$}\NormalTok{inputId)}
\NormalTok{  \})}
\NormalTok{\}}
\CommentTok{\# Anything inside the curly braces is an R code. And it can be multiple lines of code.}
\end{Highlighting}
\end{Shaded}

In summary, you must define output variable by the \texttt{outputId} and prefixing it with \texttt{output\$}. You must call the R script that will produce the output with a \texttt{render*(\{\})} function. And you must call the user input with its \texttt{inputId} and prefixing it with \texttt{input\$}.

In our example script, we can render it as follow:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ui \textless{}{-}}\StringTok{ }\KeywordTok{fluidPage}\NormalTok{(}
  \KeywordTok{sliderInput}\NormalTok{(}\DataTypeTok{inputId=}\StringTok{\textquotesingle{}num\textquotesingle{}}\NormalTok{,}
              \DataTypeTok{label=}\StringTok{\textquotesingle{}Choose a number\textquotesingle{}}\NormalTok{,}
              \DataTypeTok{value=}\DecValTok{25}\NormalTok{, }\DataTypeTok{min=}\DecValTok{1}\NormalTok{, }\DataTypeTok{max=}\DecValTok{100}\NormalTok{),}
  \KeywordTok{plotOutput}\NormalTok{(}\StringTok{\textquotesingle{}hist\textquotesingle{}}\NormalTok{)}
\NormalTok{)}
\NormalTok{server \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(input, output)\{}
\NormalTok{    output}\OperatorTok{$}\NormalTok{hist \textless{}{-}}\StringTok{ }\KeywordTok{renderPlot}\NormalTok{(\{}
\NormalTok{      title \textless{}{-}}\StringTok{ }\KeywordTok{paste}\NormalTok{(input}\OperatorTok{$}\NormalTok{num, }\StringTok{\textquotesingle{}random normal values\textquotesingle{}}\NormalTok{)}
      \KeywordTok{hist}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(input}\OperatorTok{$}\NormalTok{num), }\DataTypeTok{main=}\NormalTok{title, }\DataTypeTok{xlab=}\StringTok{\textquotesingle{}values\textquotesingle{}}\NormalTok{)}
\NormalTok{  \})}
\NormalTok{\}}
\KeywordTok{shinyApp}\NormalTok{(}\DataTypeTok{ui=}\NormalTok{ui, }\DataTypeTok{server=}\NormalTok{server)}
\end{Highlighting}
\end{Shaded}

To make much more advanced app, simply read the instructions on \href{https://shiny.rstudio.com/articles/}{Rshiny website}.

\hypertarget{sharing-your-app}{%
\subsection{Sharing your app}\label{sharing-your-app}}

Now you can create your own Shiny app. But for now you can only run it in your computer and no one else has access to it. To make available to the public:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Save the \texttt{ui} and \texttt{server} objects/scripts into a stand alone R script, name it \texttt{app.R}, and save it in a separate folder. You must name it \texttt{app.R} as that's the file that the server will look for when you deploy your app. For this example, I'd save this as \texttt{app.R}
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ui \textless{}{-}}\StringTok{ }\KeywordTok{fluidPage}\NormalTok{(}
  \KeywordTok{sliderInput}\NormalTok{(}\DataTypeTok{inputId=}\StringTok{\textquotesingle{}num\textquotesingle{}}\NormalTok{,}
              \DataTypeTok{label=}\StringTok{\textquotesingle{}Choose a number\textquotesingle{}}\NormalTok{,}
              \DataTypeTok{value=}\DecValTok{25}\NormalTok{, }\DataTypeTok{min=}\DecValTok{1}\NormalTok{, }\DataTypeTok{max=}\DecValTok{100}\NormalTok{),}
  \KeywordTok{plotOutput}\NormalTok{(}\StringTok{\textquotesingle{}hist\textquotesingle{}}\NormalTok{)}
\NormalTok{)}
\NormalTok{server \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(input, output)\{}
\NormalTok{    output}\OperatorTok{$}\NormalTok{hist \textless{}{-}}\StringTok{ }\KeywordTok{renderPlot}\NormalTok{(\{}
\NormalTok{      title \textless{}{-}}\StringTok{ }\KeywordTok{paste}\NormalTok{(input}\OperatorTok{$}\NormalTok{num, }\StringTok{\textquotesingle{}random normal values\textquotesingle{}}\NormalTok{)}
      \KeywordTok{hist}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(input}\OperatorTok{$}\NormalTok{num), }\DataTypeTok{main=}\NormalTok{title, }\DataTypeTok{xlab=}\StringTok{\textquotesingle{}values\textquotesingle{}}\NormalTok{)}
\NormalTok{  \})}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Go to \href{https://www.shinyapps.io}{shinyapps.io} and log in or sign for an account.
\item
  Now simply run the app on your computer
\item
  In the top right cover of R viewer window, there is a \texttt{Publish} button that you can use to publish your app.
\item
  Simply follow the instructions.
\end{enumerate}

\hypertarget{analysis}{%
\chapter{Analysis}\label{analysis}}

Example studies conducted by FES Professors.

\hypertarget{resources}{%
\chapter{Resources}\label{resources}}

Data

sea (fish vs phys), land (human, animal, plant, phys), air (compos), region
climate, weather
air quality
hydrology
water quality
earth quake data

Business and the Environment

Climate Change Science and Solutions

Ecosystems and Land Conservation and Management

Energy and the Environment

Environmental Policy Analysis

Forestry

Industrial Ecology and Green Chemistry

People, Equity, and the Environment

Urban

Water Resource Science and Management

Other

Yale Course Map

  \bibliography{book.bib,packages.bib}

\end{document}
