<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 7 Spatial data | EDS Vignettes</title>
  <meta name="description" content="Data science resources for FES Students" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 7 Spatial data | EDS Vignettes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Data science resources for FES Students" />
  <meta name="github-repo" content="rajaoberison/edsy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 7 Spatial data | EDS Vignettes" />
  
  <meta name="twitter:description" content="Data science resources for FES Students" />
  

<meta name="author" content="Andry Rajaoberison" />


<meta name="date" content="2020-06-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="visualization.html"/>
<link rel="next" href="analysis.html"/>
<script src="libs/header-attrs-2.2/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">FES EDS Tutorials</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="1" data-path="orientation.html"><a href="orientation.html"><i class="fa fa-check"></i><b>1</b> Orientation</a>
<ul>
<li class="chapter" data-level="1.1" data-path="orientation.html"><a href="orientation.html#downloading-r-studio"><i class="fa fa-check"></i><b>1.1</b> Downloading R-Studio</a></li>
<li class="chapter" data-level="1.2" data-path="orientation.html"><a href="orientation.html#your-work-space"><i class="fa fa-check"></i><b>1.2</b> Your Work Space</a></li>
<li class="chapter" data-level="1.3" data-path="orientation.html"><a href="orientation.html#helpful-tools-for-learning-more"><i class="fa fa-check"></i><b>1.3</b> Helpful Tools for Learning More</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reading.html"><a href="reading.html"><i class="fa fa-check"></i><b>2</b> Reading</a>
<ul>
<li class="chapter" data-level="2.1" data-path="reading.html"><a href="reading.html#explaining-working-directories"><i class="fa fa-check"></i><b>2.1</b> Explaining Working Directories</a></li>
<li class="chapter" data-level="2.2" data-path="reading.html"><a href="reading.html#loading-from-package-library"><i class="fa fa-check"></i><b>2.2</b> Loading from Package Library</a></li>
<li class="chapter" data-level="2.3" data-path="reading.html"><a href="reading.html#csv"><i class="fa fa-check"></i><b>2.3</b> CSV</a></li>
<li class="chapter" data-level="2.4" data-path="reading.html"><a href="reading.html#excel"><i class="fa fa-check"></i><b>2.4</b> Excel</a></li>
<li class="chapter" data-level="2.5" data-path="reading.html"><a href="reading.html#google-spreadsheets"><i class="fa fa-check"></i><b>2.5</b> Google Spreadsheets</a></li>
<li class="chapter" data-level="2.6" data-path="reading.html"><a href="reading.html#spss"><i class="fa fa-check"></i><b>2.6</b> SPSS</a></li>
<li class="chapter" data-level="2.7" data-path="reading.html"><a href="reading.html#rda"><i class="fa fa-check"></i><b>2.7</b> RDA</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="extraction.html"><a href="extraction.html"><i class="fa fa-check"></i><b>3</b> Extraction</a>
<ul>
<li class="chapter" data-level="3.1" data-path="extraction.html"><a href="extraction.html#web-scraping"><i class="fa fa-check"></i><b>3.1</b> Web Scraping</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="structuring.html"><a href="structuring.html"><i class="fa fa-check"></i><b>4</b> Structuring</a>
<ul>
<li class="chapter" data-level="4.1" data-path="structuring.html"><a href="structuring.html#accessing-data-in-r"><i class="fa fa-check"></i><b>4.1</b> Accessing Data in R</a></li>
<li class="chapter" data-level="4.2" data-path="structuring.html"><a href="structuring.html#data-types"><i class="fa fa-check"></i><b>4.2</b> Data types</a></li>
<li class="chapter" data-level="4.3" data-path="structuring.html"><a href="structuring.html#inspecting-the-data"><i class="fa fa-check"></i><b>4.3</b> Inspecting the data</a></li>
<li class="chapter" data-level="4.4" data-path="structuring.html"><a href="structuring.html#subsetting-and-filtering"><i class="fa fa-check"></i><b>4.4</b> Subsetting and Filtering</a></li>
<li class="chapter" data-level="4.5" data-path="structuring.html"><a href="structuring.html#changing-cell-values"><i class="fa fa-check"></i><b>4.5</b> Changing cell values</a></li>
<li class="chapter" data-level="4.6" data-path="structuring.html"><a href="structuring.html#pivoting-the-dataset"><i class="fa fa-check"></i><b>4.6</b> Pivoting the dataset</a></li>
<li class="chapter" data-level="4.7" data-path="structuring.html"><a href="structuring.html#merging-two-dataframes"><i class="fa fa-check"></i><b>4.7</b> Merging Two Dataframes</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="cleaning.html"><a href="cleaning.html"><i class="fa fa-check"></i><b>5</b> Cleaning</a>
<ul>
<li class="chapter" data-level="5.1" data-path="cleaning.html"><a href="cleaning.html#fixing-skewed-distribution"><i class="fa fa-check"></i><b>5.1</b> Fixing skewed distribution</a></li>
<li class="chapter" data-level="5.2" data-path="cleaning.html"><a href="cleaning.html#treating-outliers"><i class="fa fa-check"></i><b>5.2</b> Treating outliers</a></li>
<li class="chapter" data-level="5.3" data-path="cleaning.html"><a href="cleaning.html#fixing-missing-values"><i class="fa fa-check"></i><b>5.3</b> Fixing missing values</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>6</b> Visualization</a>
<ul>
<li class="chapter" data-level="6.1" data-path="visualization.html"><a href="visualization.html#simple-graphs-with-ggplot2"><i class="fa fa-check"></i><b>6.1</b> Simple graphs with <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="visualization.html"><a href="visualization.html#setting-ggplot2-theme"><i class="fa fa-check"></i><b>6.1.1</b> Setting <code>ggplot2</code> theme</a></li>
<li class="chapter" data-level="6.1.2" data-path="visualization.html"><a href="visualization.html#ggplot2-example-1-stacked-bar-plot"><i class="fa fa-check"></i><b>6.1.2</b> <code>ggplot2</code> Example 1: Stacked bar plot</a></li>
<li class="chapter" data-level="6.1.3" data-path="visualization.html"><a href="visualization.html#ggplot2-example-2-grouped-bar-plot"><i class="fa fa-check"></i><b>6.1.3</b> <code>ggplot2</code> Example 2: Grouped bar plot</a></li>
<li class="chapter" data-level="6.1.4" data-path="visualization.html"><a href="visualization.html#ggplot2-example-3-scatterplot"><i class="fa fa-check"></i><b>6.1.4</b> <code>ggplot2</code> Example 3: Scatterplot</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="visualization.html"><a href="visualization.html#animated-graph-with-gganimate"><i class="fa fa-check"></i><b>6.2</b> Animated graph with <code>gganimate</code></a></li>
<li class="chapter" data-level="6.3" data-path="visualization.html"><a href="visualization.html#interactive-graph-with-plotly"><i class="fa fa-check"></i><b>6.3</b> Interactive graph with <code>plotly</code></a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="visualization.html"><a href="visualization.html#plotly-example-1-interactive-version-of-the-stacked-bar"><i class="fa fa-check"></i><b>6.3.1</b> <code>plotly</code> Example 1: Interactive version of the stacked bar</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="visualization.html"><a href="visualization.html#web-app-with-rshiny"><i class="fa fa-check"></i><b>6.4</b> Web app with RShiny</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="visualization.html"><a href="visualization.html#input-functions"><i class="fa fa-check"></i><b>6.4.1</b> Input functions</a></li>
<li class="chapter" data-level="6.4.2" data-path="visualization.html"><a href="visualization.html#output-functions"><i class="fa fa-check"></i><b>6.4.2</b> Output functions</a></li>
<li class="chapter" data-level="6.4.3" data-path="visualization.html"><a href="visualization.html#server-function"><i class="fa fa-check"></i><b>6.4.3</b> Server function</a></li>
<li class="chapter" data-level="6.4.4" data-path="visualization.html"><a href="visualization.html#sharing-your-app"><i class="fa fa-check"></i><b>6.4.4</b> Sharing your app</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="visualization.html"><a href="visualization.html#more-data-visualization-resources"><i class="fa fa-check"></i><b>6.5</b> More data visualization resources</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="spatial.html"><a href="spatial.html"><i class="fa fa-check"></i><b>7</b> Spatial data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="spatial.html"><a href="spatial.html#importing-spatial-data"><i class="fa fa-check"></i><b>7.1</b> Importing spatial data</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="spatial.html"><a href="spatial.html#reading-shapefile"><i class="fa fa-check"></i><b>7.1.1</b> Reading shapefile</a></li>
<li class="chapter" data-level="7.1.2" data-path="spatial.html"><a href="spatial.html#reading-raster"><i class="fa fa-check"></i><b>7.1.2</b> Reading raster</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="spatial.html"><a href="spatial.html#processing"><i class="fa fa-check"></i><b>7.2</b> Processing</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="spatial.html"><a href="spatial.html#creating-point-data"><i class="fa fa-check"></i><b>7.2.1</b> Creating point data</a></li>
<li class="chapter" data-level="7.2.2" data-path="spatial.html"><a href="spatial.html#joining-with-another-dataframe"><i class="fa fa-check"></i><b>7.2.2</b> Joining with another dataframe</a></li>
<li class="chapter" data-level="7.2.3" data-path="spatial.html"><a href="spatial.html#spatial-joining"><i class="fa fa-check"></i><b>7.2.3</b> Spatial joining</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="spatial.html"><a href="spatial.html#some-visualization-examples"><i class="fa fa-check"></i><b>7.3</b> Some Visualization Examples</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="spatial.html"><a href="spatial.html#plotting-charcoal-data"><i class="fa fa-check"></i><b>7.3.1</b> Plotting charcoal data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>8</b> Analysis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="analysis.html"><a href="analysis.html#working-with-survey-data"><i class="fa fa-check"></i><b>8.1</b> Working with survey data</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="analysis.html"><a href="analysis.html#variable-standardization"><i class="fa fa-check"></i><b>8.1.1</b> Variable Standardization</a></li>
<li class="chapter" data-level="8.1.2" data-path="analysis.html"><a href="analysis.html#sample-weighting"><i class="fa fa-check"></i><b>8.1.2</b> Sample weighting</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="analysis.html"><a href="analysis.html#working-with-covid-19-data"><i class="fa fa-check"></i><b>8.2</b> Working with COVID-19 data</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>9</b> Resources</a>
<ul>
<li class="chapter" data-level="9.1" data-path="resources.html"><a href="resources.html#data"><i class="fa fa-check"></i><b>9.1</b> Data</a></li>
<li class="chapter" data-level="9.2" data-path="resources.html"><a href="resources.html#eds-course-map"><i class="fa fa-check"></i><b>9.2</b> EDS Course Map</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">EDS Vignettes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatial" class="section level1" number="7">
<h1><span class="header-section-number">Section 7</span> Spatial data</h1>
<p>Spatial data refers to any dataset that associates specific recorded values with a unique region of space. This can be latitude/longitude, state or city name, country, or any other spatial information.</p>
<p>In R, spatial data comes in a variety of formats. Amongst the most common are shapefiles, geodatabases, and geojson files. All of these data can be read and processed into a dataframe just like common data formats (csv, excel, etc.). However, we often have to use special libraries to do so. In addition, because of the nature of this data, spatial relationship operations can also be performed to join or create new features. Later in this tutorial, we will generate some examples using the <code>sf</code> and <code>raster</code> libraries to perform these analyses.</p>
<div id="importing-spatial-data" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Importing spatial data</h2>
<p>In this first section, we will use two libraries, ‘dplyr’ and ‘viridis’.</p>
<p>In general, the most common forms of geospatial data are <code>shapefiles</code> for vectors and <code>tiffs</code> for rasters. This tutorial will focus primarily on these 2 types of data and how to manipulate them.</p>
<div id="reading-shapefile" class="section level3" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Reading shapefile</h3>
<p>The shapefile format consists of at least 3 files: the main file (.shp), the index file (.shx), and the table file (.dbf). Sometimes there is also a projection file (.prj). Please visit <a href="https://www.loc.gov/preservation/digital/formats/fdd/fdd000280.shtml">this webpage</a> for more details on the distinctions and importance of each of these elements.</p>
<p>Because of this multi-file structure, it is good practice to save your shapefile in a folder or .zip file with its associated index file and table file. When reading the data into R, we can simply point to the <code>.shp</code> file in this folder and the code will know how to use the other files. In a similar way to how we read in csv files in the first page of instruction, we will use the sf() package to read the shapefile.</p>
<pre><code>## Linking to GEOS 3.7.2, GDAL 2.4.2, PROJ 5.2.0</code></pre>
<pre><code>## tibble [27,459 × 11] (S3: sf/tbl_df/tbl/data.frame)
##  $ ID        : int [1:27459] 1 2 3 4 5 6 7 8 9 10 ...
##  $ TSEVENT_ID: int [1:27459] 3 9 10 10 10 10 10 11 27 27 ...
##  $ YEAR      : int [1:27459] -1610 -479 -426 -426 -426 -426 -426 -373 142 142 ...
##  $ MONTH     : int [1:27459] NA NA 6 6 6 6 6 NA NA NA ...
##  $ DAY       : int [1:27459] NA NA NA NA NA NA NA NA NA NA ...
##  $ DATE_STRIN: chr [1:27459] &quot;-1610/??/??&quot; &quot;-0479/??/??&quot; &quot;-0426/06/??&quot; &quot;-0426/06/??&quot; ...
##  $ ARR_DAY   : int [1:27459] NA NA NA NA NA NA NA NA NA NA ...
##  $ ARR_HOUR  : int [1:27459] NA NA NA NA NA NA NA NA NA NA ...
##  $ ARR_MIN   : int [1:27459] NA NA NA NA NA NA NA NA NA NA ...
##  $ TRAV_HOURS: int [1:27459] NA NA NA NA NA NA NA NA NA NA ...
##  $ geometry  :sfc_POINT of length 27459; first list element:  &#39;XY&#39; num [1:2] 2782987 4232038
##  - attr(*, &quot;sf_column&quot;)= chr &quot;geometry&quot;
##  - attr(*, &quot;agr&quot;)= Factor w/ 3 levels &quot;constant&quot;,&quot;aggregate&quot;,..: NA NA NA NA NA NA NA NA NA NA
##   ..- attr(*, &quot;names&quot;)= chr [1:10] &quot;ID&quot; &quot;TSEVENT_ID&quot; &quot;YEAR&quot; &quot;MONTH&quot; ...</code></pre>
<p>When looking at the dataframe structure above, we see that the shapefile is processed similarly to how a regular dataframe is processed, except for the additional <code>geometry</code> field which contains the spatial information. If we want to view the data, it will show up much as a regular csv would, with rows representing observations and columns representing features.</p>
<p>If we want to plot this data, we can simply use the base <code>plot</code> function.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="spatial.html#cb148-1"></a><span class="co"># a plot of the first 4 columns</span></span>
<span id="cb148-2"><a href="spatial.html#cb148-2"></a><span class="co"># plotted as location</span></span>
<span id="cb148-3"><a href="spatial.html#cb148-3"></a><span class="kw">plot</span>(tsunami[, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="spatial.html#cb149-1"></a><span class="co"># a plot of only columns</span></span>
<span id="cb149-2"><a href="spatial.html#cb149-2"></a><span class="co"># plotted as values without geometry</span></span>
<span id="cb149-3"><a href="spatial.html#cb149-3"></a><span class="kw">plot</span>(tsunami<span class="op">$</span>DEATHS)</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-2-2.png" width="672" /></p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="spatial.html#cb150-1"></a><span class="kw">plot</span>(tsunami<span class="op">$</span>LONGITUDE, tsunami<span class="op">$</span>DIST_FROM_)</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-2-3.png" width="672" /></p>
<p>If you only want to plot the geometry (points):</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="spatial.html#cb151-1"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(tsunami))</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-3-1.png" width="672" /></p>
</div>
<div id="reading-raster" class="section level3" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Reading raster</h3>
<p>Raster <code>.tif</code> files can be imported with the <code>raster</code> library.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="spatial.html#cb152-1"></a><span class="kw">library</span>(raster)</span>
<span id="cb152-2"><a href="spatial.html#cb152-2"></a></span>
<span id="cb152-3"><a href="spatial.html#cb152-3"></a><span class="co"># Import the raster file</span></span>
<span id="cb152-4"><a href="spatial.html#cb152-4"></a>wind_jan &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&#39;data/wc2.1_10m_wind/wc2.1_10m_wind_01.tif&#39;</span>)</span>
<span id="cb152-5"><a href="spatial.html#cb152-5"></a></span>
<span id="cb152-6"><a href="spatial.html#cb152-6"></a><span class="co"># Plot the file</span></span>
<span id="cb152-7"><a href="spatial.html#cb152-7"></a><span class="kw">plot</span>(wind_jan)</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-4-1.png" width="672" /></p>
</div>
</div>
<div id="processing" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Processing</h2>
<div id="creating-point-data" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Creating point data</h3>
<p>This example shows how to convert data with latitude and longitude coordinates into a spatial dataframe. We’ll use the charcoal records from the <code>GCD</code> package as our field.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="spatial.html#cb153-1"></a><span class="kw">library</span>(GCD)</span>
<span id="cb153-2"><a href="spatial.html#cb153-2"></a><span class="kw">data</span>(<span class="st">&quot;paleofiresites&quot;</span>)</span>
<span id="cb153-3"><a href="spatial.html#cb153-3"></a>df.table &lt;-<span class="st"> </span>paleofiresites</span>
<span id="cb153-4"><a href="spatial.html#cb153-4"></a>wgs84crs &lt;-<span class="st"> </span><span class="dv">4269</span></span>
<span id="cb153-5"><a href="spatial.html#cb153-5"></a>sf.table &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(df.table, <span class="dt">coords=</span><span class="kw">c</span>(<span class="st">&#39;long&#39;</span>, <span class="st">&#39;lat&#39;</span>), <span class="dt">crs=</span>wgs84crs, <span class="dt">remove=</span>F)</span></code></pre></div>
<p>The code above helps us to access the data of charcoal records, save them into a dataframe, and use the st_as_sf() function to transform the data into a shapefile by encoding the ‘long’ and ‘lat’ columns as the coordinate pairs for each observation. We gave the argument remove=F so that the function would not then take these points out of the data, so that we can continue to see them.</p>
<p>By saving what was a regular dataframe as a shapefile, we can now see the difference in how plot() treats the data. Below we give two identical calls, one on the df.table object and the other on the transformed sf.table() object. What you will see is that the first call produces the usual matrix plot we expect when we ask plot() to look at multiple columns in a dataset. The second call gives us points plotted according to their geospatial coordinates. With a dataset large enough and broad enough, these data begin to resemble a global map:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="spatial.html#cb154-1"></a><span class="co"># non spatial data</span></span>
<span id="cb154-2"><a href="spatial.html#cb154-2"></a><span class="kw">plot</span>(df.table[,<span class="kw">c</span>(<span class="dv">7</span>,<span class="dv">11</span><span class="op">:</span><span class="dv">13</span>)])</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-6-1.png" width="672" /></p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="spatial.html#cb155-1"></a><span class="co"># spatial data</span></span>
<span id="cb155-2"><a href="spatial.html#cb155-2"></a><span class="kw">plot</span>(sf.table[,<span class="kw">c</span>(<span class="dv">7</span>,<span class="dv">11</span><span class="op">:</span><span class="dv">13</span>)])</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-6-2.png" width="672" /></p>
</div>
<div id="joining-with-another-dataframe" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Joining with another dataframe</h3>
<p>Oftentimes, we want to join non-spatial data with their geographic location. For example, if we have information on <a href="https://www.eia.gov/state/">energy production and consumption by state</a>, we can join it with a spatial feature for better visualization.</p>
<p>To do this, we use a function called ‘inner_join’, which is one of four possible types of joining. With an inner join, we only include the points from both datafiles that overlap. If you are curious about the distinctions between different types of joins, more information can be found towards the end of the ‘Structuring’ page earlier in our collection.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="spatial.html#cb156-1"></a><span class="co"># Get energy data</span></span>
<span id="cb156-2"><a href="spatial.html#cb156-2"></a>energy.data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/energy-by_state.csv&#39;</span>)</span>
<span id="cb156-3"><a href="spatial.html#cb156-3"></a></span>
<span id="cb156-4"><a href="spatial.html#cb156-4"></a><span class="co"># Use USABoundaries library to get US spatial data</span></span>
<span id="cb156-5"><a href="spatial.html#cb156-5"></a><span class="kw">library</span>(USAboundaries)</span>
<span id="cb156-6"><a href="spatial.html#cb156-6"></a>us.geo &lt;-<span class="st"> </span><span class="kw">us_states</span>(<span class="dt">resolution=</span><span class="st">&#39;low&#39;</span>)</span>
<span id="cb156-7"><a href="spatial.html#cb156-7"></a>joined.data &lt;-<span class="st"> </span>us.geo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inner_join</span>(energy.data, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;state_abbr&#39;</span>=<span class="st">&#39;State&#39;</span>))</span>
<span id="cb156-8"><a href="spatial.html#cb156-8"></a>joined.data.albers &lt;-<span class="st"> </span><span class="kw">st_transform</span>(joined.data, <span class="dt">crs=</span><span class="dv">5070</span>)</span>
<span id="cb156-9"><a href="spatial.html#cb156-9"></a></span>
<span id="cb156-10"><a href="spatial.html#cb156-10"></a><span class="co"># Plot the data</span></span>
<span id="cb156-11"><a href="spatial.html#cb156-11"></a><span class="kw">plot</span>(joined.data.albers[,<span class="st">&#39;Production..U.S..Share&#39;</span>])</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-7-1.png" width="672" /></p>
</div>
<div id="spatial-joining" class="section level3" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> Spatial joining</h3>
<p>If we look at the <code>paleofiresites</code> data, we can see that we do not have a US state corresponding to each point location. We can create this variable with a spatial join.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="spatial.html#cb157-1"></a><span class="co"># Get all paleo sites for the US</span></span>
<span id="cb157-2"><a href="spatial.html#cb157-2"></a>us.paleo &lt;-<span class="st"> </span>paleofiresites <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(country<span class="op">==</span><span class="st">&#39;USA&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb157-3"><a href="spatial.html#cb157-3"></a><span class="st">  </span><span class="kw">st_as_sf</span>(<span class="dt">coords=</span><span class="kw">c</span>(<span class="st">&#39;long&#39;</span>, <span class="st">&#39;lat&#39;</span>), <span class="dt">crs=</span>wgs84crs)</span>
<span id="cb157-4"><a href="spatial.html#cb157-4"></a></span>
<span id="cb157-5"><a href="spatial.html#cb157-5"></a><span class="co"># Set data to the same coordinate system</span></span>
<span id="cb157-6"><a href="spatial.html#cb157-6"></a>us.paleo.albers &lt;-<span class="st"> </span><span class="kw">st_transform</span>(us.paleo, <span class="dt">crs=</span><span class="dv">5070</span>)</span>
<span id="cb157-7"><a href="spatial.html#cb157-7"></a>us.geo.albers &lt;-<span class="st"> </span><span class="kw">st_transform</span>(us.geo, <span class="dt">crs=</span><span class="dv">5070</span>)</span>
<span id="cb157-8"><a href="spatial.html#cb157-8"></a></span>
<span id="cb157-9"><a href="spatial.html#cb157-9"></a><span class="co"># Perform a spatial join within</span></span>
<span id="cb157-10"><a href="spatial.html#cb157-10"></a>sp.join &lt;-<span class="st"> </span><span class="kw">st_join</span>(us.paleo.albers, us.geo.albers, <span class="dt">join=</span>st_within)</span>
<span id="cb157-11"><a href="spatial.html#cb157-11"></a></span>
<span id="cb157-12"><a href="spatial.html#cb157-12"></a><span class="co"># Produce the plot</span></span>
<span id="cb157-13"><a href="spatial.html#cb157-13"></a>{<span class="kw">plot</span>(<span class="kw">st_geometry</span>(us.geo.albers))</span>
<span id="cb157-14"><a href="spatial.html#cb157-14"></a><span class="kw">plot</span>(sp.join[, <span class="st">&#39;state_name&#39;</span>], <span class="dt">add=</span>T, <span class="dt">pch=</span><span class="dv">16</span>)}</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-8-1.png" width="672" /></p>
<p>For more information on what you can do with a vector file in R, please visit the <code>sf</code> <a href="https://r-spatial.github.io/sf/reference/index.html">library reference</a> or read the book <a href="https://geocompr.robinlovelace.net/">Geocomputation with R</a>.</p>
</div>
</div>
<div id="some-visualization-examples" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Some Visualization Examples</h2>
<p>Now that we have walked through how to read in, manipulate, and clean spatial data, we are going to run through a few key examples of visualization. Below we use the rnaturalearth() package, in coordination with the ggplot2() and ggrepel() libraries, to generate a few examplesm=, so that you can see the breadth of what plotting spatial data with R can accomplish.</p>
<div id="plotting-charcoal-data" class="section level3" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Plotting charcoal data</h3>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="spatial.html#cb158-1"></a><span class="co"># Get a world map from rnaturalearth library</span></span>
<span id="cb158-2"><a href="spatial.html#cb158-2"></a><span class="kw">library</span>(rnaturalearth)</span>
<span id="cb158-3"><a href="spatial.html#cb158-3"></a>world &lt;-<span class="st"> </span><span class="kw">ne_countries</span>(<span class="dt">scale=</span><span class="st">&#39;small&#39;</span>, <span class="dt">returnclass=</span><span class="st">&#39;sf&#39;</span>)</span>
<span id="cb158-4"><a href="spatial.html#cb158-4"></a></span>
<span id="cb158-5"><a href="spatial.html#cb158-5"></a><span class="co"># Project to robinson projection</span></span>
<span id="cb158-6"><a href="spatial.html#cb158-6"></a>sf.world.robin &lt;-<span class="st"> </span><span class="kw">st_transform</span>(world, <span class="dt">crs=</span><span class="st">&#39;+proj=robin&#39;</span>)</span>
<span id="cb158-7"><a href="spatial.html#cb158-7"></a></span>
<span id="cb158-8"><a href="spatial.html#cb158-8"></a><span class="co"># Use imported graticule data for viz</span></span>
<span id="cb158-9"><a href="spatial.html#cb158-9"></a>grat &lt;-<span class="st"> </span><span class="kw">st_geometry</span>(<span class="kw">read_sf</span>(<span class="st">&#39;data/ne_110m_graticules_all/ne_110m_wgs84_bounding_box.shp&#39;</span>))</span>
<span id="cb158-10"><a href="spatial.html#cb158-10"></a></span>
<span id="cb158-11"><a href="spatial.html#cb158-11"></a><span class="co"># Get data for paleo sites</span></span>
<span id="cb158-12"><a href="spatial.html#cb158-12"></a>paleosites &lt;-<span class="st"> </span>paleofiresites <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb158-13"><a href="spatial.html#cb158-13"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">site_name =</span> <span class="kw">trimws</span>(<span class="kw">as.character</span>(site_name))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb158-14"><a href="spatial.html#cb158-14"></a><span class="st">  </span><span class="kw">st_as_sf</span>(<span class="dt">coords=</span><span class="kw">c</span>(<span class="st">&#39;long&#39;</span>, <span class="st">&#39;lat&#39;</span>), <span class="dt">crs=</span><span class="dv">4326</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb158-15"><a href="spatial.html#cb158-15"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs=</span><span class="st">&#39;+proj=robin&#39;</span>)</span>
<span id="cb158-16"><a href="spatial.html#cb158-16"></a>newCoods &lt;-<span class="st"> </span><span class="kw">st_coordinates</span>(paleosites)</span>
<span id="cb158-17"><a href="spatial.html#cb158-17"></a>paleosites<span class="op">$</span>Lon &lt;-<span class="st"> </span>newCoods[,<span class="dv">1</span>]</span>
<span id="cb158-18"><a href="spatial.html#cb158-18"></a>paleosites<span class="op">$</span>Lat &lt;-<span class="st"> </span>newCoods[,<span class="dv">2</span>]</span>
<span id="cb158-19"><a href="spatial.html#cb158-19"></a></span>
<span id="cb158-20"><a href="spatial.html#cb158-20"></a><span class="co"># Set ggplot theme</span></span>
<span id="cb158-21"><a href="spatial.html#cb158-21"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb158-22"><a href="spatial.html#cb158-22"></a><span class="kw">library</span>(ggrepel)</span>
<span id="cb158-23"><a href="spatial.html#cb158-23"></a>ggTheme &lt;-<span class="st"> </span><span class="kw">theme</span>(</span>
<span id="cb158-24"><a href="spatial.html#cb158-24"></a>  <span class="dt">legend.position=</span><span class="st">&#39;none&#39;</span>,</span>
<span id="cb158-25"><a href="spatial.html#cb158-25"></a>  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb158-26"><a href="spatial.html#cb158-26"></a>  <span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb158-27"><a href="spatial.html#cb158-27"></a>  <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb158-28"><a href="spatial.html#cb158-28"></a>  <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill=</span><span class="st">&#39;#e6e8ed&#39;</span>),</span>
<span id="cb158-29"><a href="spatial.html#cb158-29"></a>  <span class="dt">panel.border =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb158-30"><a href="spatial.html#cb158-30"></a>  <span class="dt">axis.line =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb158-31"><a href="spatial.html#cb158-31"></a>  <span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb158-32"><a href="spatial.html#cb158-32"></a>  <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb158-33"><a href="spatial.html#cb158-33"></a>  <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb158-34"><a href="spatial.html#cb158-34"></a>  <span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb158-35"><a href="spatial.html#cb158-35"></a>  <span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb158-36"><a href="spatial.html#cb158-36"></a>  <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">22</span>)</span>
<span id="cb158-37"><a href="spatial.html#cb158-37"></a>)</span>
<span id="cb158-38"><a href="spatial.html#cb158-38"></a></span>
<span id="cb158-39"><a href="spatial.html#cb158-39"></a><span class="co"># Pick a few sites to be highlighted</span></span>
<span id="cb158-40"><a href="spatial.html#cb158-40"></a>selected.sites &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb158-41"><a href="spatial.html#cb158-41"></a>  <span class="st">&#39;Little Molas Lake&#39;</span>,<span class="st">&#39;Xindi&#39;</span>,<span class="st">&#39;Laguna Oprasa&#39;</span>,<span class="st">&#39;Morro de Itapeva&#39;</span>,</span>
<span id="cb158-42"><a href="spatial.html#cb158-42"></a>  <span class="st">&#39;Aracatuba&#39;</span>, <span class="st">&#39;Lago del Greppo&#39;</span>,<span class="st">&#39;Nursery Swamp&#39;</span>, <span class="st">&#39;Huguangyan Maar Lake&#39;</span></span>
<span id="cb158-43"><a href="spatial.html#cb158-43"></a>)</span>
<span id="cb158-44"><a href="spatial.html#cb158-44"></a></span>
<span id="cb158-45"><a href="spatial.html#cb158-45"></a><span class="co"># Complete the mapping</span></span>
<span id="cb158-46"><a href="spatial.html#cb158-46"></a>map &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>sf.world.robin) <span class="op">+</span></span>
<span id="cb158-47"><a href="spatial.html#cb158-47"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>grat, <span class="dt">fill=</span><span class="st">&#39;white&#39;</span>, <span class="dt">color=</span><span class="st">&#39;white&#39;</span>) <span class="op">+</span></span>
<span id="cb158-48"><a href="spatial.html#cb158-48"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">fill=</span><span class="st">&#39;#c1cdcd&#39;</span>, <span class="dt">size=</span>.<span class="dv">1</span>, <span class="dt">color=</span><span class="st">&#39;white&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb158-49"><a href="spatial.html#cb158-49"></a><span class="st">  </span><span class="kw">geom_point</span>(</span>
<span id="cb158-50"><a href="spatial.html#cb158-50"></a>    <span class="dt">data=</span>paleosites,</span>
<span id="cb158-51"><a href="spatial.html#cb158-51"></a>    <span class="kw">aes</span>(<span class="dt">x=</span>Lon, <span class="dt">y=</span>Lat), <span class="dt">color=</span><span class="st">&#39;#009ACD&#39;</span>,<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb158-52"><a href="spatial.html#cb158-52"></a><span class="st">  </span><span class="kw">geom_point</span>(</span>
<span id="cb158-53"><a href="spatial.html#cb158-53"></a>    <span class="dt">data=</span>paleosites <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(site_name <span class="op">%in%</span><span class="st"> </span>selected.sites),</span>
<span id="cb158-54"><a href="spatial.html#cb158-54"></a>    <span class="kw">aes</span>(<span class="dt">x=</span>Lon, <span class="dt">y=</span>Lat), <span class="dt">color=</span><span class="st">&#39;#FF0000&#39;</span>,<span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb158-55"><a href="spatial.html#cb158-55"></a><span class="st">  </span><span class="kw">geom_text_repel</span>(</span>
<span id="cb158-56"><a href="spatial.html#cb158-56"></a>    <span class="dt">data=</span>paleosites <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(site_name <span class="op">%in%</span><span class="st"> </span>selected.sites),</span>
<span id="cb158-57"><a href="spatial.html#cb158-57"></a>    <span class="kw">aes</span>(<span class="dt">x=</span>Lon, <span class="dt">y=</span>Lat, <span class="dt">label=</span>site_name),</span>
<span id="cb158-58"><a href="spatial.html#cb158-58"></a>    <span class="dt">color=</span><span class="st">&#39;#000000&#39;</span>,</span>
<span id="cb158-59"><a href="spatial.html#cb158-59"></a>    <span class="dt">size=</span><span class="dv">4</span>) <span class="op">+</span></span>
<span id="cb158-60"><a href="spatial.html#cb158-60"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">datum=</span><span class="kw">st_crs</span>(<span class="dv">54030</span>)) <span class="op">+</span></span>
<span id="cb158-61"><a href="spatial.html#cb158-61"></a><span class="st">  </span>ggTheme</span>
<span id="cb158-62"><a href="spatial.html#cb158-62"></a></span>
<span id="cb158-63"><a href="spatial.html#cb158-63"></a><span class="co"># Print the map</span></span>
<span id="cb158-64"><a href="spatial.html#cb158-64"></a>map</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-9-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="visualization.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rajaoberison/edsy/edit/master/07-spatial.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["edsy.pdf", "edsy.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
