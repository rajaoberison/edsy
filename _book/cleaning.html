<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 4 Cleaning | EDS Vignettes</title>
  <meta name="description" content="Data science resources for FES Students" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 4 Cleaning | EDS Vignettes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Data science resources for FES Students" />
  <meta name="github-repo" content="rajaoberison/edsy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 4 Cleaning | EDS Vignettes" />
  
  <meta name="twitter:description" content="Data science resources for FES Students" />
  

<meta name="author" content="Andry Rajaoberison" />


<meta name="date" content="2020-04-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="structuring.html"/>
<link rel="next" href="visualization.html"/>
<script src="libs/header-attrs-2.1/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">FES EDS Tutorials</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="1" data-path="reading.html"><a href="reading.html"><i class="fa fa-check"></i><b>1</b> Reading</a>
<ul>
<li class="chapter" data-level="1.1" data-path="reading.html"><a href="reading.html#csv"><i class="fa fa-check"></i><b>1.1</b> CSV</a></li>
<li class="chapter" data-level="1.2" data-path="reading.html"><a href="reading.html#excel"><i class="fa fa-check"></i><b>1.2</b> Excel</a></li>
<li class="chapter" data-level="1.3" data-path="reading.html"><a href="reading.html#google-spreadsheets"><i class="fa fa-check"></i><b>1.3</b> Google Spreadsheets</a></li>
<li class="chapter" data-level="1.4" data-path="reading.html"><a href="reading.html#spss"><i class="fa fa-check"></i><b>1.4</b> SPSS</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="extraction.html"><a href="extraction.html"><i class="fa fa-check"></i><b>2</b> Extraction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="extraction.html"><a href="extraction.html#web-scraping"><i class="fa fa-check"></i><b>2.1</b> Web Scraping</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="structuring.html"><a href="structuring.html"><i class="fa fa-check"></i><b>3</b> Structuring</a>
<ul>
<li class="chapter" data-level="3.1" data-path="structuring.html"><a href="structuring.html#inspecting-the-data"><i class="fa fa-check"></i><b>3.1</b> Inspecting the data</a></li>
<li class="chapter" data-level="3.2" data-path="structuring.html"><a href="structuring.html#data-types"><i class="fa fa-check"></i><b>3.2</b> Data types</a></li>
<li class="chapter" data-level="3.3" data-path="structuring.html"><a href="structuring.html#subsetting-and-filtering"><i class="fa fa-check"></i><b>3.3</b> Subsetting and Filtering</a></li>
<li class="chapter" data-level="3.4" data-path="structuring.html"><a href="structuring.html#changing-cell-values"><i class="fa fa-check"></i><b>3.4</b> Changing cell values</a></li>
<li class="chapter" data-level="3.5" data-path="structuring.html"><a href="structuring.html#pivoting-the-dataset"><i class="fa fa-check"></i><b>3.5</b> Pivoting the dataset</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cleaning.html"><a href="cleaning.html"><i class="fa fa-check"></i><b>4</b> Cleaning</a>
<ul>
<li class="chapter" data-level="4.1" data-path="cleaning.html"><a href="cleaning.html#fixing-skewed-distribution"><i class="fa fa-check"></i><b>4.1</b> Fixing skewed distribution</a></li>
<li class="chapter" data-level="4.2" data-path="cleaning.html"><a href="cleaning.html#fixing-outliers"><i class="fa fa-check"></i><b>4.2</b> Fixing outliers</a></li>
<li class="chapter" data-level="4.3" data-path="cleaning.html"><a href="cleaning.html#fixing-missing-values"><i class="fa fa-check"></i><b>4.3</b> Fixing missing values</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>5</b> Visualization</a>
<ul>
<li class="chapter" data-level="5.1" data-path="visualization.html"><a href="visualization.html#ggplot2"><i class="fa fa-check"></i><b>5.1</b> ggplot2</a></li>
<li class="chapter" data-level="5.2" data-path="visualization.html"><a href="visualization.html#plotly"><i class="fa fa-check"></i><b>5.2</b> plotly</a></li>
<li class="chapter" data-level="5.3" data-path="visualization.html"><a href="visualization.html#rshiny"><i class="fa fa-check"></i><b>5.3</b> RShiny</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>6</b> Analysis</a></li>
<li class="chapter" data-level="7" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>7</b> Resources</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">EDS Vignettes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cleaning" class="section level1" number="4">
<h1><span class="header-section-number">Section 4</span> Cleaning</h1>
<p>Data cleaning is the process of getting the data ready for statistical analysis. In contrast to “Structuring the data” the target anomalies in this case are the varibale values such as missing values, outliers, distribution, etc.</p>
<div id="fixing-skewed-distribution" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Fixing skewed distribution</h2>
<p>A data is skewed when it’s distribution is not symetrical but rather distored on the left or right. Sometimes, to facilitate statistical analysis, we need to transform that skewed data so that it becomes normally distributed instead.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="cleaning.html#cb80-1"></a><span class="co"># Example of skewed data</span></span>
<span id="cb80-2"><a href="cleaning.html#cb80-2"></a>{x &lt;-<span class="st"> </span>data<span class="op">$</span>Q4</span>
<span id="cb80-3"><a href="cleaning.html#cb80-3"></a>h &lt;-<span class="st"> </span><span class="kw">hist</span>(x, <span class="dt">breaks =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb80-4"><a href="cleaning.html#cb80-4"></a>xfit &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(x),<span class="kw">max</span>(x),<span class="dt">length=</span><span class="dv">40</span>)</span>
<span id="cb80-5"><a href="cleaning.html#cb80-5"></a>yfit &lt;-<span class="st"> </span><span class="kw">dnorm</span>(xfit,<span class="dt">mean=</span><span class="kw">mean</span>(x),<span class="dt">sd=</span><span class="kw">sd</span>(x))</span>
<span id="cb80-6"><a href="cleaning.html#cb80-6"></a>yfit &lt;-<span class="st"> </span>yfit<span class="op">*</span><span class="kw">diff</span>(h<span class="op">$</span>mids[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>])<span class="op">*</span><span class="kw">length</span>(x)</span>
<span id="cb80-7"><a href="cleaning.html#cb80-7"></a><span class="kw">lines</span>(xfit, yfit, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)}</span></code></pre></div>
<p><img src="edsy_files/figure-html/skewed-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="cleaning.html#cb81-1"></a><span class="co"># Log-transformation</span></span>
<span id="cb81-2"><a href="cleaning.html#cb81-2"></a>{x &lt;-<span class="st"> </span><span class="kw">log</span>(data<span class="op">$</span>Q4)</span>
<span id="cb81-3"><a href="cleaning.html#cb81-3"></a>h &lt;-<span class="st"> </span><span class="kw">hist</span>(x, <span class="dt">breaks =</span> <span class="dv">10</span>, <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>)}</span></code></pre></div>
<p><img src="edsy_files/figure-html/skewed-2-2.png" width="672" /></p>
<p>For <code>nstorm</code> and <code>nevac</code>, we can better investigate what’s going on by actually visualizing them in a histogram using the <code>hist()</code> or <code>boxplot()</code>.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="cleaning.html#cb82-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) <span class="co"># 4 figures arranged in 2 rows and 2 columns</span></span>
<span id="cb82-2"><a href="cleaning.html#cb82-2"></a><span class="kw">hist</span>(hurricane<span class="op">$</span>nstorm, <span class="dt">breaks=</span><span class="dv">10</span>, <span class="dt">xlab=</span><span class="st">&quot;Number of storms&quot;</span>, <span class="dt">main=</span><span class="ot">NA</span>)</span>
<span id="cb82-3"><a href="cleaning.html#cb82-3"></a><span class="kw">boxplot</span>(hurricane<span class="op">$</span>nstorm)</span>
<span id="cb82-4"><a href="cleaning.html#cb82-4"></a><span class="kw">hist</span>(hurricane<span class="op">$</span>nevac, <span class="dt">breaks=</span><span class="dv">10</span>, <span class="dt">xlab=</span><span class="st">&quot;Number of evacuations&quot;</span>, <span class="dt">main=</span><span class="ot">NA</span>)</span>
<span id="cb82-5"><a href="cleaning.html#cb82-5"></a><span class="kw">boxplot</span>(hurricane<span class="op">$</span>nevac)</span>
<span id="cb82-6"><a href="cleaning.html#cb82-6"></a><span class="kw">mtext</span>(<span class="st">&quot;How many storms have you experienced?&quot;</span>, <span class="dt">side=</span><span class="dv">3</span>, <span class="dt">outer=</span><span class="ot">TRUE</span>, <span class="dt">line=</span><span class="op">-</span><span class="dv">2</span>)</span>
<span id="cb82-7"><a href="cleaning.html#cb82-7"></a><span class="kw">mtext</span>(<span class="st">&quot;How many times have you evacuated?&quot;</span>, <span class="dt">side=</span><span class="dv">3</span>, <span class="dt">outer=</span><span class="ot">TRUE</span>, <span class="dt">line=</span><span class="op">-</span><span class="dv">16</span>)</span></code></pre></div>
<p>Using <code>select()</code>, <code>mutate()</code>, <code>filter()</code>, etc.</p>
</div>
<div id="fixing-outliers" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Fixing outliers</h2>
<p>As we can see, both variables are not normally distributed but skewed. And there are several method of treating such variables based on the objective of the analysis: log-transformation, conversion to categorical variables, or simply removing the outliers, etc.</p>
</div>
<div id="fixing-missing-values" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Fixing missing values</h2>
<p>We can also notice from the summary above that the there are missing values (<code>NA</code>) as well. They can also be detected using <code>anyNA()</code>. And the best way to treat them is by removing all of the corresponding observations using <code>drop_na()</code> from the <code>tidyr</code> package. Or, in some cases, removing the variable itself.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="cleaning.html#cb83-1"></a>tidyr<span class="op">::</span><span class="kw">drop_na</span>(hurricane)</span></code></pre></div>
<p>However, if dropping all of the rows with missing values affect the quality of the data, then another option is to replace the missing values with the mean/median/mode of the variable or predict using an appropriate algorithm. There are several packages out there that are solely dedicated to treating missing values including <code>VIM</code> and <code>MICE</code>.</p>
<p>In this next example, we’ll try to predict the 15 missing values in the variable <code>nstorm</code> (number of storms the survey respondents have experienced) using the variables that has no missing values: <code>zone</code>, <code>lat</code>, and <code>long</code>.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="cleaning.html#cb84-1"></a><span class="co"># Imputation using MICE</span></span>
<span id="cb84-2"><a href="cleaning.html#cb84-2"></a><span class="kw">library</span>(mice)</span>
<span id="cb84-3"><a href="cleaning.html#cb84-3"></a></span>
<span id="cb84-4"><a href="cleaning.html#cb84-4"></a><span class="co"># Building the mice model</span></span>
<span id="cb84-5"><a href="cleaning.html#cb84-5"></a>mice_model &lt;-<span class="st"> </span><span class="kw">mice</span>(<span class="kw">select</span>(hurricane, zone, lat, long, nstorm), <span class="dt">method=</span><span class="st">&quot;rf&quot;</span>) <span class="co"># select() is from the dplyr package</span></span>
<span id="cb84-6"><a href="cleaning.html#cb84-6"></a><span class="co"># Predicting the missing values</span></span>
<span id="cb84-7"><a href="cleaning.html#cb84-7"></a>mice_prediction &lt;-<span class="st"> </span><span class="kw">complete</span>(mice_model)  <span class="co"># generate the completed data.</span></span>
<span id="cb84-8"><a href="cleaning.html#cb84-8"></a><span class="kw">anyNA</span>(mice_prediction)</span></code></pre></div>
<p>Then we can visualize the data to see how well the imputation has performed. However, the best way to assess the accuracy is to compare actual values with predicted values using measures such as: <code>MSE</code>, <code>MAE</code>, <code>MAPE</code>, etc.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="cleaning.html#cb85-1"></a><span class="co"># Visualizing the prediction</span></span>
<span id="cb85-2"><a href="cleaning.html#cb85-2"></a>non_na_latitude &lt;-<span class="st"> </span>hurricane<span class="op">$</span>lat[<span class="op">!</span><span class="kw">is.na</span>(hurricane<span class="op">$</span>nstorm)]</span>
<span id="cb85-3"><a href="cleaning.html#cb85-3"></a>non_na_nstorm &lt;-<span class="st"> </span>hurricane<span class="op">$</span>nstorm[<span class="op">!</span><span class="kw">is.na</span>(hurricane<span class="op">$</span>nstorm)]</span>
<span id="cb85-4"><a href="cleaning.html#cb85-4"></a>na_latitude &lt;-<span class="st"> </span>mice_prediction<span class="op">$</span>lat[<span class="kw">is.na</span>(hurricane<span class="op">$</span>nstorm)]</span>
<span id="cb85-5"><a href="cleaning.html#cb85-5"></a>na_nstorm &lt;-<span class="st"> </span>mice_prediction<span class="op">$</span>nstorm[<span class="kw">is.na</span>(hurricane<span class="op">$</span>nstorm)]</span>
<span id="cb85-6"><a href="cleaning.html#cb85-6"></a><span class="kw">plot</span>(non_na_nstorm, non_na_latitude, <span class="dt">col=</span><span class="st">&quot;grey&quot;</span>, <span class="dt">pch=</span><span class="st">&quot;•&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Latitude&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Number of Storms Experienced&quot;</span>)</span>
<span id="cb85-7"><a href="cleaning.html#cb85-7"></a><span class="kw">points</span>(na_nstorm, na_latitude, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">pch=</span><span class="st">&quot;•&quot;</span>, <span class="dt">cex=</span><span class="dv">2</span>)</span>
<span id="cb85-8"><a href="cleaning.html#cb85-8"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;Existing values&quot;</span>, <span class="st">&quot;Predicted missing values&quot;</span>), <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;grey&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="dt">pch=</span><span class="st">&quot;•&quot;</span>, <span class="dt">cex=</span><span class="fl">1.5</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="structuring.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualization.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/04-cleaning.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["edsy.pdf", "edsy.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
