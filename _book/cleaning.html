<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 5 Cleaning | EDS Vignettes</title>
  <meta name="description" content="Data science resources for FES Students" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 5 Cleaning | EDS Vignettes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Data science resources for FES Students" />
  <meta name="github-repo" content="rajaoberison/edsy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 5 Cleaning | EDS Vignettes" />
  
  <meta name="twitter:description" content="Data science resources for FES Students" />
  

<meta name="author" content="Andry Rajaoberison" />


<meta name="date" content="2020-06-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="structuring.html"/>
<link rel="next" href="visualization.html"/>
<script src="libs/header-attrs-2.2/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">FES EDS Tutorials</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="1" data-path="orientation.html"><a href="orientation.html"><i class="fa fa-check"></i><b>1</b> Orientation</a>
<ul>
<li class="chapter" data-level="1.1" data-path="orientation.html"><a href="orientation.html#downloading-r-studio"><i class="fa fa-check"></i><b>1.1</b> Downloading R-Studio</a></li>
<li class="chapter" data-level="1.2" data-path="orientation.html"><a href="orientation.html#your-work-space"><i class="fa fa-check"></i><b>1.2</b> Your Work Space</a></li>
<li class="chapter" data-level="1.3" data-path="orientation.html"><a href="orientation.html#helpful-tools-for-learning-more"><i class="fa fa-check"></i><b>1.3</b> Helpful Tools for Learning More</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reading.html"><a href="reading.html"><i class="fa fa-check"></i><b>2</b> Reading</a>
<ul>
<li class="chapter" data-level="2.1" data-path="reading.html"><a href="reading.html#explaining-working-directories"><i class="fa fa-check"></i><b>2.1</b> Explaining Working Directories</a></li>
<li class="chapter" data-level="2.2" data-path="reading.html"><a href="reading.html#loading-from-package-library"><i class="fa fa-check"></i><b>2.2</b> Loading from Package Library</a></li>
<li class="chapter" data-level="2.3" data-path="reading.html"><a href="reading.html#csv"><i class="fa fa-check"></i><b>2.3</b> CSV</a></li>
<li class="chapter" data-level="2.4" data-path="reading.html"><a href="reading.html#excel"><i class="fa fa-check"></i><b>2.4</b> Excel</a></li>
<li class="chapter" data-level="2.5" data-path="reading.html"><a href="reading.html#google-spreadsheets"><i class="fa fa-check"></i><b>2.5</b> Google Spreadsheets</a></li>
<li class="chapter" data-level="2.6" data-path="reading.html"><a href="reading.html#spss"><i class="fa fa-check"></i><b>2.6</b> SPSS</a></li>
<li class="chapter" data-level="2.7" data-path="reading.html"><a href="reading.html#rda"><i class="fa fa-check"></i><b>2.7</b> RDA</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="extraction.html"><a href="extraction.html"><i class="fa fa-check"></i><b>3</b> Extraction</a>
<ul>
<li class="chapter" data-level="3.1" data-path="extraction.html"><a href="extraction.html#web-scraping"><i class="fa fa-check"></i><b>3.1</b> Web Scraping</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="structuring.html"><a href="structuring.html"><i class="fa fa-check"></i><b>4</b> Structuring</a>
<ul>
<li class="chapter" data-level="4.1" data-path="structuring.html"><a href="structuring.html#accessing-data-in-r"><i class="fa fa-check"></i><b>4.1</b> Accessing Data in R</a></li>
<li class="chapter" data-level="4.2" data-path="structuring.html"><a href="structuring.html#data-types"><i class="fa fa-check"></i><b>4.2</b> Data types</a></li>
<li class="chapter" data-level="4.3" data-path="structuring.html"><a href="structuring.html#inspecting-the-data"><i class="fa fa-check"></i><b>4.3</b> Inspecting the data</a></li>
<li class="chapter" data-level="4.4" data-path="structuring.html"><a href="structuring.html#subsetting-and-filtering"><i class="fa fa-check"></i><b>4.4</b> Subsetting and Filtering</a></li>
<li class="chapter" data-level="4.5" data-path="structuring.html"><a href="structuring.html#changing-cell-values"><i class="fa fa-check"></i><b>4.5</b> Changing cell values</a></li>
<li class="chapter" data-level="4.6" data-path="structuring.html"><a href="structuring.html#pivoting-the-dataset"><i class="fa fa-check"></i><b>4.6</b> Pivoting the dataset</a></li>
<li class="chapter" data-level="4.7" data-path="structuring.html"><a href="structuring.html#merging-two-dataframes"><i class="fa fa-check"></i><b>4.7</b> Merging Two Dataframes</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="cleaning.html"><a href="cleaning.html"><i class="fa fa-check"></i><b>5</b> Cleaning</a>
<ul>
<li class="chapter" data-level="5.1" data-path="cleaning.html"><a href="cleaning.html#fixing-skewed-distribution"><i class="fa fa-check"></i><b>5.1</b> Fixing skewed distribution</a></li>
<li class="chapter" data-level="5.2" data-path="cleaning.html"><a href="cleaning.html#treating-outliers"><i class="fa fa-check"></i><b>5.2</b> Treating outliers</a></li>
<li class="chapter" data-level="5.3" data-path="cleaning.html"><a href="cleaning.html#fixing-missing-values"><i class="fa fa-check"></i><b>5.3</b> Fixing missing values</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>6</b> Visualization</a>
<ul>
<li class="chapter" data-level="6.1" data-path="visualization.html"><a href="visualization.html#simple-graphs-with-ggplot2"><i class="fa fa-check"></i><b>6.1</b> Simple graphs with <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="visualization.html"><a href="visualization.html#setting-ggplot2-theme"><i class="fa fa-check"></i><b>6.1.1</b> Setting <code>ggplot2</code> theme</a></li>
<li class="chapter" data-level="6.1.2" data-path="visualization.html"><a href="visualization.html#ggplot2-example-1-stacked-bar-plot"><i class="fa fa-check"></i><b>6.1.2</b> <code>ggplot2</code> Example 1: Stacked bar plot</a></li>
<li class="chapter" data-level="6.1.3" data-path="visualization.html"><a href="visualization.html#ggplot2-example-2-grouped-bar-plot"><i class="fa fa-check"></i><b>6.1.3</b> <code>ggplot2</code> Example 2: Grouped bar plot</a></li>
<li class="chapter" data-level="6.1.4" data-path="visualization.html"><a href="visualization.html#ggplot2-example-3-scatterplot"><i class="fa fa-check"></i><b>6.1.4</b> <code>ggplot2</code> Example 3: Scatterplot</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="visualization.html"><a href="visualization.html#animated-graph-with-gganimate"><i class="fa fa-check"></i><b>6.2</b> Animated graph with <code>gganimate</code></a></li>
<li class="chapter" data-level="6.3" data-path="visualization.html"><a href="visualization.html#interactive-graph-with-plotly"><i class="fa fa-check"></i><b>6.3</b> Interactive graph with <code>plotly</code></a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="visualization.html"><a href="visualization.html#plotly-example-1-interactive-version-of-the-stacked-bar"><i class="fa fa-check"></i><b>6.3.1</b> <code>plotly</code> Example 1: Interactive version of the stacked bar</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="visualization.html"><a href="visualization.html#web-app-with-rshiny"><i class="fa fa-check"></i><b>6.4</b> Web app with RShiny</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="visualization.html"><a href="visualization.html#input-functions"><i class="fa fa-check"></i><b>6.4.1</b> Input functions</a></li>
<li class="chapter" data-level="6.4.2" data-path="visualization.html"><a href="visualization.html#output-functions"><i class="fa fa-check"></i><b>6.4.2</b> Output functions</a></li>
<li class="chapter" data-level="6.4.3" data-path="visualization.html"><a href="visualization.html#server-function"><i class="fa fa-check"></i><b>6.4.3</b> Server function</a></li>
<li class="chapter" data-level="6.4.4" data-path="visualization.html"><a href="visualization.html#sharing-your-app"><i class="fa fa-check"></i><b>6.4.4</b> Sharing your app</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="visualization.html"><a href="visualization.html#more-data-visualization-resources"><i class="fa fa-check"></i><b>6.5</b> More data visualization resources</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="spatial.html"><a href="spatial.html"><i class="fa fa-check"></i><b>7</b> Spatial data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="spatial.html"><a href="spatial.html#importing-spatial-data"><i class="fa fa-check"></i><b>7.1</b> Importing spatial data</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="spatial.html"><a href="spatial.html#reading-shapefile"><i class="fa fa-check"></i><b>7.1.1</b> Reading shapefile</a></li>
<li class="chapter" data-level="7.1.2" data-path="spatial.html"><a href="spatial.html#reading-raster"><i class="fa fa-check"></i><b>7.1.2</b> Reading raster</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="spatial.html"><a href="spatial.html#processing"><i class="fa fa-check"></i><b>7.2</b> Processing</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="spatial.html"><a href="spatial.html#creating-point-data"><i class="fa fa-check"></i><b>7.2.1</b> Creating point data</a></li>
<li class="chapter" data-level="7.2.2" data-path="spatial.html"><a href="spatial.html#joining-with-another-dataframe"><i class="fa fa-check"></i><b>7.2.2</b> Joining with another dataframe</a></li>
<li class="chapter" data-level="7.2.3" data-path="spatial.html"><a href="spatial.html#spatial-joining"><i class="fa fa-check"></i><b>7.2.3</b> Spatial joining</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="spatial.html"><a href="spatial.html#some-visualization-examples"><i class="fa fa-check"></i><b>7.3</b> Some Visualization Examples</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="spatial.html"><a href="spatial.html#plotting-charcoal-data"><i class="fa fa-check"></i><b>7.3.1</b> Plotting charcoal data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>8</b> Analysis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="analysis.html"><a href="analysis.html#working-with-survey-data"><i class="fa fa-check"></i><b>8.1</b> Working with survey data</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="analysis.html"><a href="analysis.html#variable-standardization"><i class="fa fa-check"></i><b>8.1.1</b> Variable Standardization</a></li>
<li class="chapter" data-level="8.1.2" data-path="analysis.html"><a href="analysis.html#sample-weighting"><i class="fa fa-check"></i><b>8.1.2</b> Sample weighting</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="analysis.html"><a href="analysis.html#working-with-covid-19-data"><i class="fa fa-check"></i><b>8.2</b> Working with COVID-19 data</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>9</b> Resources</a>
<ul>
<li class="chapter" data-level="9.1" data-path="resources.html"><a href="resources.html#data"><i class="fa fa-check"></i><b>9.1</b> Data</a></li>
<li class="chapter" data-level="9.2" data-path="resources.html"><a href="resources.html#eds-course-map"><i class="fa fa-check"></i><b>9.2</b> EDS Course Map</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">EDS Vignettes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cleaning" class="section level1" number="5">
<h1><span class="header-section-number">Section 5</span> Cleaning</h1>
<p>Data cleaning is the process of getting data ready for statistical analysis. In contrast to structuring the data, the target anomalies in this case are variable values such as missing values, outliers, skewed distributions, etc.</p>
<div id="fixing-skewed-distribution" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Fixing skewed distribution</h2>
<p>Data are skewed when their distribution is not symmetrical but rather favors either the left or right. Sometimes, to facilitate statistical analysis, we need to transform skewed data so that it becomes normally distributed instead. Several tests like PCA analysis require multivariate normality. First we will read in data to use for this part of our practice.</p>
<p>We will then examine a plot.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="cleaning.html#cb109-1"></a><span class="co"># Example of skewed data</span></span>
<span id="cb109-2"><a href="cleaning.html#cb109-2"></a>{x &lt;-<span class="st"> </span>data<span class="op">$</span>nstorm</span>
<span id="cb109-3"><a href="cleaning.html#cb109-3"></a>h &lt;-<span class="st"> </span><span class="kw">hist</span>(x, <span class="dt">breaks=</span><span class="dv">20</span>, <span class="dt">col=</span><span class="st">&quot;grey&quot;</span>)</span>
<span id="cb109-4"><a href="cleaning.html#cb109-4"></a>xfit &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(x), <span class="kw">max</span>(x), <span class="dt">length=</span><span class="dv">40</span>)</span>
<span id="cb109-5"><a href="cleaning.html#cb109-5"></a>yfit &lt;-<span class="st"> </span><span class="kw">dnorm</span>(xfit, <span class="dt">mean=</span><span class="kw">mean</span>(x), <span class="dt">sd=</span><span class="kw">sd</span>(x))</span>
<span id="cb109-6"><a href="cleaning.html#cb109-6"></a>yfit &lt;-<span class="st"> </span>yfit<span class="op">*</span><span class="kw">diff</span>(h<span class="op">$</span>mids[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>])<span class="op">*</span><span class="kw">length</span>(x)</span>
<span id="cb109-7"><a href="cleaning.html#cb109-7"></a><span class="kw">lines</span>(xfit, yfit, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)}</span></code></pre></div>
<p><img src="edsy_files/figure-html/skewed-2-1.png" width="672" /></p>
<p>The plot above shows a good example of skewed data. To deal with this type of data, a good first tool to try is some form of logarithmic transformation, which reduces the scale of the larger values more substantially.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="cleaning.html#cb110-1"></a><span class="co"># Log-transformation</span></span>
<span id="cb110-2"><a href="cleaning.html#cb110-2"></a>{log.x &lt;-<span class="st"> </span><span class="kw">log</span>(data<span class="op">$</span>nstorm)</span>
<span id="cb110-3"><a href="cleaning.html#cb110-3"></a>h &lt;-<span class="st"> </span><span class="kw">hist</span>(log.x, <span class="dt">breaks =</span> <span class="dv">10</span>, <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>)}</span></code></pre></div>
<p><img src="edsy_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>While the previous log-transformation seem to have worked, it is not entirely correct because the variable <code>nstorm</code> has <code>0</code> values which cannot be represented in logarithms. In this case, one of the commonly used methods is <strong>square root</strong>.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="cleaning.html#cb111-1"></a><span class="co"># sqrt transformation</span></span>
<span id="cb111-2"><a href="cleaning.html#cb111-2"></a>{sqrt.x &lt;-<span class="st"> </span><span class="kw">sqrt</span>(data<span class="op">$</span>nstorm)</span>
<span id="cb111-3"><a href="cleaning.html#cb111-3"></a>h &lt;-<span class="st"> </span><span class="kw">hist</span>(sqrt.x, <span class="dt">breaks =</span> <span class="dv">10</span>, <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>)}</span></code></pre></div>
<p><img src="edsy_files/figure-html/skewed-3-1.png" width="672" /></p>
<p>While these two are not the only types of transformation you can make, they are certainly two of the most frequently used.</p>
</div>
<div id="treating-outliers" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Treating outliers</h2>
<p>Outliers are extreme values in datasets. If not detected and handled appropriately, they can affect the accuracy of the predicitions and analysis. Non-resilient statistics are those that can be affected by severe outliers, like a mean calculation getting pulled in the direction of extreme values. Resilient statistics are those that can withstand a few outliers, like a median value.</p>
<p>Treating outliers depends on a good knowledge of the data and it is up to the data analyst to decide on how to go about on fixing them. <a href="http://r-statistics.co/Outlier-Treatment-With-R.html">Selva Prabhakaran</a> gave some ways of handling outliers that we are going to show below.</p>
<p>You can detect outliers using a <code>boxplot</code> where they will show up as dots outside the whiskers:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="cleaning.html#cb112-1"></a><span class="co"># For continuous variable</span></span>
<span id="cb112-2"><a href="cleaning.html#cb112-2"></a>outlier_values &lt;-<span class="st"> </span><span class="kw">unique</span>(<span class="kw">boxplot.stats</span>(data<span class="op">$</span>nstorm)<span class="op">$</span>out)  <span class="co"># outlier values.</span></span>
<span id="cb112-3"><a href="cleaning.html#cb112-3"></a><span class="kw">boxplot</span>(data<span class="op">$</span>nstorm, <span class="dt">main=</span><span class="st">&quot;How many storm have you experienced?&quot;</span>, <span class="dt">boxwex=</span><span class="fl">0.1</span>)</span>
<span id="cb112-4"><a href="cleaning.html#cb112-4"></a><span class="kw">mtext</span>(<span class="kw">paste</span>(<span class="st">&quot;Outliers: &quot;</span>, <span class="kw">paste</span>(outlier_values, <span class="dt">collapse=</span><span class="st">&quot;, &quot;</span>)), <span class="dt">cex=</span><span class="fl">0.6</span>)</span></code></pre></div>
<p><img src="edsy_files/figure-html/outliers-1-1.png" width="672" /></p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="cleaning.html#cb113-1"></a><span class="co"># For categorical variable</span></span>
<span id="cb113-2"><a href="cleaning.html#cb113-2"></a><span class="kw">boxplot</span>(nstorm <span class="op">~</span><span class="st"> </span>worry, <span class="dt">data=</span>data, <span class="dt">main=</span><span class="st">&quot;Number of storms experienced across levels of worry&quot;</span>)</span></code></pre></div>
<p><img src="edsy_files/figure-html/outliers-2-1.png" width="672" /></p>
<p>It is worth noting that outliers should not always, if ever, be ignored or removed. While they are anomalies that make modelling difficult, quite often they represent a part of the data’s narrative which should not be swept aside without consideration. The techniques we describe are for outliers which, for whatever reason, do not belong in the dataset, whether that be corrupted data, mislabelled points, or typos. If an outlier must be removed for a condition of normality to be met, it is in the hands of the statistician to explain why such steps were necessary in light of the procedures being run.</p>
<p>Approaches for outlier treatment include imputation with <code>mean</code>, <code>median</code>, or <code>mode</code>. We can also cap the values, predict them, or delete the observations. Deletion should only be done in the case that there is clear, undisputable evidence that the data entry was recorded incorrectly.</p>
</div>
<div id="fixing-missing-values" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Fixing missing values</h2>
<p>Ways of detectng missing values (<code>NA</code>) include the <code>summary</code> and <code>anyNA()</code>.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="cleaning.html#cb114-1"></a><span class="co"># Check to see if there are missing values</span></span>
<span id="cb114-2"><a href="cleaning.html#cb114-2"></a><span class="kw">anyNA</span>(data<span class="op">$</span>nstorm)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="cleaning.html#cb116-1"></a><span class="kw">summary</span>(data<span class="op">$</span>nstorm)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##    0.00    2.00    2.00    2.58    3.00   20.00      50</code></pre>
<p>Sometimes you want to access only the entries that are not missing within a specific column. For these cases, the is.na() function is incredibly useful. It returns a vector of True/False for entries which are missing or not missing. In R, if you want to flip a Boolean (T/F) value, simply use the ‘!’ character. This comes in handy when, for instance, we want only the non-missing values</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="cleaning.html#cb118-1"></a><span class="co"># Test to show ! usage</span></span>
<span id="cb118-2"><a href="cleaning.html#cb118-2"></a><span class="ot">TRUE</span> <span class="op">==</span><span class="st"> </span><span class="op">!</span><span class="ot">FALSE</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="cleaning.html#cb120-1"></a><span class="co"># Returns only the real values</span></span>
<span id="cb120-2"><a href="cleaning.html#cb120-2"></a>data<span class="op">$</span>nstorm[<span class="op">!</span><span class="kw">is.na</span>(data<span class="op">$</span>nstorm)]</span></code></pre></div>
<pre><code>##   [1]  2  1  3  3  2  5  3  5  1  2  3  2  2  4  1  4  0  3  2  6  3  3  3  1  2
##  [26]  2  2  2  2  5  2  2  4  2  5  2  5  3  1  8  2  2  3  2  2  2  2  2  2  5
##  [51]  2  2  1  2  2  3  1  2  2  3  2  7  1  2  4  1  4  2  2  2  4  3  2  1  1
##  [76]  2  2  1  2  2  2  3  6  4  5  2  2  3  3  2  2  1  2  2  4  2  4  2  2  3
## [101]  2  2  2  2  3  2  2  3  1  2  3  2  2  2  3  3  2  2  2  2  2  5  2  2  2
## [126]  2  4  2  0  1  2  1  5  2  3  5  3  2  2  2  2  4  6  3  2  3  3  1  2  0
## [151]  2  2  2  1  2  3  2  3  4  2  2  0  1  1  3 12  4  4  2  2  3  5  2  3  1
## [176]  1  2  4  9  5  2  1  0  1  4  2  4  3  1  1  1  2  2  2  2  2  2  3  2  3
## [201]  6  3  2  4  3  2  3  3  3  3  1  2  2  3  2  3  4  2  1  2  2  4  0  3  4
## [226]  2  5  2  4  3  3  5  2  1  2  2  3  2  2  2  3  2  1  2  2  2  2  1  3  2
## [251]  3  4  3  3  3  2  1  3  2  2  2 11  2  2  2  2  1  2  3  2  2  5  2  2  3
## [276]  2  2  2  3  2  2  2 10  2  2  3  3  0  2  2  2  3  2  2  0  2  2  3  2  2
## [301]  3  2  2  3  1  3  3  2  6  7  5  1  2  3  1  1  3  1  2  2  5  2  4  1  1
## [326]  2  2  2  2  4  6  1  0  4  2  4  2  2  2  2  2  4  2  4  2  3  2  3  2  1
## [351]  2  2  2  2  1  6  1  2  3  2  1  1  2  2  3  2  3  4  2  2  3  2  2  2 10
## [376]  2  2  2  2  1  0  2  3  3  3  3  2  3  2  3  3  2  1  3  5  1  2  2  2  2
## [401]  2  5  3  0  2  2  2  4  1  3  2  3  3  2  4  4  2  2  2  1  3  1  1  5  2
## [426]  4  1  4  2  1  2  2  2  2  3  2  3  1  1  2  1  3  2 12  5  0  3  5  2  2
## [451]  1  4  4  0  4  8  2  7  9  1  3  2  2  2  2  1  3  1  2  2  2  3  2  1  0
## [476]  0  3  2  0  2  4  0  3  1  2  2  2  0  4  3  2  3 10  3  2  2  2  5 10  3
## [501]  1  1  1  3  2  6  2  2  1  3  3  2  3  2  2  5  3  3  2  2  3  2  3  2  2
## [526]  4  2  2  3  2  4  3  2  5  2  1  3  1  3  2  1  2  2  4  2  3  3  3  1  1
## [551]  2  1  3  4  1  2  6  2  6  2  3  0  2  3  4  2  2  2  1  1  2  2  2  4  2
## [576]  3  5  4  2 10  2  6  1  3  4  2  1  3  2  1  2  2  2  2  3  3  1  2  3  8
## [601]  3  2  2  2  1  5  1  1  3  1  4  5  2  0  2  2  1  2  1  2  2  2  1  8  1
## [626]  2  2  5  2  3  2  2  1  3  1  7  4  4  2  2  2  2  2 20  2  1  3  1  0  2
## [651]  2  3  2  2  3  5  1  0  4 10  4  0  3  5 10  1  3  2  2  2  2  1  3  5  2
## [676]  4  3  2  1  2  4  2  2  4  2  5  3  2  0  3  2  1  2  4  1  1  1  2  2  3
## [701]  2  1  5  2  2  2  2  2  2  2  1  2  3  3  2  5  1  3  3  3  2  1  2  1  2
## [726]  7  5  3  2  2  8  4  2  3  4  2  1  1  4  4  3  2  4  3  2  2 10  1  2  4
## [751]  5  2  5  2  3  2  2  2  2  1  2  0  2  2  2  2  2  3  5  2  2  3  2  2  0
## [776]  2  2  2  2  3  3  2  3  2  6  3  3  1  5  3  2  2  2  5  3  2  2  2  0  2
## [801]  4  3  3  1  2  1  5  3  3  2  2  3  3  4  3  2  2  1  1  6  3  5  1  3  3
## [826]  1  4  3  2  1  3  2  5  0  2  2  2  4  2  3  1  4  3  4  1  2  6  1  2  2
## [851]  2  6  3  2  2  3  3  3  1  3  4  3  3  2  1  3  1  2  4  3  1  3  3  1  4
## [876]  2  2  3  1  1  2  2  2  1  1  6  2  2  2  1  8  2  2  2  3  3  1  1  2  5
## [901]  4  3  3  2  4  3  0  3  5  2  1  2  4  2  1  2  2  2</code></pre>
<p>The simplest way to handle missing values is by removing all of the corresponding observations using <code>tidyr::drop_na()</code> or, in some cases, removing a variable itself. The goal of treating NA values is to expereince as little data loss as possible while maintaining your overall data integrity. If, for example, a column has only 5 real values and 95 missing values, it’s probably not worth keeping in your dataset. If a row has only 1 real value and 11 missing values, it also might not be worth keeping. The discretion of treatment is largely in the hands of the analyst. The command below is a sweeping way to remove rows with any missing values, which is effective when you have rare missing values and voluminous data to choose from.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="cleaning.html#cb122-1"></a>tidyr<span class="op">::</span><span class="kw">drop_na</span>(data)</span></code></pre></div>
<pre><code>## # A tibble: 776 x 13
##    nstorm worry nevac prepared homeloc nyear gender income politics   age zone 
##     &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;   &lt;int&gt; &lt;int&gt;  &lt;int&gt;  &lt;int&gt;    &lt;int&gt; &lt;int&gt; &lt;chr&gt;
##  1      2     3     0        3       2    86      1      4        3    86 A    
##  2      3     4     0        3       3    19      2      6        2    83 A    
##  3      3     6     1        1       1    52      1      5        3    64 A    
##  4      2     1     0        2       3    15      1      5        3    66 A    
##  5      1     3     0        3       3     4      1      3        1    38 A    
##  6      2     6     0        2       2    17      2      6        2    50 A    
##  7      3     5     0        2       3    70      1      4        4    71 A    
##  8      2     7     0        2       1    24      2      5        2    60 A    
##  9      2     5     0        2       2    18      2      5        2    55 A    
## 10      1     3     1        3       2     2      1      6        4    51 A    
## # … with 766 more rows, and 2 more variables: lat &lt;dbl&gt;, long &lt;dbl&gt;</code></pre>
<p>However, if dropping all of the rows with missing values will affect the quality of the data or its breadth, then another option is to replace the missing values with the mean/median/mode of the variable, or to predict for them using an appropriate modelling algorithm. There are several packages out there that are solely dedicated to treating missing values including <code>VIM</code> and <code>MICE</code>.</p>
<p>In this next example, we’ll try to predict the 15 missing values in the variable <code>nstorm</code> (number of storms the survey respondents have experienced) using the variables that has no missing values: <code>zone</code>, <code>lat</code>, and <code>long</code>.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="cleaning.html#cb124-1"></a><span class="co"># Imputation using MICE</span></span>
<span id="cb124-2"><a href="cleaning.html#cb124-2"></a><span class="kw">library</span>(mice)</span>
<span id="cb124-3"><a href="cleaning.html#cb124-3"></a></span>
<span id="cb124-4"><a href="cleaning.html#cb124-4"></a><span class="co"># Building the mice model</span></span>
<span id="cb124-5"><a href="cleaning.html#cb124-5"></a>mice_model &lt;-<span class="st"> </span><span class="kw">mice</span>(<span class="kw">select</span>(data, zone, lat, long, nstorm), <span class="dt">method=</span><span class="st">&quot;rf&quot;</span>, <span class="dt">printFlag=</span>F)</span></code></pre></div>
<pre><code>## Warning: Number of logged events: 1</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="cleaning.html#cb126-1"></a><span class="co"># Predicting the missing values</span></span>
<span id="cb126-2"><a href="cleaning.html#cb126-2"></a><span class="co"># generate the completed data</span></span>
<span id="cb126-3"><a href="cleaning.html#cb126-3"></a>mice_prediction &lt;-<span class="st"> </span><span class="kw">complete</span>(mice_model)</span>
<span id="cb126-4"><a href="cleaning.html#cb126-4"></a></span>
<span id="cb126-5"><a href="cleaning.html#cb126-5"></a><span class="co"># checking for NAs</span></span>
<span id="cb126-6"><a href="cleaning.html#cb126-6"></a><span class="kw">anyNA</span>(mice_prediction)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Then we can visualize the data to see how well the imputation has performed. However, the best way to assess the accuracy is to compare actual values with predicted values using measures such as: <code>MSE</code>, <code>MAE</code>, <code>MAPE</code>, etc.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="cleaning.html#cb128-1"></a><span class="co"># Visualizing the prediction</span></span>
<span id="cb128-2"><a href="cleaning.html#cb128-2"></a>non_na_latitude &lt;-<span class="st"> </span>data<span class="op">$</span>lat[<span class="op">!</span><span class="kw">is.na</span>(data<span class="op">$</span>nstorm)]</span>
<span id="cb128-3"><a href="cleaning.html#cb128-3"></a>non_na_nstorm &lt;-<span class="st"> </span>data<span class="op">$</span>nstorm[<span class="op">!</span><span class="kw">is.na</span>(data<span class="op">$</span>nstorm)]</span>
<span id="cb128-4"><a href="cleaning.html#cb128-4"></a>na_latitude &lt;-<span class="st"> </span>mice_prediction<span class="op">$</span>lat[<span class="kw">is.na</span>(data<span class="op">$</span>nstorm)]</span>
<span id="cb128-5"><a href="cleaning.html#cb128-5"></a>na_nstorm &lt;-<span class="st"> </span>mice_prediction<span class="op">$</span>nstorm[<span class="kw">is.na</span>(data<span class="op">$</span>nstorm)]</span>
<span id="cb128-6"><a href="cleaning.html#cb128-6"></a><span class="kw">plot</span>(non_na_nstorm, non_na_latitude, <span class="dt">col=</span><span class="st">&quot;grey&quot;</span>, <span class="dt">pch=</span><span class="st">&quot;•&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Latitude&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Number of Storms Experienced&quot;</span>)</span>
<span id="cb128-7"><a href="cleaning.html#cb128-7"></a><span class="kw">points</span>(na_nstorm, na_latitude, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">pch=</span><span class="st">&quot;•&quot;</span>, <span class="dt">cex=</span><span class="dv">2</span>)</span>
<span id="cb128-8"><a href="cleaning.html#cb128-8"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;Existing values&quot;</span>, <span class="st">&quot;Predicted missing values&quot;</span>), <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;grey&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="dt">pch=</span><span class="st">&quot;•&quot;</span>, <span class="dt">cex=</span><span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="edsy_files/figure-html/missing-5-1.png" width="672" /></p>
<p>Other ways to impute the missing values are with <code>mean</code>, <code>median</code>, or <code>mode</code>.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="cleaning.html#cb129-1"></a><span class="co"># Assign the data to prediction</span></span>
<span id="cb129-2"><a href="cleaning.html#cb129-2"></a>prediction &lt;-<span class="st"> </span>data</span>
<span id="cb129-3"><a href="cleaning.html#cb129-3"></a>na.observations &lt;-<span class="st"> </span><span class="kw">is.na</span>(data<span class="op">$</span>nstorm)</span>
<span id="cb129-4"><a href="cleaning.html#cb129-4"></a>prediction<span class="op">$</span>nstorm[na.observations] &lt;-<span class="st"> </span><span class="kw">median</span>(prediction<span class="op">$</span>nstorm[<span class="op">!</span>na.observations])</span>
<span id="cb129-5"><a href="cleaning.html#cb129-5"></a></span>
<span id="cb129-6"><a href="cleaning.html#cb129-6"></a><span class="co"># Visualizing the prediction</span></span>
<span id="cb129-7"><a href="cleaning.html#cb129-7"></a>na_latitude &lt;-<span class="st"> </span>prediction<span class="op">$</span>lat[na.observations]</span>
<span id="cb129-8"><a href="cleaning.html#cb129-8"></a>na_nstorm &lt;-<span class="st"> </span>prediction<span class="op">$</span>nstorm[na.observations]</span>
<span id="cb129-9"><a href="cleaning.html#cb129-9"></a><span class="kw">plot</span>(non_na_nstorm, non_na_latitude, <span class="dt">col=</span><span class="st">&quot;grey&quot;</span>, <span class="dt">pch=</span><span class="st">&quot;•&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Latitude&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Number of Storms Experienced&quot;</span>)</span>
<span id="cb129-10"><a href="cleaning.html#cb129-10"></a><span class="kw">points</span>(na_nstorm, na_latitude, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">pch=</span><span class="st">&quot;•&quot;</span>, <span class="dt">cex=</span><span class="dv">2</span>)</span>
<span id="cb129-11"><a href="cleaning.html#cb129-11"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;Existing values&quot;</span>, <span class="st">&quot;Predicted missing values&quot;</span>), <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;grey&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="dt">pch=</span><span class="st">&quot;•&quot;</span>, <span class="dt">cex=</span><span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="edsy_files/figure-html/missing-6-1.png" width="672" /></p>
<p>For mode, there is no built-in function in R, but you can access one <a href="https://www.tutorialspoint.com/r/r_mean_median_mode.htm">here</a>:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="cleaning.html#cb130-1"></a>getmode &lt;-<span class="st"> </span><span class="cf">function</span>(v) {</span>
<span id="cb130-2"><a href="cleaning.html#cb130-2"></a>   uniqv &lt;-<span class="st"> </span><span class="kw">unique</span>(v)</span>
<span id="cb130-3"><a href="cleaning.html#cb130-3"></a>   uniqv[<span class="kw">which.max</span>(<span class="kw">tabulate</span>(<span class="kw">match</span>(v, uniqv)))]</span>
<span id="cb130-4"><a href="cleaning.html#cb130-4"></a>}</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="structuring.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualization.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rajaoberison/edsy/edit/master/05-cleaning.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["edsy.pdf", "edsy.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
