<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 4 Structuring | EDS Vignettes</title>
  <meta name="description" content="Data science resources for FES Students" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 4 Structuring | EDS Vignettes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Data science resources for FES Students" />
  <meta name="github-repo" content="rajaoberison/edsy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 4 Structuring | EDS Vignettes" />
  
  <meta name="twitter:description" content="Data science resources for FES Students" />
  

<meta name="author" content="Andry Rajaoberison" />


<meta name="date" content="2020-06-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="extraction.html"/>
<link rel="next" href="cleaning.html"/>
<script src="libs/header-attrs-2.2/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">FES EDS Tutorials</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="1" data-path="orientation.html"><a href="orientation.html"><i class="fa fa-check"></i><b>1</b> Orientation</a>
<ul>
<li class="chapter" data-level="1.1" data-path="orientation.html"><a href="orientation.html#downloading-r-studio"><i class="fa fa-check"></i><b>1.1</b> Downloading R-Studio</a></li>
<li class="chapter" data-level="1.2" data-path="orientation.html"><a href="orientation.html#your-work-space"><i class="fa fa-check"></i><b>1.2</b> Your Work Space</a></li>
<li class="chapter" data-level="1.3" data-path="orientation.html"><a href="orientation.html#helpful-tools-for-learning-more"><i class="fa fa-check"></i><b>1.3</b> Helpful Tools for Learning More</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reading.html"><a href="reading.html"><i class="fa fa-check"></i><b>2</b> Reading</a>
<ul>
<li class="chapter" data-level="2.1" data-path="reading.html"><a href="reading.html#explaining-working-directories"><i class="fa fa-check"></i><b>2.1</b> Explaining Working Directories</a></li>
<li class="chapter" data-level="2.2" data-path="reading.html"><a href="reading.html#loading-from-package-library"><i class="fa fa-check"></i><b>2.2</b> Loading from Package Library</a></li>
<li class="chapter" data-level="2.3" data-path="reading.html"><a href="reading.html#csv"><i class="fa fa-check"></i><b>2.3</b> CSV</a></li>
<li class="chapter" data-level="2.4" data-path="reading.html"><a href="reading.html#excel"><i class="fa fa-check"></i><b>2.4</b> Excel</a></li>
<li class="chapter" data-level="2.5" data-path="reading.html"><a href="reading.html#google-spreadsheets"><i class="fa fa-check"></i><b>2.5</b> Google Spreadsheets</a></li>
<li class="chapter" data-level="2.6" data-path="reading.html"><a href="reading.html#spss"><i class="fa fa-check"></i><b>2.6</b> SPSS</a></li>
<li class="chapter" data-level="2.7" data-path="reading.html"><a href="reading.html#rda"><i class="fa fa-check"></i><b>2.7</b> RDA</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="extraction.html"><a href="extraction.html"><i class="fa fa-check"></i><b>3</b> Extraction</a>
<ul>
<li class="chapter" data-level="3.1" data-path="extraction.html"><a href="extraction.html#web-scraping"><i class="fa fa-check"></i><b>3.1</b> Web Scraping</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="structuring.html"><a href="structuring.html"><i class="fa fa-check"></i><b>4</b> Structuring</a>
<ul>
<li class="chapter" data-level="4.1" data-path="structuring.html"><a href="structuring.html#accessing-data-in-r"><i class="fa fa-check"></i><b>4.1</b> Accessing Data in R</a></li>
<li class="chapter" data-level="4.2" data-path="structuring.html"><a href="structuring.html#data-types"><i class="fa fa-check"></i><b>4.2</b> Data types</a></li>
<li class="chapter" data-level="4.3" data-path="structuring.html"><a href="structuring.html#inspecting-the-data"><i class="fa fa-check"></i><b>4.3</b> Inspecting the data</a></li>
<li class="chapter" data-level="4.4" data-path="structuring.html"><a href="structuring.html#subsetting-and-filtering"><i class="fa fa-check"></i><b>4.4</b> Subsetting and Filtering</a></li>
<li class="chapter" data-level="4.5" data-path="structuring.html"><a href="structuring.html#changing-cell-values"><i class="fa fa-check"></i><b>4.5</b> Changing cell values</a></li>
<li class="chapter" data-level="4.6" data-path="structuring.html"><a href="structuring.html#pivoting-the-dataset"><i class="fa fa-check"></i><b>4.6</b> Pivoting the dataset</a></li>
<li class="chapter" data-level="4.7" data-path="structuring.html"><a href="structuring.html#merging-two-dataframes"><i class="fa fa-check"></i><b>4.7</b> Merging Two Dataframes</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="cleaning.html"><a href="cleaning.html"><i class="fa fa-check"></i><b>5</b> Cleaning</a>
<ul>
<li class="chapter" data-level="5.1" data-path="cleaning.html"><a href="cleaning.html#fixing-skewed-distribution"><i class="fa fa-check"></i><b>5.1</b> Fixing skewed distribution</a></li>
<li class="chapter" data-level="5.2" data-path="cleaning.html"><a href="cleaning.html#treating-outliers"><i class="fa fa-check"></i><b>5.2</b> Treating outliers</a></li>
<li class="chapter" data-level="5.3" data-path="cleaning.html"><a href="cleaning.html#fixing-missing-values"><i class="fa fa-check"></i><b>5.3</b> Fixing missing values</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>6</b> Visualization</a>
<ul>
<li class="chapter" data-level="6.1" data-path="visualization.html"><a href="visualization.html#simple-graphs-with-ggplot2"><i class="fa fa-check"></i><b>6.1</b> Simple graphs with <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="visualization.html"><a href="visualization.html#setting-ggplot2-theme"><i class="fa fa-check"></i><b>6.1.1</b> Setting <code>ggplot2</code> theme</a></li>
<li class="chapter" data-level="6.1.2" data-path="visualization.html"><a href="visualization.html#ggplot2-example-1-stacked-bar-plot"><i class="fa fa-check"></i><b>6.1.2</b> <code>ggplot2</code> Example 1: Stacked bar plot</a></li>
<li class="chapter" data-level="6.1.3" data-path="visualization.html"><a href="visualization.html#ggplot2-example-2-grouped-bar-plot"><i class="fa fa-check"></i><b>6.1.3</b> <code>ggplot2</code> Example 2: Grouped bar plot</a></li>
<li class="chapter" data-level="6.1.4" data-path="visualization.html"><a href="visualization.html#ggplot2-example-3-scatterplot"><i class="fa fa-check"></i><b>6.1.4</b> <code>ggplot2</code> Example 3: Scatterplot</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="visualization.html"><a href="visualization.html#animated-graph-with-gganimate"><i class="fa fa-check"></i><b>6.2</b> Animated graph with <code>gganimate</code></a></li>
<li class="chapter" data-level="6.3" data-path="visualization.html"><a href="visualization.html#interactive-graph-with-plotly"><i class="fa fa-check"></i><b>6.3</b> Interactive graph with <code>plotly</code></a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="visualization.html"><a href="visualization.html#plotly-example-1-interactive-version-of-the-stacked-bar"><i class="fa fa-check"></i><b>6.3.1</b> <code>plotly</code> Example 1: Interactive version of the stacked bar</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="visualization.html"><a href="visualization.html#web-app-with-rshiny"><i class="fa fa-check"></i><b>6.4</b> Web app with RShiny</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="visualization.html"><a href="visualization.html#input-functions"><i class="fa fa-check"></i><b>6.4.1</b> Input functions</a></li>
<li class="chapter" data-level="6.4.2" data-path="visualization.html"><a href="visualization.html#output-functions"><i class="fa fa-check"></i><b>6.4.2</b> Output functions</a></li>
<li class="chapter" data-level="6.4.3" data-path="visualization.html"><a href="visualization.html#server-function"><i class="fa fa-check"></i><b>6.4.3</b> Server function</a></li>
<li class="chapter" data-level="6.4.4" data-path="visualization.html"><a href="visualization.html#sharing-your-app"><i class="fa fa-check"></i><b>6.4.4</b> Sharing your app</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="visualization.html"><a href="visualization.html#more-data-visualization-resources"><i class="fa fa-check"></i><b>6.5</b> More data visualization resources</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="spatial.html"><a href="spatial.html"><i class="fa fa-check"></i><b>7</b> Spatial data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="spatial.html"><a href="spatial.html#importing-spatial-data"><i class="fa fa-check"></i><b>7.1</b> Importing spatial data</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="spatial.html"><a href="spatial.html#reading-shapefile"><i class="fa fa-check"></i><b>7.1.1</b> Reading shapefile</a></li>
<li class="chapter" data-level="7.1.2" data-path="spatial.html"><a href="spatial.html#reading-raster"><i class="fa fa-check"></i><b>7.1.2</b> Reading raster</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="spatial.html"><a href="spatial.html#processing"><i class="fa fa-check"></i><b>7.2</b> Processing</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="spatial.html"><a href="spatial.html#creating-point-data"><i class="fa fa-check"></i><b>7.2.1</b> Creating point data</a></li>
<li class="chapter" data-level="7.2.2" data-path="spatial.html"><a href="spatial.html#joining-with-another-dataframe"><i class="fa fa-check"></i><b>7.2.2</b> Joining with another dataframe</a></li>
<li class="chapter" data-level="7.2.3" data-path="spatial.html"><a href="spatial.html#spatial-joining"><i class="fa fa-check"></i><b>7.2.3</b> Spatial joining</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="spatial.html"><a href="spatial.html#some-visualization-examples"><i class="fa fa-check"></i><b>7.3</b> Some Visualization Examples</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="spatial.html"><a href="spatial.html#plotting-charcoal-data"><i class="fa fa-check"></i><b>7.3.1</b> Plotting charcoal data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>8</b> Analysis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="analysis.html"><a href="analysis.html#working-with-survey-data"><i class="fa fa-check"></i><b>8.1</b> Working with survey data</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="analysis.html"><a href="analysis.html#variable-standardization"><i class="fa fa-check"></i><b>8.1.1</b> Variable Standardization</a></li>
<li class="chapter" data-level="8.1.2" data-path="analysis.html"><a href="analysis.html#sample-weighting"><i class="fa fa-check"></i><b>8.1.2</b> Sample weighting</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="analysis.html"><a href="analysis.html#working-with-covid-19-data"><i class="fa fa-check"></i><b>8.2</b> Working with COVID-19 data</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>9</b> Resources</a>
<ul>
<li class="chapter" data-level="9.1" data-path="resources.html"><a href="resources.html#data"><i class="fa fa-check"></i><b>9.1</b> Data</a></li>
<li class="chapter" data-level="9.2" data-path="resources.html"><a href="resources.html#eds-course-map"><i class="fa fa-check"></i><b>9.2</b> EDS Course Map</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">EDS Vignettes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="structuring" class="section level1" number="4">
<h1><span class="header-section-number">Section 4</span> Structuring</h1>
<p>Data structuring is the process of correcting, rearranging, or removing inaccurate records from raw data so that, after the treatment, the transformed data will be easy to analyze. The variable names, types, and values must be consistent and uniform. The focus here is on the ‘appearance’ of the data. We often restructure data so that we can merge two dataframes with pairable attributes, combine several sources describing the same event, or prepare data for intense statistical analysis that requires consistent and complete data. Whatever the purpose, having clean data is a good habit regardless of application or functionality. If somebody else picks up your project, you do not want to have to explain to them the complications and intricacies of messy data. The first stage of structuring is to make sure that your read-in process gave you data of the type that you anticipated or intended. Before we can do that, we should learn how to access specific parts of the data for examination.</p>
<div id="accessing-data-in-r" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Accessing Data in R</h2>
<p>Once you have read in your data, you may want to look, change, or perform calculations on a specific part or element. Keep in mind that R uses 1-indexing instead of 0-indexing, which other languages like Python employ. 1-indexing means that you start counting from the number 1 instead of 0. To access a range of values in a dataframe, you can specify a set of numbers or column names. Let’s create a dataframe below so that you can get a sense of how this works.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="structuring.html#cb36-1"></a>x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">replicate</span>(<span class="dv">5</span>, <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,<span class="dv">20</span>,<span class="dt">rep=</span><span class="ot">TRUE</span>)))</span>
<span id="cb36-2"><a href="structuring.html#cb36-2"></a><span class="kw">names</span>(x) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;One&quot;</span>, <span class="st">&quot;Two&quot;</span>, <span class="st">&quot;Three&quot;</span>, <span class="st">&quot;Four&quot;</span>, <span class="st">&quot;Five&quot;</span>)</span></code></pre></div>
<p>What we’ve just done above is create a dataframe with 5 columns, each of which has 20 rows populated by a random number between 1 and 10. The names of these columns are ‘One’, ‘Two’, ‘Three’, ‘Four’, and ‘Five’ respectively. Let’s say that we want to access just the first three rows of the third and fourth columns. We can do that one of two ways:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="structuring.html#cb37-1"></a><span class="co"># Accessing a part of the data</span></span>
<span id="cb37-2"><a href="structuring.html#cb37-2"></a>x[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">3</span><span class="op">:</span><span class="dv">4</span>]</span>
<span id="cb37-3"><a href="structuring.html#cb37-3"></a>x[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="kw">c</span>(<span class="st">&quot;Three&quot;</span>, <span class="st">&quot;Four&quot;</span>)]</span></code></pre></div>
<p>The first line shows how we use indexing to access data. The rows are listed first, then after a comma the columns are listed. If we want a range of values, we use ‘:’ to indicate we want every number between the two values. 1:4 means we want rows 1, 2, 3, and 4 while just typing 4 means we want just row 4. We use the same logic for columns. However, if we want to access columns by name, we can generate a vector within c(), which is the R shorthand way of writing a vector. Each value within c() is treated as a single variable, separated by commas. In the example, we typed c(“Three”, “Four”) to get the third and fourth columns. Whatever the names of the columns that you want are, you can use this method to access them. You can also use c() to get a non-consecutive set of numbers. Say we want the first, third, and fifth column. We could use c(1,3,5) to get just these columns.</p>
<p>Let’s say we just want one column from a dataframe to use for examination or manipulation. We can use the ‘$’ character to clarify which one we want by name. You will see this all over R scripts, as it is very common to want to access a particular column or item in a list in its entirety.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="structuring.html#cb38-1"></a><span class="co"># Accessing just the fifth column</span></span>
<span id="cb38-2"><a href="structuring.html#cb38-2"></a>x<span class="op">$</span>Five</span>
<span id="cb38-3"><a href="structuring.html#cb38-3"></a>x<span class="op">$</span>Five[<span class="dv">6</span><span class="op">:</span><span class="dv">8</span>]</span></code></pre></div>
<p>The first command gives us just the fifth column of the frame. The second command gives us the sixth to eighth row of the fifth column, using the same square bracket [] indexing as before. Typically, square brackets are reserved for indexing, and parentheses are used for functions.</p>
<p>One final method of subsetting is throuch exclusion. You can type ‘-’ in front of a number if you want to access everything but a single column. For example, instead of typing c(1,2,3,5) to get all columns except for the fourth, we can write ‘-4’.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="structuring.html#cb39-1"></a><span class="co"># These are equivalent statements</span></span>
<span id="cb39-2"><a href="structuring.html#cb39-2"></a>x[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">5</span>)]</span>
<span id="cb39-3"><a href="structuring.html#cb39-3"></a>x[,<span class="op">-</span><span class="dv">4</span>]</span></code></pre></div>
</div>
<div id="data-types" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Data types</h2>
<p>One type of anomaly that we may encounter is the coercion of irrelevant data types to variables. This is very common for numerically coded variables, or variables that have distinct levels. First we read in our data by the method we practiced in the earlier chapter:</p>
<p>If we read in the same SPSS data from the Reading data section, we get the coded values instead of the labels.</p>
<pre><code>## # A tibble: 6 x 9
##   Zone     Q4           Q5    Q6           Q7     Q10   Q50     Q51          Q59
##   &lt;chr&gt; &lt;dbl&gt;    &lt;dbl+lbl&gt; &lt;dbl&gt;    &lt;dbl+lbl&gt; &lt;dbl+l&gt; &lt;dbl&gt; &lt;dbl+l&gt;    &lt;dbl+lbl&gt;
## 1 A         2 3                0 3 [Moderate…  2 [No]  1928 1 [Mal…  4 [$70,000…
## 2 A         1 4                0 3 [Moderate…  2 [No]  1962 1 [Mal… NA          
## 3 A         3 4                0 3 [Moderate…  2 [No]  1931 2 [Fem…  6 [Over $2…
## 4 A         3 6                1 1 [Fully Pr…  2 [No]  1950 1 [Mal…  5 [$100,00…
## 5 A         2 1 [Not Worr…     0 2 [Very Pre…  2 [No]  1948 1 [Mal…  5 [$100,00…
## 6 A         5 4                0 2 [Very Pre…  2 [No]  1938 2 [Fem… NA</code></pre>
<p>It appears as though some of the categorical data was read in as integers. This is a quirk of R, that if left unchanged can drastically change the outcome of your analyses. To access the specific type of data of one column, we can use the class() function, then pass the name of the frame and column we are trying to access using the technique outlined above:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="structuring.html#cb41-1"></a><span class="kw">class</span>(data<span class="op">$</span>Q6)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<p>Q6 is meant to be categorical, not numeric. If we run <code>summary(data)</code>, we get this unintended result which affects several columns:</p>
<pre><code>## Warning in mask$eval_all_mutate(dots[[i]]): NAs introduced by coercion</code></pre>
<pre><code>##       Zone            Q4               Q5              Q6        
##  Min.   : NA    Min.   : 0.000   Min.   :1.000   Min.   :0.0000  
##  1st Qu.: NA    1st Qu.: 2.000   1st Qu.:1.000   1st Qu.:0.0000  
##  Median : NA    Median : 2.000   Median :2.000   Median :0.0000  
##  Mean   :NaN    Mean   : 2.537   Mean   :1.617   Mean   :0.4191  
##  3rd Qu.: NA    3rd Qu.: 3.000   3rd Qu.:2.000   3rd Qu.:1.0000  
##  Max.   : NA    Max.   :20.000   Max.   :2.000   Max.   :4.0000  
##  NA&#39;s   :1130   NA&#39;s   :134      NA&#39;s   :968     NA&#39;s   :116     
##        Q7             Q10             Q50            Q51            Q59       
##  Min.   :1.000   Min.   :1.000   Min.   :  19   Min.   :1.00   Min.   :1.000  
##  1st Qu.:2.000   1st Qu.:2.000   1st Qu.:1944   1st Qu.:1.00   1st Qu.:3.000  
##  Median :3.000   Median :2.000   Median :1955   Median :2.00   Median :4.000  
##  Mean   :2.674   Mean   :1.796   Mean   :1944   Mean   :1.55   Mean   :3.715  
##  3rd Qu.:3.000   3rd Qu.:2.000   3rd Qu.:1966   3rd Qu.:2.00   3rd Qu.:5.000  
##  Max.   :5.000   Max.   :2.000   Max.   :1992   Max.   :2.00   Max.   :6.000  
##  NA&#39;s   :114     NA&#39;s   :123     NA&#39;s   :47     NA&#39;s   :38     NA&#39;s   :112</code></pre>
<p><code>Q4</code> and <code>Q50</code> are the only variables that are supposed to be numeric, but here everything is treated as numeric, even when it was originally categorical data, which is incorrect. We might also want to treat <code>Zone</code> as a factor so that we can examine groups collectively based on this metric.</p>
<p>We can easily convert data types into factors using either <code>dplyr::mutate_at()</code> and applying <code>as.factor</code> function to the variables or the as.[] series of commands in BaseR. Examples of both are given below:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="structuring.html#cb45-1"></a><span class="co"># Converting data types</span></span>
<span id="cb45-2"><a href="structuring.html#cb45-2"></a>updated_data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="op">-</span>Q4, <span class="op">-</span>Q6, <span class="op">-</span>Q50), as_factor)</span>
<span id="cb45-3"><a href="structuring.html#cb45-3"></a></span>
<span id="cb45-4"><a href="structuring.html#cb45-4"></a><span class="co"># Alternately, for specific columns</span></span>
<span id="cb45-5"><a href="structuring.html#cb45-5"></a>data<span class="op">$</span>Q6 &lt;-<span class="st"> </span><span class="kw">as.factor</span>(data<span class="op">$</span>Q6)</span></code></pre></div>
<p>And now we can get the full summary statistics in the form that we want:</p>
<pre><code>##  Zone          Q4               Q5            Q6        
##  A:684   Min.   : 0.000   5      :244   Min.   :0.0000  
##  B:446   1st Qu.: 2.000   4      :211   1st Qu.:0.0000  
##          Median : 2.000   3      :169   Median :0.0000  
##          Mean   : 2.537   6      :129   Mean   :0.4191  
##          3rd Qu.: 3.000   2      :104   3rd Qu.:1.0000  
##          Max.   :20.000   (Other):162   Max.   :4.0000  
##          NA&#39;s   :134      NA&#39;s   :111   NA&#39;s   :116     
##                    Q7        Q10           Q50           Q51     
##  Fully Prepared     : 93   Yes :205   Min.   :  19   Male  :491  
##  Very Prepared      :326   No  :802   1st Qu.:1944   Female:601  
##  Moderately Prepared:438   NA&#39;s:123   Median :1955   NA&#39;s  : 38  
##  A Little Prepared  :137              Mean   :1944               
##  Not at all Prepared: 22              3rd Qu.:1966               
##  NA&#39;s               :114              Max.   :1992               
##                                       NA&#39;s   :47                 
##                 Q59     
##  Less than $15,000: 81  
##  $15,000-$39,999  :169  
##  $40,000-$69,999  :215  
##  $70,000-$99,999  :190  
##  $100,000-$199,999:220  
##  Over $200,000    :143  
##  NA&#39;s             :112</code></pre>
<p>As we can see from the summary, there might still be anomalies with the variables:</p>
<ul>
<li><code>Q4: Number of storms experienced</code>: The mean value is 2.5 but the max value is 20, which suggests heavily right skewed data.</li>
<li><code>Q50: Birth year</code>: Some respondent answered 19 which is incorrect. It’s pretty clearly a typo, because nobody is 2,001 years old. We may also consider transforming this column into age instead of birth year, which makes it easier to interpret.</li>
</ul>
<p>Perpetually in data analysis, the issue of missing values and how to deal with them comes up. We can see here that this dataset is no different, with several NA values across the board. We will talk at length about missing data later on in the next chapter on Data Cleaning.</p>
</div>
<div id="inspecting-the-data" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Inspecting the data</h2>
<p>In order to structure a dataset, we need to not only detect the anomalies within the data, but also decide what to do with them. Such anomalies can include values that are stored in the wrong format (ex: a number stored as a string), values that fall outside of the expected range (ex: outliers), values with inconsistent patterns (ex: dates stored as mm/dd/year vs dd/mm/year), trailing spaces in strings (ex: “data” vs “data”), or other logistical issues.</p>
<p>With our data successfully read in above, we can examine both structure and summary statistics for numerical and categorical variables.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="structuring.html#cb47-1"></a><span class="co"># Structure of the data</span></span>
<span id="cb47-2"><a href="structuring.html#cb47-2"></a><span class="kw">str</span>(data[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])</span></code></pre></div>
<pre><code>## tibble [1,130 × 3] (S3: tbl_df/tbl/data.frame)
##  $ Zone: chr [1:1130] &quot;A&quot; &quot;A&quot; &quot;A&quot; &quot;A&quot; ...
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;A9&quot;
##   ..- attr(*, &quot;display_width&quot;)= int 1
##  $ Q4  : num [1:1130] 2 1 3 3 2 5 3 5 1 2 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;Q4. Since the beginning of 2009, how many hurricanes and tropical storms, if any, hit your city or town on or n&quot;| __truncated__
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F2.0&quot;
##   ..- attr(*, &quot;display_width&quot;)= int 2
##  $ Q5  : dbl+lbl [1:1130]  3,  4,  4,  6,  1,  4,  6,  4,  3,  6,  7,  5,  7,  ...
##    ..@ label      : chr &quot;Q5. Generally speaking, when a hurricane or tropical storm is approaching your city or town, how worried do you&quot;| __truncated__
##    ..@ format.spss: chr &quot;F1.0&quot;
##    ..@ labels     : Named num [1:2] 1 7
##    .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;Not Worried At All&quot; &quot;Extremely Worried&quot;</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="structuring.html#cb49-1"></a><span class="co"># Summary for a numerical variable</span></span>
<span id="cb49-2"><a href="structuring.html#cb49-2"></a><span class="kw">summary</span>(data<span class="op">$</span>Q4)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##   0.000   2.000   2.000   2.537   3.000  20.000     134</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="structuring.html#cb51-1"></a><span class="co"># Summary for a categorical variable</span></span>
<span id="cb51-2"><a href="structuring.html#cb51-2"></a><span class="kw">summary</span>(<span class="kw">as_factor</span>(data<span class="op">$</span>Q7))</span></code></pre></div>
<pre><code>##      Fully Prepared       Very Prepared Moderately Prepared   A Little Prepared 
##                  93                 326                 438                 137 
## Not at all Prepared                NA&#39;s 
##                  22                 114</code></pre>
<p>Here we will look at the output of a few other key functions. Calling head() will by default show you the first six rows of a dataframe. If you want to see more or fewer rows, simply put a comma in after the dataframe’s name and write the number of rows you want to display. Calling tail() will give you the exact opposite, displaying the last n rows of data, with the default again set to six.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="structuring.html#cb53-1"></a><span class="co"># First 10 rows</span></span>
<span id="cb53-2"><a href="structuring.html#cb53-2"></a><span class="kw">head</span>(data, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 9
##    Zone     Q4           Q5 Q6              Q7     Q10   Q50     Q51         Q59
##    &lt;chr&gt; &lt;dbl&gt;    &lt;dbl+lbl&gt; &lt;fct&gt;    &lt;dbl+lbl&gt; &lt;dbl+l&gt; &lt;dbl&gt; &lt;dbl+l&gt;   &lt;dbl+lbl&gt;
##  1 A         2 3            0     3 [Moderate…  2 [No]  1928 1 [Mal…  4 [$70,00…
##  2 A         1 4            0     3 [Moderate…  2 [No]  1962 1 [Mal… NA         
##  3 A         3 4            0     3 [Moderate…  2 [No]  1931 2 [Fem…  6 [Over $…
##  4 A         3 6            1     1 [Fully Pr…  2 [No]  1950 1 [Mal…  5 [$100,0…
##  5 A         2 1 [Not Worr… 0     2 [Very Pre…  2 [No]  1948 1 [Mal…  5 [$100,0…
##  6 A         5 4            0     2 [Very Pre…  2 [No]  1938 2 [Fem… NA         
##  7 A         3 6            1     3 [Moderate…  2 [No]  1977 2 [Fem… NA         
##  8 A         5 4            0     3 [Moderate…  2 [No]  1964 2 [Fem… NA         
##  9 A         1 3            0     3 [Moderate…  2 [No]  1976 1 [Mal…  3 [$40,00…
## 10 A         2 6            0     2 [Very Pre…  2 [No]  1964 2 [Fem…  6 [Over $…</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="structuring.html#cb55-1"></a><span class="co"># Last 10 rows</span></span>
<span id="cb55-2"><a href="structuring.html#cb55-2"></a><span class="kw">tail</span>(data, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 9
##    Zone     Q4      Q5 Q6                Q7      Q10   Q50      Q51          Q59
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl+l&gt; &lt;fct&gt;      &lt;dbl+lbl&gt; &lt;dbl+lb&gt; &lt;dbl&gt; &lt;dbl+lb&gt;    &lt;dbl+lbl&gt;
##  1 B         1       2 0     4 [A Little P…  2 [No]   1980 1 [Male] 3 [$40,000-…
##  2 B         2       2 0     3 [Moderately…  2 [No]   1977 2 [Fema… 4 [$70,000-…
##  3 B         4       4 1     2 [Very Prepa…  1 [Yes]  1962 2 [Fema… 2 [$15,000-…
##  4 B         2       5 0     1 [Fully Prep…  2 [No]   1946 1 [Male] 5 [$100,000…
##  5 B        NA       4 &lt;NA&gt;  1 [Fully Prep…  1 [Yes]  1957 2 [Fema… 1 [Less tha…
##  6 B         1       4 1     4 [A Little P…  1 [Yes]  1987 2 [Fema… 6 [Over $20…
##  7 B         2       5 0     3 [Moderately…  2 [No]   1953 1 [Male] 4 [$70,000-…
##  8 B        NA       4 4     2 [Very Prepa…  2 [No]   1973 2 [Fema… 1 [Less tha…
##  9 B         2       5 0     3 [Moderately…  2 [No]   1980 1 [Male] 5 [$100,000…
## 10 B         2       2 0     4 [A Little P…  2 [No]     NA 2 [Fema… 3 [$40,000-…</code></pre>
<p>To find the number of rows and columns your dataframe has, call dim(). To find just the rows, use nrow(). To find just the columns, use ncol(). Calling either names() or colnames() will give you the names of the columns. If your data has row names (which is not always the case), you can use rownames() to access those.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="structuring.html#cb57-1"></a><span class="co"># Dataframe dimensions</span></span>
<span id="cb57-2"><a href="structuring.html#cb57-2"></a><span class="kw">dim</span>(data)</span></code></pre></div>
<pre><code>## [1] 1130    9</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="structuring.html#cb59-1"></a><span class="co"># Total number of rows</span></span>
<span id="cb59-2"><a href="structuring.html#cb59-2"></a><span class="kw">nrow</span>(data)</span></code></pre></div>
<pre><code>## [1] 1130</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="structuring.html#cb61-1"></a><span class="co"># Total number of columns</span></span>
<span id="cb61-2"><a href="structuring.html#cb61-2"></a><span class="kw">ncol</span>(data)</span></code></pre></div>
<pre><code>## [1] 9</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="structuring.html#cb63-1"></a><span class="co"># Column names</span></span>
<span id="cb63-2"><a href="structuring.html#cb63-2"></a><span class="kw">names</span>(data) <span class="co"># also colnames(data)</span></span></code></pre></div>
<pre><code>## [1] &quot;Zone&quot; &quot;Q4&quot;   &quot;Q5&quot;   &quot;Q6&quot;   &quot;Q7&quot;   &quot;Q10&quot;  &quot;Q50&quot;  &quot;Q51&quot;  &quot;Q59&quot;</code></pre>
<p>We can also plot the data to visualize the distribution of variables using the dplyr and magrittr</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="structuring.html#cb65-1"></a><span class="co"># Plotting the first 5 columns</span></span>
<span id="cb65-2"><a href="structuring.html#cb65-2"></a><span class="kw">plot</span>(data[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>])</span></code></pre></div>
<p><img src="edsy_files/figure-html/inspecting-data-5-1.png" width="80%" /></p>
<p>If you use these techniques and see an outlier, whether it be an abnormally large or small number, you can use either the min() or max() function to get the specific value. Because we have missing values, we need to pass the argument ‘na.rm = TRUE’ to ignore all NA values when calculating these. For several numerical evaluations, R makes sure to explicitly highlight the presence of NA values, which are treated as unknowns. Because R does not know if the missing value could have been the minimum or maximum, it will tell you that this calculation is NA unless you explicitly give it permission to ignore these missing values.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="structuring.html#cb66-1"></a><span class="co"># Examine the problematic values we identified earlier</span></span>
<span id="cb66-2"><a href="structuring.html#cb66-2"></a><span class="kw">max</span>(data<span class="op">$</span>Q4, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 20</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="structuring.html#cb68-1"></a><span class="kw">min</span>(data<span class="op">$</span>Q50, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 19</code></pre>
</div>
<div id="subsetting-and-filtering" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Subsetting and Filtering</h2>
<p>We can remove incorrect or missing row values by using <code>dplyr::filter</code>:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="structuring.html#cb70-1"></a><span class="co"># Removing rows where birth year is irrelevant</span></span>
<span id="cb70-2"><a href="structuring.html#cb70-2"></a><span class="co"># Here we decided that all birth year must be greater 1900</span></span>
<span id="cb70-3"><a href="structuring.html#cb70-3"></a>updated_data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Q50 <span class="op">&gt;</span><span class="st"> </span><span class="dv">1900</span>)</span>
<span id="cb70-4"><a href="structuring.html#cb70-4"></a></span>
<span id="cb70-5"><a href="structuring.html#cb70-5"></a><span class="co"># Now if we re-run its summary we get the following</span></span>
<span id="cb70-6"><a href="structuring.html#cb70-6"></a><span class="kw">summary</span>(updated_data<span class="op">$</span>Q50)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    1908    1945    1955    1956    1966    1992</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="structuring.html#cb72-1"></a><span class="co"># Removing rows with birth year greater than 1900 and missing responses for Q4</span></span>
<span id="cb72-2"><a href="structuring.html#cb72-2"></a>updated_data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Q50 <span class="op">&gt;</span><span class="st"> </span><span class="dv">1900</span>, <span class="op">!</span><span class="kw">is.na</span>(Q4))</span>
<span id="cb72-3"><a href="structuring.html#cb72-3"></a><span class="kw">summary</span>(updated_data<span class="op">$</span>Q50)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    1908    1944    1954    1955    1965    1990</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="structuring.html#cb74-1"></a><span class="kw">summary</span>(updated_data<span class="op">$</span>Q4)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   0.000   2.000   2.000   2.522   3.000  20.000</code></pre>
<p>We can also select for only the variables that we are interested in using the function <code>dplyr::select</code>:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="structuring.html#cb76-1"></a><span class="co"># Creating a new dataframe with only zone, gender, and income columns</span></span>
<span id="cb76-2"><a href="structuring.html#cb76-2"></a>updated_data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Zone, Q59, Q51)</span>
<span id="cb76-3"><a href="structuring.html#cb76-3"></a><span class="kw">head</span>(updated_data, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    Zone  Q59   Q51  
##    &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;
##  1 A     4     1    
##  2 A     &lt;NA&gt;  1    
##  3 A     6     2    
##  4 A     5     1    
##  5 A     5     1    
##  6 A     &lt;NA&gt;  2    
##  7 A     &lt;NA&gt;  2    
##  8 A     &lt;NA&gt;  2    
##  9 A     3     1    
## 10 A     6     2</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="structuring.html#cb78-1"></a><span class="kw">plot</span>(<span class="kw">table</span>(updated_data), <span class="dt">las=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="edsy_files/figure-html/filtering-3-1.png" width="672" /></p>
<p>It is also possible to split the dataset into multiple dataframes by number of rows using <code>split()</code>:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="structuring.html#cb79-1"></a><span class="co"># To split the dataset into multiple dataframes of 10 rows each</span></span>
<span id="cb79-2"><a href="structuring.html#cb79-2"></a>max_number_of_rows_per_dataframe &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb79-3"><a href="structuring.html#cb79-3"></a>total_number_rows_in_the_current_dataset &lt;-<span class="st"> </span><span class="kw">nrow</span>(data)</span>
<span id="cb79-4"><a href="structuring.html#cb79-4"></a>sets_of_10rows_dataframes &lt;-<span class="st"> </span><span class="kw">split</span>(data, </span>
<span id="cb79-5"><a href="structuring.html#cb79-5"></a>                                   <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ceiling</span>(total_number_rows_in_the_current_dataset<span class="op">/</span>max_number_of_rows_per_dataframe), </span>
<span id="cb79-6"><a href="structuring.html#cb79-6"></a>                                       <span class="dt">each=</span>max_number_of_rows_per_dataframe, </span>
<span id="cb79-7"><a href="structuring.html#cb79-7"></a>                                       <span class="dt">length.out=</span>total_number_rows_in_the_current_dataset)</span>
<span id="cb79-8"><a href="structuring.html#cb79-8"></a>                                   )</span>
<span id="cb79-9"><a href="structuring.html#cb79-9"></a><span class="co"># Here are the first 2 dataframes</span></span>
<span id="cb79-10"><a href="structuring.html#cb79-10"></a>sets_of_10rows_dataframes[[<span class="dv">1</span>]] <span class="co"># or sets_of_10rows_dataframes$`1`</span></span></code></pre></div>
<pre><code>## # A tibble: 10 x 9
##    Zone     Q4 Q5    Q6    Q7    Q10     Q50 Q51   Q59  
##    &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;
##  1 A         2 3     0     3     2      1928 1     4    
##  2 A         1 4     0     3     2      1962 1     &lt;NA&gt; 
##  3 A         3 4     0     3     2      1931 2     6    
##  4 A         3 6     1     1     2      1950 1     5    
##  5 A         2 1     0     2     2      1948 1     5    
##  6 A         5 4     0     2     2      1938 2     &lt;NA&gt; 
##  7 A         3 6     1     3     2      1977 2     &lt;NA&gt; 
##  8 A         5 4     0     3     2      1964 2     &lt;NA&gt; 
##  9 A         1 3     0     3     2      1976 1     3    
## 10 A         2 6     0     2     2      1964 2     6</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="structuring.html#cb81-1"></a>sets_of_10rows_dataframes[[<span class="dv">2</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 10 x 9
##    Zone     Q4 Q5    Q6    Q7    Q10     Q50 Q51   Q59  
##    &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;
##  1 A         2 7     2     1     1      1937 2     &lt;NA&gt; 
##  2 A         3 5     0     2     2      1943 1     4    
##  3 A         2 7     0     2     2      1954 2     5    
##  4 A         2 5     0     2     2      1959 2     5    
##  5 A         4 1     &lt;NA&gt;  2     2      1936 2     6    
##  6 A         1 3     1     3     1      1963 1     6    
##  7 A         2 3     1     2     1      1950 2     5    
##  8 A         4 6     0     3     2        NA &lt;NA&gt;  &lt;NA&gt; 
##  9 A         0 4     0     2     2      1941 1     5    
## 10 A        NA &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;   1952 2     5</code></pre>
</div>
<div id="changing-cell-values" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Changing cell values</h2>
<p>As we mentioned earlier, it is best if Q50 is stored as an age variable instead of the default birth year. <code>Q50</code> is a numeric variable and we can simply change it by using <code>dplyr::mutate()</code></p>
<p>With the filtered data, we can replace all of the values in Q50 with 2020 - Q50 like so:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="structuring.html#cb83-1"></a><span class="co"># Replacing Q50 values to their age in 2020</span></span>
<span id="cb83-2"><a href="structuring.html#cb83-2"></a>updated_data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Q50 =</span> <span class="dv">2020</span> <span class="op">-</span><span class="st"> </span>Q50)</span>
<span id="cb83-3"><a href="structuring.html#cb83-3"></a><span class="kw">head</span>(updated_data, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 9
##    Zone     Q4 Q5    Q6    Q7    Q10     Q50 Q51   Q59  
##    &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;
##  1 A         2 3     0     3     2        92 1     4    
##  2 A         1 4     0     3     2        58 1     &lt;NA&gt; 
##  3 A         3 4     0     3     2        89 2     6    
##  4 A         3 6     1     1     2        70 1     5    
##  5 A         2 1     0     2     2        72 1     5    
##  6 A         5 4     0     2     2        82 2     &lt;NA&gt; 
##  7 A         3 6     1     3     2        43 2     &lt;NA&gt; 
##  8 A         5 4     0     3     2        56 2     &lt;NA&gt; 
##  9 A         1 3     0     3     2        44 1     3    
## 10 A         2 6     0     2     2        56 2     6</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="structuring.html#cb85-1"></a><span class="co"># It is also possible to leave Q50 untouched and store the results into a new column</span></span>
<span id="cb85-2"><a href="structuring.html#cb85-2"></a>updated_data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">age =</span> <span class="dv">2020</span> <span class="op">-</span><span class="st"> </span>Q50)</span>
<span id="cb85-3"><a href="structuring.html#cb85-3"></a><span class="kw">head</span>(updated_data, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 10
##    Zone     Q4 Q5    Q6    Q7    Q10     Q50 Q51   Q59     age
##    &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;
##  1 A         2 3     0     3     2      1928 1     4        92
##  2 A         1 4     0     3     2      1962 1     &lt;NA&gt;     58
##  3 A         3 4     0     3     2      1931 2     6        89
##  4 A         3 6     1     1     2      1950 1     5        70
##  5 A         2 1     0     2     2      1948 1     5        72
##  6 A         5 4     0     2     2      1938 2     &lt;NA&gt;     82
##  7 A         3 6     1     3     2      1977 2     &lt;NA&gt;     43
##  8 A         5 4     0     3     2      1964 2     &lt;NA&gt;     56
##  9 A         1 3     0     3     2      1976 1     3        44
## 10 A         2 6     0     2     2      1964 2     6        56</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="structuring.html#cb87-1"></a><span class="kw">summary</span>(updated_data<span class="op">$</span>age)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   28.00   54.00   65.00   64.14   75.00  112.00</code></pre>
<p>For a categorical variable, we use a different function: <code>dplyr::recode_factor()</code> or <code>dplyr::recode()</code>. We will apply this to <code>Q5</code> as we have noticed in the previous section that not all of its values were labelled from SPSS. Here is its summary:</p>
<pre><code>##    1    2    3    4    5    6    7 NA&#39;s 
##   58  101  164  197  232  123   97  104</code></pre>
<p>Looking back at the questionnare, here is how it was phrased:</p>
<p><img src="images/q5.png" /></p>
<p>Because the survey itself does not have labels, the recoding will be up to the user. Here we chose to replace the extreme values with 1 and 7. As mentioned in the documentation: <code>dplyr::recode()</code> will preserve the existing order of levels while changing the values, and <code>dplyr::recode_factor()</code> will change the order of levels to match the order of replacements.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="structuring.html#cb90-1"></a><span class="co"># Recoding Q5</span></span>
<span id="cb90-2"><a href="structuring.html#cb90-2"></a>recoded.with.recode &lt;-<span class="st"> </span><span class="kw">recode</span>(data<span class="op">$</span>Q5, <span class="st">`</span><span class="dt">Not Worried At All</span><span class="st">`</span>=<span class="st">&quot;1&quot;</span>, <span class="st">`</span><span class="dt">Extremely Worried</span><span class="st">`</span>=<span class="st">&quot;7&quot;</span>)</span>
<span id="cb90-3"><a href="structuring.html#cb90-3"></a><span class="kw">summary</span>(recoded.with.recode)</span></code></pre></div>
<pre><code>##    1    2    3    4    5    6    7 NA&#39;s 
##   58  101  164  197  232  123   97  104</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="structuring.html#cb92-1"></a>recoded.with.recode_factor &lt;-<span class="st"> </span><span class="kw">recode_factor</span>(data<span class="op">$</span>Q5, <span class="st">`</span><span class="dt">Not Worried At All</span><span class="st">`</span>=<span class="st">&quot;1&quot;</span>, <span class="st">`</span><span class="dt">Extremely Worried</span><span class="st">`</span>=<span class="st">&quot;7&quot;</span>)</span>
<span id="cb92-2"><a href="structuring.html#cb92-2"></a><span class="kw">summary</span>(recoded.with.recode_factor)</span></code></pre></div>
<pre><code>##    1    7    2    3    4    5    6 NA&#39;s 
##   58   97  101  164  197  232  123  104</code></pre>
<p>We can also change cell values without external libraries like <code>dplyr</code> by running the following code:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="structuring.html#cb94-1"></a><span class="co"># Add column age where the values are 2020 - Q50</span></span>
<span id="cb94-2"><a href="structuring.html#cb94-2"></a>data<span class="op">$</span>age &lt;-<span class="st"> </span><span class="dv">2020</span> <span class="op">-</span><span class="st"> </span>data<span class="op">$</span>Q50</span>
<span id="cb94-3"><a href="structuring.html#cb94-3"></a></span>
<span id="cb94-4"><a href="structuring.html#cb94-4"></a><span class="co"># Replace Q5 with value &quot;Not Worried At All&quot; to &quot;1&quot;</span></span>
<span id="cb94-5"><a href="structuring.html#cb94-5"></a>data<span class="op">$</span>Q5[data<span class="op">$</span>Q5 <span class="op">==</span><span class="st"> &quot;Not Worried At All&quot;</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span></code></pre></div>
<p>Notice above that we used a conditional subset in the second command. Just like we used indexing earlier, we can also use a Boolean vector (True/False) to pick only rows where some condition is met. Within the [] brackets, we gave a statement: ‘data$Q5 == "Not Worried At All’ using ‘==’ to indicate we want True/False for each row. This syntax will return only the entries of Q5 that are True within the condition. We then reassign the value for each of these to be ‘1’ instead of ‘Not Worried At All’, effectively doing the same task as we did above. R is smart enough to work with vectors in this way, running the same evaluation on each entry without you specifying.</p>
<p>One final set of functions that can be incredibly helpful with changing cell values are gsub() and grep(). If, for instance, you want to find all entries of a column that have a specific string pattern in them, you can use grep() to locate every instance. Simply type in the pattern, and the frame over which you want the function to look. For instance, if we wanted to find every entry of a column with the word “missing” in it, we could use grep() like so:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="structuring.html#cb95-1"></a><span class="co"># Identify every row that contains the phrase &quot;missing&quot;</span></span>
<span id="cb95-2"><a href="structuring.html#cb95-2"></a><span class="kw">grep</span>(<span class="st">&quot;missing&quot;</span>, x<span class="op">$</span>example)</span></code></pre></div>
<p>Now let’s say that instead of simply locating every instance, we instead want to replace them with a substitute phrase. That is when we would use gsub(), which lets us substitute another phrase in. If we wanted to replace every part of every entry that says “CT” with “Connecticut”, we could do so:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="structuring.html#cb96-1"></a><span class="co"># Replace every instance of &#39;CT&#39; with &#39;Connecticut&#39;</span></span>
<span id="cb96-2"><a href="structuring.html#cb96-2"></a><span class="kw">gsub</span>(<span class="st">&quot;CT&quot;</span>, <span class="st">&quot;Connecticut&quot;</span>, x<span class="op">$</span>statesample)</span></code></pre></div>
</div>
<div id="pivoting-the-dataset" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Pivoting the dataset</h2>
<p>In some cases, we may want to split a column based on values, or merge multiple columns into fewer columns. A classic example is with time-stamped data. Sometimes we want rows to be days, with individual responses recorded as columns, and sometimes we want each row to be an individual, with columns representing days. It just depends on what the data are modelling. This process can be done using the <code>tidyr</code> package. For example, to convert the dataframe into long-format with only <code>Zone</code>, <code>question</code>, and <code>value</code> as columns:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="structuring.html#cb97-1"></a><span class="co"># Read in the necessary package</span></span>
<span id="cb97-2"><a href="structuring.html#cb97-2"></a><span class="kw">library</span>(tidyr)</span>
<span id="cb97-3"><a href="structuring.html#cb97-3"></a></span>
<span id="cb97-4"><a href="structuring.html#cb97-4"></a><span class="co"># We have to pivot by variable type</span></span>
<span id="cb97-5"><a href="structuring.html#cb97-5"></a><span class="co"># Pivot longer for factor variables</span></span>
<span id="cb97-6"><a href="structuring.html#cb97-6"></a>pivoted.longer &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb97-7"><a href="structuring.html#cb97-7"></a><span class="st">  </span><span class="kw">select_if</span>(is.factor) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb97-8"><a href="structuring.html#cb97-8"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>Zone, <span class="dt">names_to =</span> <span class="st">&quot;question&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb97-9"><a href="structuring.html#cb97-9"></a>pivoted.longer</span></code></pre></div>
<pre><code>## # A tibble: 6,456 x 3
##    Zone  question value
##    &lt;fct&gt; &lt;chr&gt;    &lt;fct&gt;
##  1 A     Q5       3    
##  2 A     Q6       0    
##  3 A     Q7       3    
##  4 A     Q10      2    
##  5 A     Q51      1    
##  6 A     Q59      4    
##  7 A     Q5       4    
##  8 A     Q6       0    
##  9 A     Q7       3    
## 10 A     Q10      2    
## # … with 6,446 more rows</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="structuring.html#cb99-1"></a><span class="co"># Then we can reshape it back to the original</span></span>
<span id="cb99-2"><a href="structuring.html#cb99-2"></a>pivoted.wider &lt;-<span class="st"> </span>pivoted.longer <span class="op">%&gt;%</span></span>
<span id="cb99-3"><a href="structuring.html#cb99-3"></a><span class="st">  </span><span class="kw">group_by</span>(question) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">row =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb99-4"><a href="structuring.html#cb99-4"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> question, <span class="dt">values_from =</span> value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb99-5"><a href="structuring.html#cb99-5"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>row)</span>
<span id="cb99-6"><a href="structuring.html#cb99-6"></a>pivoted.wider</span></code></pre></div>
<pre><code>## # A tibble: 1,076 x 7
##    Zone  Q5    Q6    Q7    Q10   Q51   Q59  
##    &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;
##  1 A     3     0     3     2     1     4    
##  2 A     4     0     3     2     1     &lt;NA&gt; 
##  3 A     4     0     3     2     2     6    
##  4 A     6     1     1     2     1     5    
##  5 A     1     0     2     2     1     5    
##  6 A     4     0     2     2     2     &lt;NA&gt; 
##  7 A     6     1     3     2     2     &lt;NA&gt; 
##  8 A     4     0     3     2     2     &lt;NA&gt; 
##  9 A     3     0     3     2     1     3    
## 10 A     6     0     2     2     2     6    
## # … with 1,066 more rows</code></pre>
<p><code>tidyr::spread()</code> and <code>tidyr::gather()</code> are the outdated equivalent of <code>tidyr::pivot_wider()</code> and <code>tidyr::pivot_longer()</code>.</p>
<p>To merge or split columns, we can use <code>tidyr::unite()</code> or <code>tidyr::separate()</code>. For example, to merge <code>Q7</code> and <code>Q10</code>:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="structuring.html#cb101-1"></a><span class="co"># Creating a new column with responses from both Q7 and Q10</span></span>
<span id="cb101-2"><a href="structuring.html#cb101-2"></a>merged &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unite</span>(<span class="st">&quot;Q7_Q10&quot;</span>, Q7<span class="op">:</span>Q10, <span class="dt">sep =</span> <span class="st">&quot;__&quot;</span>, <span class="dt">remove =</span> <span class="ot">TRUE</span>, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>)</span>
<span id="cb101-3"><a href="structuring.html#cb101-3"></a>merged</span></code></pre></div>
<pre><code>## # A tibble: 1,076 x 9
##    Zone     Q4 Q5    Q6    Q7_Q10   Q50 Q51   Q59     age
##    &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;
##  1 A         2 3     0     3__2    1928 1     4        92
##  2 A         1 4     0     3__2    1962 1     &lt;NA&gt;     58
##  3 A         3 4     0     3__2    1931 2     6        89
##  4 A         3 6     1     1__2    1950 1     5        70
##  5 A         2 1     0     2__2    1948 1     5        72
##  6 A         5 4     0     2__2    1938 2     &lt;NA&gt;     82
##  7 A         3 6     1     3__2    1977 2     &lt;NA&gt;     43
##  8 A         5 4     0     3__2    1964 2     &lt;NA&gt;     56
##  9 A         1 3     0     3__2    1976 1     3        44
## 10 A         2 6     0     2__2    1964 2     6        56
## # … with 1,066 more rows</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="structuring.html#cb103-1"></a><span class="co"># To split it back</span></span>
<span id="cb103-2"><a href="structuring.html#cb103-2"></a>merged <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(Q7_Q10, <span class="kw">c</span>(<span class="st">&quot;Q7&quot;</span>, <span class="st">&quot;Q10&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;__&quot;</span>, <span class="dt">remove =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1,076 x 10
##    Zone     Q4 Q5    Q6    Q7    Q10     Q50 Q51   Q59     age
##    &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;
##  1 A         2 3     0     3     2      1928 1     4        92
##  2 A         1 4     0     3     2      1962 1     &lt;NA&gt;     58
##  3 A         3 4     0     3     2      1931 2     6        89
##  4 A         3 6     1     1     2      1950 1     5        70
##  5 A         2 1     0     2     2      1948 1     5        72
##  6 A         5 4     0     2     2      1938 2     &lt;NA&gt;     82
##  7 A         3 6     1     3     2      1977 2     &lt;NA&gt;     43
##  8 A         5 4     0     3     2      1964 2     &lt;NA&gt;     56
##  9 A         1 3     0     3     2      1976 1     3        44
## 10 A         2 6     0     2     2      1964 2     6        56
## # … with 1,066 more rows</code></pre>
</div>
<div id="merging-two-dataframes" class="section level2" number="4.7">
<h2><span class="header-section-number">4.7</span> Merging Two Dataframes</h2>
<p>If we want to combine two dataframes based on a shared column, we can do that with a ‘merge’ call. Let’s say we have two separate dataframes that discuss the same individuals. Each participant was given an ID that was recorded over the two frames, and we want one dataframe with their responses joined.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="structuring.html#cb105-1"></a><span class="co"># Here we will create the simulated data described above</span></span>
<span id="cb105-2"><a href="structuring.html#cb105-2"></a>survey1 &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="kw">data.frame</span>(<span class="kw">replicate</span>(<span class="dv">10</span>,<span class="kw">sample</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,<span class="dv">1000</span>,<span class="dt">rep=</span><span class="ot">TRUE</span>))))</span>
<span id="cb105-3"><a href="structuring.html#cb105-3"></a>survey2 &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="kw">data.frame</span>(<span class="kw">replicate</span>(<span class="dv">10</span>,<span class="kw">sample</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,<span class="dv">1000</span>,<span class="dt">rep=</span><span class="ot">TRUE</span>))))</span>
<span id="cb105-4"><a href="structuring.html#cb105-4"></a></span>
<span id="cb105-5"><a href="structuring.html#cb105-5"></a><span class="co"># Name the columns of both frames</span></span>
<span id="cb105-6"><a href="structuring.html#cb105-6"></a><span class="kw">names</span>(survey1) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;Q&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</span>
<span id="cb105-7"><a href="structuring.html#cb105-7"></a><span class="kw">names</span>(survey2) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;Q&quot;</span>, <span class="dv">11</span><span class="op">:</span><span class="dv">20</span>))</span></code></pre></div>
<p>The first column of each dataframe represents the participant’s ID, and the next 10 columns represent their responses to questions. We can use a ‘merge’ to execute this:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="structuring.html#cb106-1"></a><span class="co"># Merge the two by their &#39;ID&#39; column</span></span>
<span id="cb106-2"><a href="structuring.html#cb106-2"></a>surveytotal &lt;-<span class="st"> </span><span class="kw">merge</span>(survey1, survey2, <span class="dt">by =</span> <span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<p>With the merge command, we can do one of four types: an inner join, a left join, a right join, or a full join. With an inner join, we only include data that have an identification match in both sets. A left join saves all information from the left dataset and puts NA values in if there is not a corresponding row in the right, a right join does the opposite, preserving all of the right frame’s data, and a full join saves all rows from both of the original datasets.</p>
<p>The frame surveytotal now has all questions stored in the same place. If the “ID” column does not match up in format, this can give you issues, so make sure you only merge once your data is fully cleaned, which we will talk about in the next chapter.</p>
<p>We can also do two simpler combines, known as cbind() or rbind(), if the data do not need to be merged on an ID entry. Say, for example, we had two sheets of an Excel file which were completed on different days and had the exact same set of columns&gt; If we want them to be in the same frame, one after the other, we could use an rbind() call to bind the rows like so:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="structuring.html#cb107-1"></a><span class="co"># Generate the top dataframe</span></span>
<span id="cb107-2"><a href="structuring.html#cb107-2"></a>top &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">replicate</span>(<span class="dv">10</span>, <span class="kw">sample</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,<span class="dv">1000</span>,<span class="dt">rep=</span><span class="ot">TRUE</span>)))</span>
<span id="cb107-3"><a href="structuring.html#cb107-3"></a><span class="kw">names</span>(top) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Row_&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb107-4"><a href="structuring.html#cb107-4"></a></span>
<span id="cb107-5"><a href="structuring.html#cb107-5"></a><span class="co"># Generate the bottom dataframe</span></span>
<span id="cb107-6"><a href="structuring.html#cb107-6"></a>bottom &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">replicate</span>(<span class="dv">10</span>, <span class="kw">sample</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,<span class="dv">1000</span>,<span class="dt">rep=</span><span class="ot">TRUE</span>)))</span>
<span id="cb107-7"><a href="structuring.html#cb107-7"></a><span class="kw">names</span>(bottom) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Row_&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb107-8"><a href="structuring.html#cb107-8"></a></span>
<span id="cb107-9"><a href="structuring.html#cb107-9"></a><span class="co"># Use rbind() to bring them together</span></span>
<span id="cb107-10"><a href="structuring.html#cb107-10"></a>combined &lt;-<span class="st"> </span><span class="kw">rbind</span>(top, bottom)</span></code></pre></div>
<p>If there are two frames that have the same number of rows that describe in sequence the same observations, we can use a cbind() call to combine them:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="structuring.html#cb108-1"></a><span class="co"># Create the left data</span></span>
<span id="cb108-2"><a href="structuring.html#cb108-2"></a>left &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">replicate</span>(<span class="dv">10</span>, <span class="kw">sample</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,<span class="dv">1000</span>,<span class="dt">rep=</span><span class="ot">TRUE</span>)))</span>
<span id="cb108-3"><a href="structuring.html#cb108-3"></a><span class="kw">names</span>(left) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Row_&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb108-4"><a href="structuring.html#cb108-4"></a></span>
<span id="cb108-5"><a href="structuring.html#cb108-5"></a><span class="co"># Create the right data</span></span>
<span id="cb108-6"><a href="structuring.html#cb108-6"></a>right &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">replicate</span>(<span class="dv">10</span>, <span class="kw">sample</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,<span class="dv">1000</span>,<span class="dt">rep=</span><span class="ot">TRUE</span>)))</span>
<span id="cb108-7"><a href="structuring.html#cb108-7"></a><span class="kw">names</span>(right) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Row_&quot;</span>, <span class="dv">11</span><span class="op">:</span><span class="dv">20</span>)</span>
<span id="cb108-8"><a href="structuring.html#cb108-8"></a></span>
<span id="cb108-9"><a href="structuring.html#cb108-9"></a><span class="co"># Use cbind() to stick them together</span></span>
<span id="cb108-10"><a href="structuring.html#cb108-10"></a>combined &lt;-<span class="st"> </span><span class="kw">cbind</span>(left, right)</span></code></pre></div>
<p>Keep in mind that this is only a valid merge if the two frames are composed of rows that represent the same observations.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="extraction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cleaning.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rajaoberison/edsy/edit/master/04-structuring.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["edsy.pdf", "edsy.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
