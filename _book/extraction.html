<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 3 Extraction | EDS Vignettes</title>
  <meta name="description" content="Data science resources for FES Students" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 3 Extraction | EDS Vignettes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Data science resources for FES Students" />
  <meta name="github-repo" content="rajaoberison/edsy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 3 Extraction | EDS Vignettes" />
  
  <meta name="twitter:description" content="Data science resources for FES Students" />
  

<meta name="author" content="Andry Rajaoberison" />


<meta name="date" content="2020-06-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="reading.html"/>
<link rel="next" href="structuring.html"/>
<script src="libs/header-attrs-2.2/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">FES EDS Tutorials</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="1" data-path="orientation.html"><a href="orientation.html"><i class="fa fa-check"></i><b>1</b> Orientation</a>
<ul>
<li class="chapter" data-level="1.1" data-path="orientation.html"><a href="orientation.html#downloading-r-studio"><i class="fa fa-check"></i><b>1.1</b> Downloading R-Studio</a></li>
<li class="chapter" data-level="1.2" data-path="orientation.html"><a href="orientation.html#your-work-space"><i class="fa fa-check"></i><b>1.2</b> Your Work Space</a></li>
<li class="chapter" data-level="1.3" data-path="orientation.html"><a href="orientation.html#helpful-tools-for-learning-more"><i class="fa fa-check"></i><b>1.3</b> Helpful Tools for Learning More</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reading.html"><a href="reading.html"><i class="fa fa-check"></i><b>2</b> Reading</a>
<ul>
<li class="chapter" data-level="2.1" data-path="reading.html"><a href="reading.html#explaining-working-directories"><i class="fa fa-check"></i><b>2.1</b> Explaining Working Directories</a></li>
<li class="chapter" data-level="2.2" data-path="reading.html"><a href="reading.html#loading-from-package-library"><i class="fa fa-check"></i><b>2.2</b> Loading from Package Library</a></li>
<li class="chapter" data-level="2.3" data-path="reading.html"><a href="reading.html#csv"><i class="fa fa-check"></i><b>2.3</b> CSV</a></li>
<li class="chapter" data-level="2.4" data-path="reading.html"><a href="reading.html#excel"><i class="fa fa-check"></i><b>2.4</b> Excel</a></li>
<li class="chapter" data-level="2.5" data-path="reading.html"><a href="reading.html#google-spreadsheets"><i class="fa fa-check"></i><b>2.5</b> Google Spreadsheets</a></li>
<li class="chapter" data-level="2.6" data-path="reading.html"><a href="reading.html#spss"><i class="fa fa-check"></i><b>2.6</b> SPSS</a></li>
<li class="chapter" data-level="2.7" data-path="reading.html"><a href="reading.html#rda"><i class="fa fa-check"></i><b>2.7</b> RDA</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="extraction.html"><a href="extraction.html"><i class="fa fa-check"></i><b>3</b> Extraction</a>
<ul>
<li class="chapter" data-level="3.1" data-path="extraction.html"><a href="extraction.html#web-scraping"><i class="fa fa-check"></i><b>3.1</b> Web Scraping</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="structuring.html"><a href="structuring.html"><i class="fa fa-check"></i><b>4</b> Structuring</a>
<ul>
<li class="chapter" data-level="4.1" data-path="structuring.html"><a href="structuring.html#accessing-data-in-r"><i class="fa fa-check"></i><b>4.1</b> Accessing Data in R</a></li>
<li class="chapter" data-level="4.2" data-path="structuring.html"><a href="structuring.html#data-types"><i class="fa fa-check"></i><b>4.2</b> Data types</a></li>
<li class="chapter" data-level="4.3" data-path="structuring.html"><a href="structuring.html#inspecting-the-data"><i class="fa fa-check"></i><b>4.3</b> Inspecting the data</a></li>
<li class="chapter" data-level="4.4" data-path="structuring.html"><a href="structuring.html#subsetting-and-filtering"><i class="fa fa-check"></i><b>4.4</b> Subsetting and Filtering</a></li>
<li class="chapter" data-level="4.5" data-path="structuring.html"><a href="structuring.html#changing-cell-values"><i class="fa fa-check"></i><b>4.5</b> Changing cell values</a></li>
<li class="chapter" data-level="4.6" data-path="structuring.html"><a href="structuring.html#pivoting-the-dataset"><i class="fa fa-check"></i><b>4.6</b> Pivoting the dataset</a></li>
<li class="chapter" data-level="4.7" data-path="structuring.html"><a href="structuring.html#merging-two-dataframes"><i class="fa fa-check"></i><b>4.7</b> Merging Two Dataframes</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="cleaning.html"><a href="cleaning.html"><i class="fa fa-check"></i><b>5</b> Cleaning</a>
<ul>
<li class="chapter" data-level="5.1" data-path="cleaning.html"><a href="cleaning.html#fixing-skewed-distribution"><i class="fa fa-check"></i><b>5.1</b> Fixing skewed distribution</a></li>
<li class="chapter" data-level="5.2" data-path="cleaning.html"><a href="cleaning.html#treating-outliers"><i class="fa fa-check"></i><b>5.2</b> Treating outliers</a></li>
<li class="chapter" data-level="5.3" data-path="cleaning.html"><a href="cleaning.html#fixing-missing-values"><i class="fa fa-check"></i><b>5.3</b> Fixing missing values</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>6</b> Visualization</a>
<ul>
<li class="chapter" data-level="6.1" data-path="visualization.html"><a href="visualization.html#simple-graphs-with-ggplot2"><i class="fa fa-check"></i><b>6.1</b> Simple graphs with <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="visualization.html"><a href="visualization.html#setting-ggplot2-theme"><i class="fa fa-check"></i><b>6.1.1</b> Setting <code>ggplot2</code> theme</a></li>
<li class="chapter" data-level="6.1.2" data-path="visualization.html"><a href="visualization.html#ggplot2-example-1-stacked-bar-plot"><i class="fa fa-check"></i><b>6.1.2</b> <code>ggplot2</code> Example 1: Stacked bar plot</a></li>
<li class="chapter" data-level="6.1.3" data-path="visualization.html"><a href="visualization.html#ggplot2-example-2-grouped-bar-plot"><i class="fa fa-check"></i><b>6.1.3</b> <code>ggplot2</code> Example 2: Grouped bar plot</a></li>
<li class="chapter" data-level="6.1.4" data-path="visualization.html"><a href="visualization.html#ggplot2-example-3-scatterplot"><i class="fa fa-check"></i><b>6.1.4</b> <code>ggplot2</code> Example 3: Scatterplot</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="visualization.html"><a href="visualization.html#animated-graph-with-gganimate"><i class="fa fa-check"></i><b>6.2</b> Animated graph with <code>gganimate</code></a></li>
<li class="chapter" data-level="6.3" data-path="visualization.html"><a href="visualization.html#interactive-graph-with-plotly"><i class="fa fa-check"></i><b>6.3</b> Interactive graph with <code>plotly</code></a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="visualization.html"><a href="visualization.html#plotly-example-1-interactive-version-of-the-stacked-bar"><i class="fa fa-check"></i><b>6.3.1</b> <code>plotly</code> Example 1: Interactive version of the stacked bar</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="visualization.html"><a href="visualization.html#web-app-with-rshiny"><i class="fa fa-check"></i><b>6.4</b> Web app with RShiny</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="visualization.html"><a href="visualization.html#input-functions"><i class="fa fa-check"></i><b>6.4.1</b> Input functions</a></li>
<li class="chapter" data-level="6.4.2" data-path="visualization.html"><a href="visualization.html#output-functions"><i class="fa fa-check"></i><b>6.4.2</b> Output functions</a></li>
<li class="chapter" data-level="6.4.3" data-path="visualization.html"><a href="visualization.html#server-function"><i class="fa fa-check"></i><b>6.4.3</b> Server function</a></li>
<li class="chapter" data-level="6.4.4" data-path="visualization.html"><a href="visualization.html#sharing-your-app"><i class="fa fa-check"></i><b>6.4.4</b> Sharing your app</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="visualization.html"><a href="visualization.html#more-data-visualization-resources"><i class="fa fa-check"></i><b>6.5</b> More data visualization resources</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="spatial.html"><a href="spatial.html"><i class="fa fa-check"></i><b>7</b> Spatial data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="spatial.html"><a href="spatial.html#importing-spatial-data"><i class="fa fa-check"></i><b>7.1</b> Importing spatial data</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="spatial.html"><a href="spatial.html#reading-shapefile"><i class="fa fa-check"></i><b>7.1.1</b> Reading shapefile</a></li>
<li class="chapter" data-level="7.1.2" data-path="spatial.html"><a href="spatial.html#reading-raster"><i class="fa fa-check"></i><b>7.1.2</b> Reading raster</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="spatial.html"><a href="spatial.html#processing"><i class="fa fa-check"></i><b>7.2</b> Processing</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="spatial.html"><a href="spatial.html#creating-point-data"><i class="fa fa-check"></i><b>7.2.1</b> Creating point data</a></li>
<li class="chapter" data-level="7.2.2" data-path="spatial.html"><a href="spatial.html#joining-with-another-dataframe"><i class="fa fa-check"></i><b>7.2.2</b> Joining with another dataframe</a></li>
<li class="chapter" data-level="7.2.3" data-path="spatial.html"><a href="spatial.html#spatial-joining"><i class="fa fa-check"></i><b>7.2.3</b> Spatial joining</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="spatial.html"><a href="spatial.html#some-visualization-examples"><i class="fa fa-check"></i><b>7.3</b> Some Visualization Examples</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="spatial.html"><a href="spatial.html#plotting-charcoal-data"><i class="fa fa-check"></i><b>7.3.1</b> Plotting charcoal data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>8</b> Analysis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="analysis.html"><a href="analysis.html#working-with-survey-data"><i class="fa fa-check"></i><b>8.1</b> Working with survey data</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="analysis.html"><a href="analysis.html#variable-standardization"><i class="fa fa-check"></i><b>8.1.1</b> Variable Standardization</a></li>
<li class="chapter" data-level="8.1.2" data-path="analysis.html"><a href="analysis.html#sample-weighting"><i class="fa fa-check"></i><b>8.1.2</b> Sample weighting</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="analysis.html"><a href="analysis.html#working-with-covid-19-data"><i class="fa fa-check"></i><b>8.2</b> Working with COVID-19 data</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>9</b> Resources</a>
<ul>
<li class="chapter" data-level="9.1" data-path="resources.html"><a href="resources.html#data"><i class="fa fa-check"></i><b>9.1</b> Data</a></li>
<li class="chapter" data-level="9.2" data-path="resources.html"><a href="resources.html#eds-course-map"><i class="fa fa-check"></i><b>9.2</b> EDS Course Map</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">EDS Vignettes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="extraction" class="section level1" number="3">
<h1><span class="header-section-number">Section 3</span> Extraction</h1>
<div id="web-scraping" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Web Scraping</h2>
<p>Web scraping is the process of fetching and extracting information or data from a webpage. It is very useful if you want to create a dynamic database that updates itself based on the content of a specific website without having to return and manually update the data repeatedly.</p>
<p>To scrape a webpage, we first need to know how to get to the webpage. It can be helpful to retrieve a url that you can use to directly access the content. For example, to obtain the Google search results for “data science”, you can copy and paste this url to your browser: <a href="https://www.google.com/search?q=data+science" class="uri">https://www.google.com/search?q=data+science</a> . Using this url allows you to access results without having to type “data science” on a Google search web page. While this example is rather trivial, website scraping is a critical tool for more complicated or extensive data pages. Some websites like Twitter or Facebook will require to you to use an API for authentification in order to access their data. API stands for Application Programming Interface. It is a computing interface which connects interactions between intermediaries and gives the user a set of conventions to follow for the extraction process.</p>
<p>For this example, we are going to use The Weather Channel’s website, which does not require authentification. We will extract the 10-day forecast for a specific location and store the data in a dataframe in R for later usage.</p>
<p>After inspecting the website and its url, you will notice that you can view the weather data by zip code using this url pattern:</p>
<p><code>https://weather.com/weather/</code> + <code>forecast type</code> + <code>/l/</code> + <code>zip_code</code> + <code>:4:US</code></p>
<p>If we want to view the 10-day forecast for New Haven, we can go to: <a href="https://weather.com/weather/tenday/l/06511:4:US" class="uri">https://weather.com/weather/tenday/l/06511:4:US</a>.</p>
<p>And if we want to access data for today’s forecast:
<a href="https://weather.com/weather/today/l/06511:4:US" class="uri">https://weather.com/weather/today/l/06511:4:US</a></p>
<p>Once we have the webpage url, we can read it into R and extract the data using <code>rvest</code> from the <code>tidyverse</code> collection. We will use the same process of loading from library to get this working. If you are confused by what was just said or if this is not working for you, return to the previous chapter on reading in documents to acquaint yourself with package loading in R.</p>
<p>The New Haven 10-day forecast webpage looks like this:</p>
<div class="figure">
<img src="images/weatherpage.png" alt="" />
<p class="caption">weatherpage</p>
</div>
<p>What we want now is a table that has comprehensive coverage of the weather information for our selected criteria and time window. In order to extract these values, we have to know where in the source code they are located. For example, in the “DAY” column, we want to extract the <code>exact date</code> instead of the <code>days of the week</code>. And we can do that by:</p>
<ul>
<li>Inspecting the tag or class of exact date from the website.</li>
<li>Moving the cursor to the exact date, right-clicking, then choosing <code>Inspect</code></li>
</ul>
<p>When a window opens, it will point directly to the location of the <code>exact date</code> in the source code. Take notes of the css (tag or class name) and use it to get the <code>exact date</code> value using the <code>html_nodes()</code> function. Since this is complicated, we highly recommend following along with this example before trying to apply these steps to your own procedure. Look at the below image to understand what we mean:</p>
<div class="figure">
<img src="images/webcss.png" alt="" />
<p class="caption">weatherpage</p>
</div>
<p>Here is how we extract the dates:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="extraction.html#cb28-1"></a><span class="co"># Load your necessary library</span></span>
<span id="cb28-2"><a href="extraction.html#cb28-2"></a><span class="kw">library</span>(rvest)</span></code></pre></div>
<pre><code>## Loading required package: xml2</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="extraction.html#cb30-1"></a><span class="co"># Get the webpage url and store it for access</span></span>
<span id="cb30-2"><a href="extraction.html#cb30-2"></a>url =<span class="st"> &#39;https://weather.com/weather/tenday/l/06511:4:US&#39;</span></span>
<span id="cb30-3"><a href="extraction.html#cb30-3"></a></span>
<span id="cb30-4"><a href="extraction.html#cb30-4"></a><span class="co"># Load the webpage using the url</span></span>
<span id="cb30-5"><a href="extraction.html#cb30-5"></a>webpage &lt;-<span class="st"> </span><span class="kw">read_html</span>(url)</span>
<span id="cb30-6"><a href="extraction.html#cb30-6"></a></span>
<span id="cb30-7"><a href="extraction.html#cb30-7"></a><span class="co"># Getting the exact date #######################################################</span></span>
<span id="cb30-8"><a href="extraction.html#cb30-8"></a><span class="co"># Filtering the relevant css / location</span></span>
<span id="cb30-9"><a href="extraction.html#cb30-9"></a><span class="co"># This line comes from our inspection of the webpage as described above</span></span>
<span id="cb30-10"><a href="extraction.html#cb30-10"></a>date_locations &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(webpage, <span class="st">&quot;span.day-detail.clearfix&quot;</span>)</span>
<span id="cb30-11"><a href="extraction.html#cb30-11"></a></span>
<span id="cb30-12"><a href="extraction.html#cb30-12"></a><span class="co"># Extracting the exact value</span></span>
<span id="cb30-13"><a href="extraction.html#cb30-13"></a>raw_date &lt;-<span class="st"> </span><span class="kw">html_text</span>(date_locations)</span>
<span id="cb30-14"><a href="extraction.html#cb30-14"></a><span class="kw">print</span>(raw_date)</span></code></pre></div>
<pre><code>## character(0)</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="extraction.html#cb32-1"></a><span class="co"># Because the value are formatted like &quot;NOV 21&quot; we have to convert to a date format</span></span>
<span id="cb32-2"><a href="extraction.html#cb32-2"></a>exact_date &lt;-<span class="st"> </span><span class="kw">as.Date</span>(raw_date, <span class="dt">format=</span><span class="st">&quot;%b %d&quot;</span>) <span class="co"># b = month, d = day</span></span>
<span id="cb32-3"><a href="extraction.html#cb32-3"></a><span class="kw">print</span>(exact_date)</span></code></pre></div>
<pre><code>## Date of length 0</code></pre>
<p>You will see in the code above that we used a function called as.Date() and gave an argument ‘format= "%b %d’ to it. This means we want to reformat the date to have month listed first, and day listed second.</p>
<p>Here is the full code that extracts the complete table:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="extraction.html#cb34-1"></a><span class="kw">library</span>(rvest)</span>
<span id="cb34-2"><a href="extraction.html#cb34-2"></a></span>
<span id="cb34-3"><a href="extraction.html#cb34-3"></a><span class="co"># Get the webpage url</span></span>
<span id="cb34-4"><a href="extraction.html#cb34-4"></a>url =<span class="st"> &#39;https://weather.com/weather/tenday/l/06511:4:US&#39;</span></span>
<span id="cb34-5"><a href="extraction.html#cb34-5"></a></span>
<span id="cb34-6"><a href="extraction.html#cb34-6"></a><span class="co"># Load the webpage using the url</span></span>
<span id="cb34-7"><a href="extraction.html#cb34-7"></a>webpage &lt;-<span class="st"> </span><span class="kw">read_html</span>(url)</span>
<span id="cb34-8"><a href="extraction.html#cb34-8"></a></span>
<span id="cb34-9"><a href="extraction.html#cb34-9"></a><span class="co"># Getting the exact date #######################################################</span></span>
<span id="cb34-10"><a href="extraction.html#cb34-10"></a><span class="co"># Filtering the relevant css / location</span></span>
<span id="cb34-11"><a href="extraction.html#cb34-11"></a>date_locations &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(webpage, <span class="st">&quot;span.day-detail.clearfix&quot;</span>)</span>
<span id="cb34-12"><a href="extraction.html#cb34-12"></a></span>
<span id="cb34-13"><a href="extraction.html#cb34-13"></a><span class="co"># Extracting the exact value</span></span>
<span id="cb34-14"><a href="extraction.html#cb34-14"></a>raw_date &lt;-<span class="st"> </span><span class="kw">html_text</span>(date_locations)</span>
<span id="cb34-15"><a href="extraction.html#cb34-15"></a></span>
<span id="cb34-16"><a href="extraction.html#cb34-16"></a><span class="co"># Because the value are formatted like &quot;Nov 21&quot; we have to convert to a date format</span></span>
<span id="cb34-17"><a href="extraction.html#cb34-17"></a>exact_date &lt;-<span class="st"> </span><span class="kw">as.Date</span>(raw_date, <span class="dt">format=</span><span class="st">&quot;%b %d&quot;</span>) <span class="co"># b = month, d = day</span></span>
<span id="cb34-18"><a href="extraction.html#cb34-18"></a></span>
<span id="cb34-19"><a href="extraction.html#cb34-19"></a><span class="co"># Getting the weather description</span></span>
<span id="cb34-20"><a href="extraction.html#cb34-20"></a>desc_loc &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(webpage, <span class="st">&quot;td.description&quot;</span>)</span>
<span id="cb34-21"><a href="extraction.html#cb34-21"></a>desc &lt;-<span class="st"> </span><span class="kw">html_text</span>(desc_loc)</span>
<span id="cb34-22"><a href="extraction.html#cb34-22"></a></span>
<span id="cb34-23"><a href="extraction.html#cb34-23"></a><span class="co"># Getting the temperature</span></span>
<span id="cb34-24"><a href="extraction.html#cb34-24"></a>temp_loc &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(webpage, <span class="st">&quot;td.temp&quot;</span>)</span>
<span id="cb34-25"><a href="extraction.html#cb34-25"></a>temp &lt;-<span class="st"> </span><span class="kw">html_text</span>(temp_loc)</span>
<span id="cb34-26"><a href="extraction.html#cb34-26"></a></span>
<span id="cb34-27"><a href="extraction.html#cb34-27"></a><span class="co"># High and Low temperature values</span></span>
<span id="cb34-28"><a href="extraction.html#cb34-28"></a>high_temp &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">length</span>(temp))</span>
<span id="cb34-29"><a href="extraction.html#cb34-29"></a>low_temp &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">length</span>(temp))</span>
<span id="cb34-30"><a href="extraction.html#cb34-30"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(temp)){</span>
<span id="cb34-31"><a href="extraction.html#cb34-31"></a>all &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(temp[i], <span class="st">&quot;°&quot;</span>))</span>
<span id="cb34-32"><a href="extraction.html#cb34-32"></a><span class="cf">if</span> (<span class="kw">length</span>(all) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>){</span>
<span id="cb34-33"><a href="extraction.html#cb34-33"></a>high_temp[i] &lt;-<span class="st"> </span>all[<span class="dv">1</span>]</span>
<span id="cb34-34"><a href="extraction.html#cb34-34"></a>low_temp[i] &lt;-<span class="st"> </span>all[<span class="dv">2</span>]</span>
<span id="cb34-35"><a href="extraction.html#cb34-35"></a>} <span class="cf">else</span> {</span>
<span id="cb34-36"><a href="extraction.html#cb34-36"></a>low_temp[i] &lt;-<span class="st"> </span><span class="dv">38</span></span>
<span id="cb34-37"><a href="extraction.html#cb34-37"></a>}</span>
<span id="cb34-38"><a href="extraction.html#cb34-38"></a>}</span>
<span id="cb34-39"><a href="extraction.html#cb34-39"></a></span>
<span id="cb34-40"><a href="extraction.html#cb34-40"></a><span class="co"># Getting the precipitation</span></span>
<span id="cb34-41"><a href="extraction.html#cb34-41"></a>precip_loc &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(webpage, <span class="st">&quot;td.precip&quot;</span>)</span>
<span id="cb34-42"><a href="extraction.html#cb34-42"></a>precip &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">sub</span>(<span class="st">&quot;%&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">html_text</span>(precip_loc))) <span class="op">/</span><span class="st"> </span><span class="dv">100</span></span>
<span id="cb34-43"><a href="extraction.html#cb34-43"></a></span>
<span id="cb34-44"><a href="extraction.html#cb34-44"></a><span class="co"># Getting the wind</span></span>
<span id="cb34-45"><a href="extraction.html#cb34-45"></a>wind_loc &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(webpage, <span class="st">&quot;td.wind&quot;</span>)</span>
<span id="cb34-46"><a href="extraction.html#cb34-46"></a>wind &lt;-<span class="st"> </span><span class="kw">html_text</span>(wind_loc)</span>
<span id="cb34-47"><a href="extraction.html#cb34-47"></a></span>
<span id="cb34-48"><a href="extraction.html#cb34-48"></a><span class="co"># Wind direction and speed</span></span>
<span id="cb34-49"><a href="extraction.html#cb34-49"></a>wind_dir &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">length</span>(wind))</span>
<span id="cb34-50"><a href="extraction.html#cb34-50"></a>wind_speed &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">length</span>(wind))</span>
<span id="cb34-51"><a href="extraction.html#cb34-51"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(wind)){</span>
<span id="cb34-52"><a href="extraction.html#cb34-52"></a>all &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(wind[i], <span class="st">&quot; &quot;</span>))</span>
<span id="cb34-53"><a href="extraction.html#cb34-53"></a>wind_dir[i] &lt;-<span class="st"> </span>all[<span class="dv">1</span>]</span>
<span id="cb34-54"><a href="extraction.html#cb34-54"></a>wind_speed[i] &lt;-<span class="st"> </span>all[<span class="dv">2</span>]</span>
<span id="cb34-55"><a href="extraction.html#cb34-55"></a>}</span>
<span id="cb34-56"><a href="extraction.html#cb34-56"></a></span>
<span id="cb34-57"><a href="extraction.html#cb34-57"></a><span class="co"># Getting the humidity</span></span>
<span id="cb34-58"><a href="extraction.html#cb34-58"></a>humidity_loc &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(webpage, <span class="st">&quot;td.humidity&quot;</span>)</span>
<span id="cb34-59"><a href="extraction.html#cb34-59"></a>humidity &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">sub</span>(<span class="st">&quot;%&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">html_text</span>(humidity_loc))) <span class="op">/</span><span class="st"> </span><span class="dv">100</span></span>
<span id="cb34-60"><a href="extraction.html#cb34-60"></a></span>
<span id="cb34-61"><a href="extraction.html#cb34-61"></a><span class="co"># Save the data in tibble</span></span>
<span id="cb34-62"><a href="extraction.html#cb34-62"></a><span class="kw">library</span>(tibble)</span>
<span id="cb34-63"><a href="extraction.html#cb34-63"></a>new_haven_forecast &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="st">&#39;day&#39;</span> =<span class="st"> </span>exact_date, <span class="st">&#39;description&#39;</span> =<span class="st"> </span>desc,</span>
<span id="cb34-64"><a href="extraction.html#cb34-64"></a>                        <span class="st">&#39;high_temp&#39;</span> =<span class="st"> </span>high_temp, <span class="st">&#39;low_temp&#39;</span> =<span class="st"> </span>low_temp,</span>
<span id="cb34-65"><a href="extraction.html#cb34-65"></a>                        <span class="st">&#39;precip&#39;</span> =<span class="st"> </span>precip, <span class="st">&#39;wind_dir&#39;</span> =<span class="st"> </span>wind_dir,</span>
<span id="cb34-66"><a href="extraction.html#cb34-66"></a>                        <span class="st">&#39;wind_speed&#39;</span> =<span class="st"> </span>wind_speed, <span class="st">&#39;himidity&#39;</span> =<span class="st"> </span>humidity)</span>
<span id="cb34-67"><a href="extraction.html#cb34-67"></a>new_haven_forecast</span></code></pre></div>
<pre><code>## # A tibble: 0 x 8
## # … with 8 variables: day &lt;date&gt;, description &lt;chr&gt;, high_temp &lt;lgl&gt;,
## #   low_temp &lt;dbl&gt;, precip &lt;dbl&gt;, wind_dir &lt;chr&gt;, wind_speed &lt;chr&gt;,
## #   himidity &lt;dbl&gt;</code></pre>
<p>This can take some trial and error, so do not be dissuaded if your first attempt at extraction does not work out exactly as you had anticipated. Sometimes the computer will read in the lines that you want, but not in the format that you need them in, at which point you’ll need to directly manipulate the data. To learn some common ways of doing that, go to the next chapter on Structuring Data.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="reading.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="structuring.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rajaoberison/edsy/edit/master/03-extraction.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["edsy.pdf", "edsy.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
